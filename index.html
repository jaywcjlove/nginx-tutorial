<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Nginx Tutorial 入门教程</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta description="Nginx 是一款面向性能设计的 HTTP 服务器，能反向代理 HTTP，HTTPS 和邮件相关(SMTP，POP3，IMAP)的协议链接。并且提供了负载均衡以及 HTTP 缓存。它的设计充分使用异步事件模型，削减上下文调度的开销，提高服务器并发能力。采用了模块化设计，提供了丰富模块的第三方模块。">
    <meta keywords="nginx,tutorial,centos">
    <link rel="icon" href="data:image/svg+xml,%3Csvg%20viewBox=%220%200%201024%201024%22%20xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cstyle%3E%20path%20%7Bfill:%20green;%20%7D%20%3C/style%3E%3Cpath%20d=%22M900.3614811%20232.86518557l-339.81629553-194.18074112c-29.12711111-16.99081443-65.536-16.99081443-97.09037114%200l-339.81629553%20194.18074112c-29.12711111%2016.99081443-48.54518557%2048.54518557-48.54518557%2084.95407331v388.36148224c0%2033.98163001%2019.41807445%2067.96325888%2048.54518557%2084.95407331l339.81629553%20194.18074112c29.12711111%2016.99081443%2065.536%2016.99081443%2097.09037114%200l339.81629553-194.18074112c29.12711111-16.99081443%2048.54518557-48.54518557%2048.54518557-84.95407331V317.81925888c0-33.98163001-19.41807445-65.536-48.54518557-84.95407331z%20m-228.16236999%20490.30636998c-21.84533333%200-48.54518557-9.70903666-65.536-29.1271111L390.63703666%20436.75496334v240.29866667c0%2026.69985223-19.41807445%2046.11792555-46.11792555%2046.11792554H342.09185223c-26.69985223%200-46.11792555-21.84533333-46.11792668-46.11792554V346.94636999c0-24.27259221%2021.84533333-46.11792555%2053.39970446-46.11792554%2024.27259221%200%2048.54518557%209.70903666%2065.536%2029.1271111l216.02607332%20257.28948111v-240.29866667c0-26.69985223%2021.84533333-46.11792555%2046.11792668-46.11792554h2.42725888c26.69985223%200%2046.11792555%2021.84533333%2046.11792554%2046.11792554v330.10726002c2.42725888%2026.69985223-21.84533333%2046.11792555-53.39970332%2046.11792554z%22%20fill=%22%23333%22%3E%3C/path%3E%3C/svg%3E" type="image/x-icon">
  </head>
  <body><script type="module">const TEMPLATE = document.createElement("template");
TEMPLATE.innerHTML = `
<style>
:host a:hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out;
}
@keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@media (max-width:500px) {
  :host a:hover .octo-arm {
    animation: none;
  }
  :host .octo-arm {
    animation: octocat-wave 560ms ease-in-out;
  }
}
</style>
<svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true" style="position: absolute; border: 0px; top: 0px;">
  <a xlink:href="https://github.com/uiwjs/react-github-corners" target="_blank" rel="nofollow sponsored" style="fill: rgb(21, 21, 19); color: rgb(255, 255, 255);">
    <g>
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm" style="transform-origin: 130px 106px;"></path>
      <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </g>
  </a>
</svg>
`;
export class GithubCorners extends HTMLElement {
    constructor() {
        super();
        this.right = '0';
        this.shadow = this.attachShadow({ mode: 'open' });
        this.shadow.appendChild(this.ownerDocument.importNode(TEMPLATE.content, true));
        this.update();
    }
    static get observedAttributes() {
        return ['z-index', 'target', 'height', 'width', 'href', 'color', 'fill', 'position', 'top', 'left', 'right', 'bottom', 'transform'];
    }
    setAttr(name, value) {
        const svg = this.shadow.querySelector('svg');
        if (/(href)/.test(name.toLocaleLowerCase())) {
            svg.lastElementChild.setAttribute('xlink:href', value);
        }
        else if (/(color|fill)/.test(name.toLocaleLowerCase())) {
            svg.firstElementChild.style[name] = value;
        }
        else if (/(z-index|height|width|position|top|left|right|bottom|transform)/.test(name.toLocaleLowerCase())) {
            svg.style[name] = value;
        }
        else {
            svg.setAttribute(name, value);
        }
    }
    update() {
        ;
        [...this.getAttributeNames(), 'right'].forEach((name) => {
            const value = this.getAttribute(name) || this[name] || '';
            this.setAttr(name, value);
        });
    }
    attributeChangedCallback(name, oldValue, newValue) {
        if (oldValue !== newValue) {
            this.setAttr(name, newValue);
        }
    }
}
customElements.define('github-corners', GithubCorners);</script><github-corners target="__blank" position="fixed" href="https://github.com/jaywcjlove/nginx-tutorial"></github-corners><dark-mode permanent style="position: fixed; top: 8px; left: 10px; z-index: 999;" dark="Dark" light="Light"></dark-mode><script>const t=document;const e="_dark_mode_theme_";const s="permanent";const o="colorschemechange";const i="permanentcolorscheme";const h="light";const r="dark";const n=(t,e,s=e)=>{Object.defineProperty(t,s,{enumerable:true,get(){const t=this.getAttribute(e);return t===null?"":t},set(t){this.setAttribute(e,t)}})};const c=(t,e,s=e)=>{Object.defineProperty(t,s,{enumerable:true,get(){return this.hasAttribute(e)},set(t){if(t){this.setAttribute(e,"")}else{this.removeAttribute(e)}}})};class a extends HTMLElement{static get observedAttributes(){return["mode",h,r,s]}LOCAL_NANE=e;constructor(){super();this.t()}connectedCallback(){n(this,"mode");n(this,r);n(this,h);c(this,s);const a=localStorage.getItem(e);if(a&&[h,r].includes(a)){this.mode=a;this.permanent=true}if(this.permanent&&!a){localStorage.setItem(e,this.mode)}const l=[h,r].includes(a);if(this.permanent&&a){this.o()}else{if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches){this.mode=r;this.o()}if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches){this.mode=h;this.o()}}if(!this.permanent&&!l){window.matchMedia("(prefers-color-scheme: light)").onchange=t=>{this.mode=t.matches?h:r;this.o()};window.matchMedia("(prefers-color-scheme: dark)").onchange=t=>{this.mode=t.matches?r:h;this.o()}}const d=new MutationObserver(((s,h)=>{this.mode=t.documentElement.dataset.colorMode;if(this.permanent&&l){localStorage.setItem(e,this.mode);this.i(i,{permanent:this.permanent})}this.h();this.i(o,{colorScheme:this.mode})}));d.observe(t.documentElement,{attributes:true});this.i(o,{colorScheme:this.mode});this.h()}attributeChangedCallback(t,s,o){if(t==="mode"&&s!==o&&[h,r].includes(o)){const t=localStorage.getItem(e);if(this.mode===t){this.mode=o;this.h();this.o()}else if(this.mode&&this.mode!==t){this.h();this.o()}}else if((t===h||t===r)&&s!==o){this.h()}if(t==="permanent"&&typeof this.permanent==="boolean"){this.permanent?localStorage.setItem(e,this.mode):localStorage.removeItem(e)}}o(){t.documentElement.setAttribute("data-color-mode",this.mode)}h(){this.icon.textContent=this.mode===h?"🌒":"🌞";this.text.textContent=this.mode===h?this.getAttribute(r):this.getAttribute(h)}t(){var s=this.attachShadow({mode:"open"});this.label=t.createElement("span");this.label.setAttribute("class","wrapper");this.label.onclick=()=>{this.mode=this.mode===h?r:h;if(this.permanent){localStorage.setItem(e,this.mode)}this.o();this.h()};s.appendChild(this.label);this.icon=t.createElement("span");this.label.appendChild(this.icon);this.text=t.createElement("span");this.label.appendChild(this.text);const o=`
[data-color-mode*='dark'], [data-color-mode*='dark'] body {
  color-scheme: dark;
  --color-theme-bg: #0d1117;
  --color-theme-text: #c9d1d9;
  background-color: var(--color-theme-bg);
  color: var(--color-theme-text);
}

[data-color-mode*='light'], [data-color-mode*='light'] body {
  color-scheme: light;
  --color-theme-bg: #fff;
  --color-theme-text: #24292f;
  background-color: var(--color-theme-bg);
  color: var(--color-theme-text);
}`;const i="_dark_mode_style_";const n=t.getElementById(i);if(!n){var c=t.createElement("style");c.id=i;c.textContent=o;t.head.appendChild(c)}var a=t.createElement("style");a.textContent=`
    .wrapper { cursor: pointer; user-select: none; position: relative; }
    .wrapper > span + span { margin-left: .4rem; }
    `;s.appendChild(a)}i(t,e){this.dispatchEvent(new CustomEvent(t,{bubbles:true,composed:true,detail:e}))}}customElements.define("dark-mode",a);</script><script>const __TEMPLATE__ = document.createElement('template');
__TEMPLATE__.innerHTML = `
<style>
:host [data-color-mode*='light'] { --color-prettylights-syntax-comment: #6e7781; --color-prettylights-syntax-constant: #0550ae; --color-prettylights-syntax-entity: #8250df; --color-prettylights-syntax-storage-modifier-import: #24292f; --color-prettylights-syntax-entity-tag: #116329; --color-prettylights-syntax-keyword: #cf222e; --color-prettylights-syntax-string: #0a3069; --color-prettylights-syntax-variable: #953800; --color-prettylights-syntax-brackethighlighter-unmatched: #82071e; --color-prettylights-syntax-invalid-illegal-text: #f6f8fa; --color-prettylights-syntax-invalid-illegal-bg: #82071e; --color-prettylights-syntax-carriage-return-text: #f6f8fa; --color-prettylights-syntax-carriage-return-bg: #cf222e; --color-prettylights-syntax-string-regexp: #116329; --color-prettylights-syntax-markup-list: #3b2300; --color-prettylights-syntax-markup-heading: #0550ae; --color-prettylights-syntax-markup-italic: #24292f; --color-prettylights-syntax-markup-bold: #24292f; --color-prettylights-syntax-markup-deleted-text: #82071e; --color-prettylights-syntax-markup-deleted-bg: #FFEBE9; --color-prettylights-syntax-markup-inserted-text: #116329; --color-prettylights-syntax-markup-inserted-bg: #dafbe1; --color-prettylights-syntax-markup-changed-text: #953800; --color-prettylights-syntax-markup-changed-bg: #ffd8b5; --color-prettylights-syntax-markup-ignored-text: #eaeef2; --color-prettylights-syntax-markup-ignored-bg: #0550ae; --color-prettylights-syntax-meta-diff-range: #8250df; --color-prettylights-syntax-brackethighlighter-angle: #57606a; --color-prettylights-syntax-sublimelinter-gutter-mark: #8c959f; --color-prettylights-syntax-constant-other-reference-link: #0a3069; --color-fg-default: #24292f; --color-fg-muted: #57606a; --color-fg-subtle: #6e7781; --color-canvas-default: #ffffff; --color-canvas-subtle: #f6f8fa; --color-border-default: #d0d7de; --color-border-muted: hsla(210,18%,87%,1); --color-neutral-muted: rgba(175,184,193,0.2); --color-accent-fg: #0969da; --color-accent-emphasis: #0969da; --color-attention-subtle: #fff8c5; --color-danger-fg: #cf222e; } :host [data-color-mode*='dark'] { --color-prettylights-syntax-comment: #8b949e; --color-prettylights-syntax-constant: #79c0ff; --color-prettylights-syntax-entity: #d2a8ff; --color-prettylights-syntax-storage-modifier-import: #c9d1d9; --color-prettylights-syntax-entity-tag: #7ee787; --color-prettylights-syntax-keyword: #ff7b72; --color-prettylights-syntax-string: #a5d6ff; --color-prettylights-syntax-variable: #ffa657; --color-prettylights-syntax-brackethighlighter-unmatched: #f85149; --color-prettylights-syntax-invalid-illegal-text: #f0f6fc; --color-prettylights-syntax-invalid-illegal-bg: #8e1519; --color-prettylights-syntax-carriage-return-text: #f0f6fc; --color-prettylights-syntax-carriage-return-bg: #b62324; --color-prettylights-syntax-string-regexp: #7ee787; --color-prettylights-syntax-markup-list: #f2cc60; --color-prettylights-syntax-markup-heading: #1f6feb; --color-prettylights-syntax-markup-italic: #c9d1d9; --color-prettylights-syntax-markup-bold: #c9d1d9; --color-prettylights-syntax-markup-deleted-text: #ffdcd7; --color-prettylights-syntax-markup-deleted-bg: #67060c; --color-prettylights-syntax-markup-inserted-text: #aff5b4; --color-prettylights-syntax-markup-inserted-bg: #033a16; --color-prettylights-syntax-markup-changed-text: #ffdfb6; --color-prettylights-syntax-markup-changed-bg: #5a1e02; --color-prettylights-syntax-markup-ignored-text: #c9d1d9; --color-prettylights-syntax-markup-ignored-bg: #1158c7; --color-prettylights-syntax-meta-diff-range: #d2a8ff; --color-prettylights-syntax-brackethighlighter-angle: #8b949e; --color-prettylights-syntax-sublimelinter-gutter-mark: #484f58; --color-prettylights-syntax-constant-other-reference-link: #a5d6ff; --color-fg-default: #c9d1d9; --color-fg-muted: #8b949e; --color-fg-subtle: #484f58; --color-canvas-default: #0d1117; --color-canvas-subtle: #161b22; --color-border-default: #30363d; --color-border-muted: #21262d; --color-neutral-muted: rgba(110,118,129,0.4); --color-accent-fg: #58a6ff; --color-accent-emphasis: #1f6feb; --color-attention-subtle: rgba(187,128,9,0.15); --color-danger-fg: #f85149; } :host { display: block; -webkit-text-size-adjust: 100%; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"; font-size: 16px; line-height: 1.5; word-wrap: break-word; color: var(--color-fg-default); background-color: var(--color-canvas-default); } :host details, :host figcaption, :host figure { display: block; } :host summary { display: list-item; } :host [hidden] { display: none !important; } :host a { background-color: transparent; color: var(--color-accent-fg); text-decoration: none; } :host a:active, :host a:hover { outline-width: 0; } :host abbr[title] { border-bottom: none; text-decoration: underline dotted; } :host b, :host strong { font-weight: 600; } :host dfn { font-style: italic; } :host h1 { margin: .67em 0; font-weight: 600; padding-bottom: .3em; font-size: 2em; border-bottom: 1px solid var(--color-border-muted); } :host mark { background-color: var(--color-attention-subtle); color: var(--color-text-primary); } :host small { font-size: 90%; } :host sub, :host sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; } :host sub { bottom: -0.25em; } :host sup { top: -0.5em; } :host img { border-style: none; max-width: 100%; box-sizing: content-box; background-color: var(--color-canvas-default); } :host code, :host kbd, :host pre, :host samp { font-family: monospace,monospace; font-size: 1em; } :host figure { margin: 1em 40px; } :host hr { box-sizing: content-box; overflow: hidden; background: transparent; border-bottom: 1px solid var(--color-border-muted); height: .25em; padding: 0; margin: 24px 0; background-color: var(--color-border-default); border: 0; } :host input { font: inherit; margin: 0; overflow: visible; font-family: inherit; font-size: inherit; line-height: inherit; } :host [type=button], :host [type=reset], :host [type=submit] { -webkit-appearance: button; } :host [type=button]::-moz-focus-inner, :host [type=reset]::-moz-focus-inner, :host [type=submit]::-moz-focus-inner { border-style: none; padding: 0; } :host [type=button]:-moz-focusring, :host [type=reset]:-moz-focusring, :host [type=submit]:-moz-focusring { outline: 1px dotted ButtonText; } :host [type=checkbox], :host [type=radio] { box-sizing: border-box; padding: 0; } :host [type=number]::-webkit-inner-spin-button, :host [type=number]::-webkit-outer-spin-button { height: auto; } :host [type=search] { -webkit-appearance: textfield; outline-offset: -2px; } :host [type=search]::-webkit-search-cancel-button, :host [type=search]::-webkit-search-decoration { -webkit-appearance: none; } :host ::-webkit-input-placeholder { color: inherit; opacity: .54; } :host ::-webkit-file-upload-button { -webkit-appearance: button; font: inherit; } :host a:hover { text-decoration: underline; } :host hr::before { display: table; content: ""; } :host hr::after { display: table; clear: both; content: ""; } :host table { border-spacing: 0; border-collapse: collapse; display: block; width: max-content; max-width: 100%; overflow: auto; } :host td, :host th { padding: 0; } :host details summary { cursor: pointer; } :host details:not([open])>*:not(summary) { display: none !important; } :host kbd { display: inline-block; padding: 3px 5px; font: 11px ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; line-height: 10px; color: var(--color-fg-default); vertical-align: middle; background-color: var(--color-canvas-subtle); border: solid 1px var(--color-neutral-muted); border-bottom-color: var(--color-neutral-muted); border-radius: 6px; box-shadow: inset 0 -1px 0 var(--color-neutral-muted); } :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 { margin-top: 24px; margin-bottom: 16px; font-weight: 600; line-height: 1.25; } :host h2 { font-weight: 600; padding-bottom: .3em; font-size: 1.5em; border-bottom: 1px solid var(--color-border-muted); } :host h3 { font-weight: 600; font-size: 1.25em; } :host h4 { font-weight: 600; font-size: 1em; } :host h5 { font-weight: 600; font-size: .875em; } :host h6 { font-weight: 600; font-size: .85em; color: var(--color-fg-muted); } :host p { margin-top: 0; margin-bottom: 10px; } :host blockquote { margin: 0; padding: 0 1em; color: var(--color-fg-muted); border-left: .25em solid var(--color-border-default); } :host ul, :host ol { margin-top: 0; margin-bottom: 0; padding-left: 2em; } :host ol ol, :host ul ol { list-style-type: lower-roman; } :host ul ul ol, :host ul ol ol, :host ol ul ol, :host ol ol ol { list-style-type: lower-alpha; } :host dd { margin-left: 0; } :host tt, :host code { font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; font-size: 12px; } :host pre { margin-top: 0; margin-bottom: 0; font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; font-size: 12px; word-wrap: normal; } :host .octicon { display: inline-block; overflow: visible !important; vertical-align: text-bottom; fill: currentColor; } :host ::placeholder { color: var(--color-fg-subtle); opacity: 1; } :host input::-webkit-outer-spin-button, :host input::-webkit-inner-spin-button { margin: 0; -webkit-appearance: none; appearance: none; }
.token.comment, .token.prolog, .token.doctype, .token.cdata { color: var(--color-prettylights-syntax-comment); } .token.namespace { opacity: 0.7; } .token.tag, .token.selector, .token.constant, .token.symbol, .token.deleted { color: var(--color-prettylights-syntax-entity-tag); } .token.maybe-class-name { color: var(--color-prettylights-syntax-variable); } .token.property-access, .token.operator, .token.boolean, .token.number, .token.selector .token.class, .token.attr-name, .token.string, .token.char, .token.builtin { color: var(--color-prettylights-syntax-constant); } .token.deleted { color: var(--color-prettylights-syntax-markup-deleted-text); } .token.property { color: var(--color-prettylights-syntax-constant); } .token.punctuation { color: var(--color-prettylights-syntax-markup-bold); } .token.function { color: var(--color-prettylights-syntax-entity); } .code-line .token.deleted { background-color: var(--color-prettylights-syntax-markup-deleted-bg); } .token.inserted { color: var(--color-prettylights-syntax-markup-inserted-text); } .code-line .token.inserted { background-color: var(--color-prettylights-syntax-markup-inserted-bg); } .token.variable { color: var(--color-prettylights-syntax-constant); } .token.entity, .token.url, .language-css .token.string, .style .token.string { color: var(--color-prettylights-syntax-string); } .token.color, .token.atrule, .token.attr-value, .token.function, .token.class-name { color: var(--color-prettylights-syntax-string); } .token.rule, .token.regex, .token.important, .token.keyword { color: var(--color-prettylights-syntax-keyword); } .token.coord { color: var(--color-prettylights-syntax-meta-diff-range); } .token.important, .token.bold { font-weight: bold; } .token.italic { font-style: italic; } .token.entity { cursor: help; }
:host [data-catalyst] { display: block; } :host g-emoji { font-family: "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"; font-size: 1em; font-style: normal !important; font-weight: 400; line-height: 1; vertical-align: -0.075em; } :host g-emoji img { width: 1em; height: 1em; }
.markdown-body::before { display: table; content: ""; } .markdown-body::after { display: table; clear: both; content: ""; } .markdown-body>*:first-child { margin-top: 0 !important; } .markdown-body>*:last-child { margin-bottom: 0 !important; }
:host a:not([href]) { color: inherit; text-decoration: none; } :host .absent { color: var(--color-danger-fg); } :host .anchor { float: left; padding-right: 4px; margin-left: -20px; line-height: 1; } :host .anchor:focus { outline: none; } :host p, :host blockquote, :host ul, :host ol, :host dl, :host table, :host pre, :host details { margin-top: 0; margin-bottom: 16px; } :host blockquote>:first-child { margin-top: 0; } :host blockquote>:last-child { margin-bottom: 0; } :host sup>a::before { content: "["; } :host sup>a::after { content: "]"; } :host h1 .octicon-link, :host h2 .octicon-link, :host h3 .octicon-link, :host h4 .octicon-link, :host h5 .octicon-link, :host h6 .octicon-link { color: var(--color-fg-default); vertical-align: middle; visibility: hidden; } :host h1:hover .anchor, :host h2:hover .anchor, :host h3:hover .anchor, :host h4:hover .anchor, :host h5:hover .anchor, :host h6:hover .anchor { text-decoration: none; } :host h1:hover .anchor .octicon-link, :host h2:hover .anchor .octicon-link, :host h3:hover .anchor .octicon-link, :host h4:hover .anchor .octicon-link, :host h5:hover .anchor .octicon-link, :host h6:hover .anchor .octicon-link { visibility: visible; } :host h1 tt, :host h1 code, :host h2 tt, :host h2 code, :host h3 tt, :host h3 code, :host h4 tt, :host h4 code, :host h5 tt, :host h5 code, :host h6 tt, :host h6 code { padding: 0 .2em; font-size: inherit; } :host ul.no-list, :host ol.no-list { padding: 0; list-style-type: none; } :host ol[type="1"] { list-style-type: decimal; } :host ol[type=a] { list-style-type: lower-alpha; } :host ol[type=i] { list-style-type: lower-roman; } :host div>ol:not([type]) { list-style-type: decimal; } :host ul ul, :host ul ol, :host ol ol, :host ol ul { margin-top: 0; margin-bottom: 0; } :host li>p { margin-top: 16px; } :host li+li { margin-top: .25em; } :host dl { padding: 0; } :host dl dt { padding: 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: 600; } :host dl dd { padding: 0 16px; margin-bottom: 16px; } :host table th { font-weight: 600; } :host table th, :host table td { padding: 6px 13px; border: 1px solid var(--color-border-default); } :host table tr { background-color: var(--color-canvas-default); border-top: 1px solid var(--color-border-muted); } :host table tr:nth-child(2n) { background-color: var(--color-canvas-subtle); } :host table img { background-color: transparent; } :host img[align=right] { padding-left: 20px; } :host img[align=left] { padding-right: 20px; } :host .emoji { max-width: none; vertical-align: text-top; background-color: transparent; } :host span.frame { display: block; overflow: hidden; } :host span.frame>span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0 0; overflow: hidden; border: 1px solid var(--color-border-default); } :host span.frame span img { display: block; float: left; } :host span.frame span span { display: block; padding: 5px 0 0; clear: both; color: var(--color-fg-default); } :host span.align-center { display: block; overflow: hidden; clear: both; } :host span.align-center>span { display: block; margin: 13px auto 0; overflow: hidden; text-align: center; } :host span.align-center span img { margin: 0 auto; text-align: center; } :host span.align-right { display: block; overflow: hidden; clear: both; } :host span.align-right>span { display: block; margin: 13px 0 0; overflow: hidden; text-align: right; } :host span.align-right span img { margin: 0; text-align: right; } :host span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; } :host span.float-left span { margin: 13px 0 0; } :host span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; } :host span.float-right>span { display: block; margin: 13px auto 0; overflow: hidden; text-align: right; } :host code, :host tt { padding: .2em .4em; margin: 0; font-size: 85%; background-color: var(--color-neutral-muted); border-radius: 6px; } :host code br, :host tt br { display: none; } :host del code { text-decoration: inherit; } :host pre code { font-size: 100%; } :host pre>code { padding: 0; margin: 0; word-break: normal; white-space: pre; background: transparent; border: 0; } :host .highlight { margin-bottom: 16px; } :host .highlight pre { margin-bottom: 0; word-break: normal; } :host .highlight pre, :host pre { position: relative; padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: var(--color-canvas-subtle); border-radius: 6px; } :host pre code, :host pre tt { display: inline; max-width: auto; padding: 0; margin: 0; overflow: visible; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0; } :host .csv-data td, :host .csv-data th { padding: 5px; overflow: hidden; font-size: 12px; line-height: 1; text-align: left; white-space: nowrap; } :host .csv-data .blob-num { padding: 10px 8px 9px; text-align: right; background: var(--color-canvas-default); border: 0; } :host .csv-data tr { border-top: 0; } :host .csv-data th { font-weight: 600; background: var(--color-canvas-subtle); border-top: 0; } :host .footnotes { font-size: 12px; color: var(--color-fg-muted); border-top: 1px solid var(--color-border-default); } :host .footnotes ol { padding-left: 16px; } :host .footnotes li { position: relative; } :host .footnotes li:target::before { position: absolute; top: -8px; right: -8px; bottom: -8px; left: -24px; pointer-events: none; content: ""; border: 2px solid var(--color-accent-emphasis); border-radius: 6px; } :host .footnotes li:target { color: var(--color-fg-default); } :host .footnotes .data-footnote-backref g-emoji { font-family: monospace; } :host .task-list-item { list-style-type: none; } :host .task-list-item label { font-weight: 400; } :host .task-list-item.enabled label { cursor: pointer; } :host .task-list-item+.task-list-item { margin-top: 3px; } :host .task-list-item .handle { display: none; } :host .task-list-item-checkbox, :host input[type="checkbox"] { margin: 0 .2em .25em -1.6em; vertical-align: middle; } :host .contains-task-list:dir(rtl) .task-list-item-checkbox, :host .contains-task-list:dir(rtl) input[type="checkbox"] { margin: 0 -1.6em .25em .2em; } :host ::-webkit-calendar-picker-indicator { filter: invert(50%); }
</style>
`;
// See https://html.spec.whatwg.org/multipage/common-dom-interfaces.html
// #reflecting-content-attributes-in-idl-attributes.
const installStringReflection = (obj, attrName, propName = attrName) => {
    Object.defineProperty(obj, propName, {
        enumerable: true,
        get() {
            const value = this.getAttribute(attrName);
            return value === null ? '' : value;
        },
        set(v) {
            this.setAttribute(attrName, v);
        },
    });
};
class MarkdownStyle extends HTMLElement {
    constructor() {
        super();
        this.initTheme = this.getAttribute('theme');
        this.shadow = this.attachShadow({ mode: 'open' });
        this.shadow.appendChild(__TEMPLATE__.content.cloneNode(true));
        this.warpper = document.createElement('div');
        this.warpper.classList.add('markdown-body');
        this.shadow.appendChild(this.warpper);
        this.setTheme();
        const observer = new MutationObserver(() => {
            Array.prototype.slice.call(this.shadow.host.childNodes).forEach((item) => {
                this.warpper.appendChild(item);
            });
        });
        observer.observe(this.shadow.host, { attributes: true, childList: true });
    }
    setTheme() {
        if (!this.initTheme) {
            const { colorMode } = document.documentElement.dataset;
            this.theme = colorMode;
            if (this.theme === 'undefined') {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    this.theme = 'dark';
                }
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                    this.theme = 'light';
                }
            }
        }
        this.warpper.setAttribute('data-color-mode', this.theme);
    }
    connectedCallback() {
        installStringReflection(this, 'theme');
        if (!this.initTheme) {
            this.setTheme();
            const observer = new MutationObserver((mutationsList, observer) => {
                this.theme = document.documentElement.dataset.colorMode;
                this.setTheme();
            });
            // Start observing the target node with the above configuration
            observer.observe(document.documentElement, { attributes: true });
            window.matchMedia('(prefers-color-scheme: light)').onchange = (event) => {
                this.theme = event.matches ? 'light' : 'dark';
                this.setTheme();
            };
            window.matchMedia('(prefers-color-scheme: dark)').onchange = (event) => {
                this.theme = event.matches ? 'dark' : 'light';
                this.setTheme();
            };
        }
    }
}
customElements.define('markdown-style', MarkdownStyle);
</script><markdown-style style="max-width: 960px; margin: 0 auto 60px auto; padding: 8px" class="markdown-body">
    <p align="center" style="height: 210px; display: flex; align-items: center; justify-content: center;"><a href="http://nginx.org/"><img width="210" src="./nginx.svg"></a></p><!--rehype:style=height: 210px; display: flex; align-items: center; justify-content: center;-->
    <p>Nginx 是一款面向性能设计的 HTTP 服务器，能反向代理 HTTP，HTTPS 和邮件相关(SMTP，POP3，IMAP)的协议链接。并且提供了负载均衡以及 HTTP 缓存。它的设计充分使用异步事件模型，削减上下文调度的开销，提高服务器并发能力。采用了模块化设计，提供了丰富模块的第三方模块。</p>
    <p>所以关于 Nginx，有这些标签：「异步」「事件」「模块化」「高性能」「高并发」「反向代理」「负载均衡」</p>
    <p>
      Linux系统：<code>Centos 7 x64</code>
      Nginx版本：<code>1.11.5</code>
    </p>
    <h1 id="目录"><a class="anchor" aria-hidden="true" tabindex="-1" href="#目录"><span class="octicon octicon-link"></span></a>目录</h1>
    <ul>
      <li><a href="#%E5%AE%89%E8%A3%85">安装</a>
        <ul>
          <li><a href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96">安装依赖</a></li>
          <li><a href="#%E4%B8%8B%E8%BD%BD">下载</a></li>
          <li><a href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85">编译安装</a></li>
          <li><a href="#nginx%E6%B5%8B%E8%AF%95">nginx测试</a></li>
          <li><a href="#%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%80nginx%E5%91%BD%E4%BB%A4">设置全局nginx命令</a></li>
        </ul>
      </li>
      <li><a href="#mac-%E5%AE%89%E8%A3%85">Mac 安装</a>
        <ul>
          <li><a href="#%E5%AE%89%E8%A3%85nginx">安装nginx</a></li>
          <li><a href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1">启动服务</a></li>
        </ul>
      </li>
      <li><a href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8">开机自启动</a></li>
      <li><a href="#%E8%BF%90%E7%BB%B4">运维</a>
        <ul>
          <li><a href="#%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86">服务管理</a></li>
          <li><a href="#%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3">重启服务防火墙报错解决</a></li>
        </ul>
      </li>
      <li><a href="#nginx%E5%8D%B8%E8%BD%BD">nginx卸载</a></li>
      <li><a href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">参数说明</a></li>
      <li><a href="#%E9%85%8D%E7%BD%AE">配置</a>
        <ul>
          <li><a href="#%E5%B8%B8%E7%94%A8%E6%AD%A3%E5%88%99">常用正则</a></li>
          <li><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">全局变量</a></li>
          <li><a href="#%E7%AC%A6%E5%8F%B7%E5%8F%82%E8%80%83">符号参考</a></li>
          <li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">配置文件</a></li>
          <li><a href="#%E5%86%85%E7%BD%AE%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F">内置预定义变量</a></li>
          <li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">反向代理</a></li>
          <li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">负载均衡</a>
            <ul>
              <li><a href="#rr">RR</a></li>
              <li><a href="#%E6%9D%83%E9%87%8D">权重</a></li>
              <li><a href="#ip_hash">ip_hash</a></li>
              <li><a href="#fair">fair</a></li>
              <li><a href="#url_hash">url_hash</a></li>
            </ul>
          </li>
          <li><a href="#%E5%B1%8F%E8%94%BDip">屏蔽ip</a></li>
        </ul>
      </li>
      <li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95">第三方模块安装方法</a></li>
      <li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91">重定向</a>
        <ul>
          <li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%95%B4%E4%B8%AA%E7%BD%91%E7%AB%99">重定向整个网站</a></li>
          <li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91%E5%8D%95%E9%A1%B5">重定向单页</a></li>
          <li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%95%B4%E4%B8%AA%E5%AD%90%E8%B7%AF%E5%BE%84">重定向整个子路径</a></li>
        </ul>
      </li>
      <li><a href="#%E6%80%A7%E8%83%BD">性能</a>
        <ul>
          <li><a href="#%E5%86%85%E5%AE%B9%E7%BC%93%E5%AD%98">内容缓存</a></li>
          <li><a href="#gzip%E5%8E%8B%E7%BC%A9">Gzip压缩</a></li>
          <li><a href="#%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6%E7%BC%93%E5%AD%98">打开文件缓存</a></li>
          <li><a href="#ssl%E7%BC%93%E5%AD%98">SSL缓存</a></li>
          <li><a href="#%E4%B8%8A%E6%B8%B8keepalive">上游Keepalive</a></li>
          <li><a href="#%E7%9B%91%E6%8E%A7">监控</a></li>
        </ul>
      </li>
      <li><a href="#%E5%B8%B8%E8%A7%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">常见使用场景</a>
        <ul>
          <li><a href="#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98">跨域问题</a></li>
          <li><a href="#%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%B8%A6www%E7%9A%84%E5%9F%9F%E4%B8%8A%E9%9D%A2">跳转到带www的域上面</a></li>
          <li><a href="#%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91">代理转发</a></li>
          <li><a href="#%E7%9B%91%E6%8E%A7%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF">监控状态信息</a></li>
          <li><a href="#%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91%E8%BF%9E%E6%8E%A5%E6%9B%BF%E6%8D%A2">代理转发连接替换</a></li>
          <li><a href="#ssl%E9%85%8D%E7%BD%AE">ssl配置</a></li>
          <li><a href="#%E5%BC%BA%E5%88%B6%E5%B0%86http%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0https">强制将http重定向到https</a></li>
          <li><a href="#%E4%B8%A4%E4%B8%AA%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA">两个虚拟主机</a></li>
          <li><a href="#%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%A0%87%E5%87%86%E9%85%8D%E7%BD%AE">虚拟主机标准配置</a></li>
          <li><a href="#%E7%88%AC%E8%99%AB%E8%BF%87%E6%BB%A4">爬虫过滤</a></li>
          <li><a href="#%E9%98%B2%E7%9B%97%E9%93%BE">防盗链</a></li>
          <li><a href="#%E8%99%9A%E6%8B%9F%E7%9B%AE%E5%BD%95%E9%85%8D%E7%BD%AE">虚拟目录配置</a></li>
          <li><a href="#%E9%98%B2%E7%9B%97%E5%9B%BE%E9%85%8D%E7%BD%AE">防盗图配置</a></li>
          <li><a href="#%E5%B1%8F%E8%94%BDgit%E7%AD%89%E6%96%87%E4%BB%B6">屏蔽.git等文件</a></li>
          <li><a href="#%E5%9F%9F%E5%90%8D%E8%B7%AF%E5%BE%84%E5%8A%A0%E4%B8%8D%E5%8A%A0%E9%9C%80%E8%A6%81%E9%83%BD%E8%83%BD%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE">域名路径加不加需要都能正常访问</a></li>
          <li><a href="#cockpit">cockpit</a></li>
        </ul>
      </li>
      <li><a href="#%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98">错误问题</a></li>
      <li><a href="#%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0%E5%8F%82%E8%80%83">精品文章参考</a></li>
    </ul>
    <h2 id="安装"><a class="anchor" aria-hidden="true" tabindex="-1" href="#安装"><span class="octicon octicon-link"></span></a>安装</h2>
    <h3 id="安装依赖"><a class="anchor" aria-hidden="true" tabindex="-1" href="#安装依赖"><span class="octicon octicon-link"></span></a>安装依赖</h3>
    <blockquote>
      <p>prce(重定向支持)和openssl(https支持，如果不需要https可以不安装。)</p>
    </blockquote>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">yum <span class="token function">install</span> -y pcre-devel 
</span><span class="code-line">yum -y <span class="token function">install</span> gcc <span class="token function">make</span> gcc-c++ <span class="token function">wget</span>
</span><span class="code-line">yum -y <span class="token function">install</span> openssl openssl-devel 
</span></code><div onclick="copied(this)" data-code="yum install -y pcre-devel 
yum -y install gcc make gcc-c++ wget
yum -y install openssl openssl-devel 
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>CentOS 6.5 我安装的时候是选择的“基本服务器”，默认这两个包都没安装全，所以这两个都运行安装即可。</p>
    <h3 id="下载"><a class="anchor" aria-hidden="true" tabindex="-1" href="#下载"><span class="octicon octicon-link"></span></a>下载</h3>
    <p><a href="http://nginx.org/download/">nginx的所有版本在这里</a></p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">wget</span> http://nginx.org/download/nginx-1.13.3.tar.gz
</span><span class="code-line"><span class="token function">wget</span> http://nginx.org/download/nginx-1.13.7.tar.gz
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 如果没有安装wget</span>
</span><span class="code-line"><span class="token comment"># 下载已编译版本</span>
</span><span class="code-line">$ yum <span class="token function">install</span> <span class="token function">wget</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 解压压缩包</span>
</span><span class="code-line"><span class="token function">tar</span> zxf nginx-1.13.3.tar.gz
</span></code><div onclick="copied(this)" data-code="wget http://nginx.org/download/nginx-1.13.3.tar.gz
wget http://nginx.org/download/nginx-1.13.7.tar.gz

# 如果没有安装wget
# 下载已编译版本
$ yum install wget

# 解压压缩包
tar zxf nginx-1.13.3.tar.gz
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="编译安装"><a class="anchor" aria-hidden="true" tabindex="-1" href="#编译安装"><span class="octicon octicon-link"></span></a>编译安装</h3>
    <p>然后进入目录编译安装，<a href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">configure参数说明</a></p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token builtin class-name">cd</span> nginx-1.11.5
</span><span class="code-line">./configure
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">..</span><span class="token punctuation">..</span>
</span><span class="code-line">Configuration summary
</span><span class="code-line">  + using system PCRE library
</span><span class="code-line">  + OpenSSL library is not used
</span><span class="code-line">  + using system zlib library
</span><span class="code-line">
</span><span class="code-line">  nginx path prefix: <span class="token string">"/usr/local/nginx"</span>
</span><span class="code-line">  nginx binary file: <span class="token string">"/usr/local/nginx/sbin/nginx"</span>
</span><span class="code-line">  nginx modules path: <span class="token string">"/usr/local/nginx/modules"</span>
</span><span class="code-line">  nginx configuration prefix: <span class="token string">"/usr/local/nginx/conf"</span>
</span><span class="code-line">  nginx configuration file: <span class="token string">"/usr/local/nginx/conf/nginx.conf"</span>
</span><span class="code-line">  nginx pid file: <span class="token string">"/usr/local/nginx/logs/nginx.pid"</span>
</span><span class="code-line">  nginx error log file: <span class="token string">"/usr/local/nginx/logs/error.log"</span>
</span><span class="code-line">  nginx http access log file: <span class="token string">"/usr/local/nginx/logs/access.log"</span>
</span><span class="code-line">  nginx http client request body temporary files: <span class="token string">"client_body_temp"</span>
</span><span class="code-line">  nginx http proxy temporary files: <span class="token string">"proxy_temp"</span>
</span><span class="code-line">  nginx http fastcgi temporary files: <span class="token string">"fastcgi_temp"</span>
</span><span class="code-line">  nginx http uwsgi temporary files: <span class="token string">"uwsgi_temp"</span>
</span><span class="code-line">  nginx http scgi temporary files: <span class="token string">"scgi_temp"</span>
</span></code><div onclick="copied(this)" data-code="cd nginx-1.11.5
./configure

....
Configuration summary
  + using system PCRE library
  + OpenSSL library is not used
  + using system zlib library

  nginx path prefix: &#x22;/usr/local/nginx&#x22;
  nginx binary file: &#x22;/usr/local/nginx/sbin/nginx&#x22;
  nginx modules path: &#x22;/usr/local/nginx/modules&#x22;
  nginx configuration prefix: &#x22;/usr/local/nginx/conf&#x22;
  nginx configuration file: &#x22;/usr/local/nginx/conf/nginx.conf&#x22;
  nginx pid file: &#x22;/usr/local/nginx/logs/nginx.pid&#x22;
  nginx error log file: &#x22;/usr/local/nginx/logs/error.log&#x22;
  nginx http access log file: &#x22;/usr/local/nginx/logs/access.log&#x22;
  nginx http client request body temporary files: &#x22;client_body_temp&#x22;
  nginx http proxy temporary files: &#x22;proxy_temp&#x22;
  nginx http fastcgi temporary files: &#x22;fastcgi_temp&#x22;
  nginx http uwsgi temporary files: &#x22;uwsgi_temp&#x22;
  nginx http scgi temporary files: &#x22;scgi_temp&#x22;
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>安装报错误的话比如：“C compiler cc is not found”，这个就是缺少编译环境，安装一下就可以了 <strong>yum -y install gcc make gcc-c++ openssl-devel</strong></p>
    <p>如果没有error信息，就可以执行下边的安装了：</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">make</span>
</span><span class="code-line"><span class="token function">make</span> <span class="token function">install</span>
</span></code><div onclick="copied(this)" data-code="make
make install
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="nginx测试"><a class="anchor" aria-hidden="true" tabindex="-1" href="#nginx测试"><span class="octicon octicon-link"></span></a>nginx测试</h3>
    <p>运行下面命令会出现两个结果，一般情况nginx会安装在<code>/usr/local/nginx</code>目录中</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token builtin class-name">cd</span> /usr/local/nginx/sbin/
</span><span class="code-line">./nginx -t
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span>
</span><span class="code-line"><span class="token comment"># nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span>
</span></code><div onclick="copied(this)" data-code="cd /usr/local/nginx/sbin/
./nginx -t

# nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
# nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="设置全局nginx命令"><a class="anchor" aria-hidden="true" tabindex="-1" href="#设置全局nginx命令"><span class="octicon octicon-link"></span></a>设置全局nginx命令</h3>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">vi</span> ~/.bash_profile
</span></code><div onclick="copied(this)" data-code="vi ~/.bash_profile
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>将下面内容添加到 <code>~/.bash_profile</code> 文件中</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/bin:/usr/local/nginx/sbin/
</span><span class="code-line"><span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span>
</span></code><div onclick="copied(this)" data-code="PATH=$PATH:$HOME/bin:/usr/local/nginx/sbin/
export PATH
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>运行命令 <strong><code>source ~/.bash_profile</code></strong> 让配置立即生效。你就可以全局运行 <code>nginx</code> 命令了。</p>
    <h2 id="mac-安装"><a class="anchor" aria-hidden="true" tabindex="-1" href="#mac-安装"><span class="octicon octicon-link"></span></a>Mac 安装</h2>
    <p>Mac OSX 安装特别简单，首先你需要安装 <a href="https://brew.sh/">Brew</a>， 通过 <code>brew</code> 快速安装 <code>nginx</code>。</p>
    <h3 id="安装nginx"><a class="anchor" aria-hidden="true" tabindex="-1" href="#安装nginx"><span class="octicon octicon-link"></span></a>安装nginx</h3>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">brew <span class="token function">install</span> nginx
</span><span class="code-line"><span class="token comment"># Updating Homebrew...</span>
</span><span class="code-line"><span class="token comment"># ==> Auto-updated Homebrew!</span>
</span><span class="code-line"><span class="token comment"># Updated 2 taps (homebrew/core, homebrew/cask).</span>
</span><span class="code-line"><span class="token comment"># ==> Updated Formulae</span>
</span><span class="code-line"><span class="token comment"># ==> Installing dependencies for nginx: openssl, pcre</span>
</span><span class="code-line"><span class="token comment"># ==> Installing nginx dependency: openssl</span>
</span><span class="code-line"><span class="token comment"># ==> Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz</span>
</span><span class="code-line"><span class="token comment"># ######################################################################## 100.0%</span>
</span><span class="code-line"><span class="token comment"># ==> Pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz</span>
</span><span class="code-line"><span class="token comment"># ==> Caveats</span>
</span><span class="code-line"><span class="token comment"># A CA file has been bootstrapped using certificates from the SystemRoots</span>
</span><span class="code-line"><span class="token comment"># keychain. To add additional certificates (e.g. the certificates added in</span>
</span><span class="code-line"><span class="token comment"># the System keychain), place .pem files in</span>
</span><span class="code-line"><span class="token comment">#   /usr/local/etc/openssl/certs</span>
</span><span class="code-line"><span class="token comment"># </span>
</span><span class="code-line"><span class="token comment"># and run</span>
</span><span class="code-line"><span class="token comment">#   /usr/local/opt/openssl/bin/c_rehash</span>
</span><span class="code-line"><span class="token comment"># </span>
</span><span class="code-line"><span class="token comment"># This formula is keg-only, which means it was not symlinked into /usr/local,</span>
</span><span class="code-line"><span class="token comment"># because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.</span>
</span><span class="code-line"><span class="token comment"># </span>
</span><span class="code-line"><span class="token comment"># If you need to have this software first in your PATH run:</span>
</span><span class="code-line"><span class="token comment">#   echo 'export PATH="/usr/local/opt/openssl/bin:$PATH"' >> ~/.zshrc</span>
</span><span class="code-line"><span class="token comment"># </span>
</span><span class="code-line"><span class="token comment"># For compilers to find this software you may need to set:</span>
</span><span class="code-line"><span class="token comment">#     LDFLAGS:  -L/usr/local/opt/openssl/lib</span>
</span><span class="code-line"><span class="token comment">#     CPPFLAGS: -I/usr/local/opt/openssl/include</span>
</span><span class="code-line"><span class="token comment"># For pkg-config to find this software you may need to set:</span>
</span><span class="code-line"><span class="token comment">#     PKG_CONFIG_PATH: /usr/local/opt/openssl/lib/pkgconfig</span>
</span><span class="code-line"><span class="token comment"># </span>
</span><span class="code-line"><span class="token comment"># ==> Summary</span>
</span><span class="code-line"><span class="token comment"># 🍺  /usr/local/Cellar/openssl/1.0.2o_1: 1,791 files, 12.3MB</span>
</span><span class="code-line"><span class="token comment"># ==> Installing nginx dependency: pcre</span>
</span><span class="code-line"><span class="token comment"># ==> Downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz</span>
</span><span class="code-line"><span class="token comment"># ######################################################################## 100.0%</span>
</span><span class="code-line"><span class="token comment"># ==> Pouring pcre-8.42.high_sierra.bottle.tar.gz</span>
</span><span class="code-line"><span class="token comment"># 🍺  /usr/local/Cellar/pcre/8.42: 204 files, 5.3MB</span>
</span><span class="code-line"><span class="token comment"># ==> Installing nginx</span>
</span><span class="code-line"><span class="token comment"># ==> Downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz</span>
</span><span class="code-line"><span class="token comment"># ######################################################################## 100.0%</span>
</span><span class="code-line"><span class="token comment"># ==> Pouring nginx-1.13.12.high_sierra.bottle.tar.gz</span>
</span><span class="code-line"><span class="token comment"># ==> Caveats</span>
</span><span class="code-line"><span class="token comment"># Docroot is: /usr/local/var/www</span>
</span><span class="code-line"><span class="token comment"># </span>
</span><span class="code-line"><span class="token comment"># The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</span>
</span><span class="code-line"><span class="token comment"># nginx can run without sudo.</span>
</span><span class="code-line"><span class="token comment"># </span>
</span><span class="code-line"><span class="token comment"># nginx will load all files in /usr/local/etc/nginx/servers/.</span>
</span><span class="code-line"><span class="token comment"># </span>
</span><span class="code-line"><span class="token comment"># To have launchd start nginx now and restart at login:</span>
</span><span class="code-line"><span class="token comment">#   brew services start nginx</span>
</span><span class="code-line"><span class="token comment"># Or, if you don't wacd /usr/local/Cellar/nginx/1.13.12/n just run:</span>
</span><span class="code-line"><span class="token comment"># cd /usr/local/Cellar/nginx/1.13.12/</span>
</span></code><div onclick="copied(this)" data-code="brew install nginx
# Updating Homebrew...
# ==> Auto-updated Homebrew!
# Updated 2 taps (homebrew/core, homebrew/cask).
# ==> Updated Formulae
# ==> Installing dependencies for nginx: openssl, pcre
# ==> Installing nginx dependency: openssl
# ==> Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz
# ######################################################################## 100.0%
# ==> Pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz
# ==> Caveats
# A CA file has been bootstrapped using certificates from the SystemRoots
# keychain. To add additional certificates (e.g. the certificates added in
# the System keychain), place .pem files in
#   /usr/local/etc/openssl/certs
# 
# and run
#   /usr/local/opt/openssl/bin/c_rehash
# 
# This formula is keg-only, which means it was not symlinked into /usr/local,
# because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.
# 
# If you need to have this software first in your PATH run:
#   echo &#x27;export PATH=&#x22;/usr/local/opt/openssl/bin:$PATH&#x22;&#x27; >> ~/.zshrc
# 
# For compilers to find this software you may need to set:
#     LDFLAGS:  -L/usr/local/opt/openssl/lib
#     CPPFLAGS: -I/usr/local/opt/openssl/include
# For pkg-config to find this software you may need to set:
#     PKG_CONFIG_PATH: /usr/local/opt/openssl/lib/pkgconfig
# 
# ==> Summary
# 🍺  /usr/local/Cellar/openssl/1.0.2o_1: 1,791 files, 12.3MB
# ==> Installing nginx dependency: pcre
# ==> Downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz
# ######################################################################## 100.0%
# ==> Pouring pcre-8.42.high_sierra.bottle.tar.gz
# 🍺  /usr/local/Cellar/pcre/8.42: 204 files, 5.3MB
# ==> Installing nginx
# ==> Downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz
# ######################################################################## 100.0%
# ==> Pouring nginx-1.13.12.high_sierra.bottle.tar.gz
# ==> Caveats
# Docroot is: /usr/local/var/www
# 
# The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that
# nginx can run without sudo.
# 
# nginx will load all files in /usr/local/etc/nginx/servers/.
# 
# To have launchd start nginx now and restart at login:
#   brew services start nginx
# Or, if you don&#x27;t wacd /usr/local/Cellar/nginx/1.13.12/n just run:
# cd /usr/local/Cellar/nginx/1.13.12/
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="启动服务"><a class="anchor" aria-hidden="true" tabindex="-1" href="#启动服务"><span class="octicon octicon-link"></span></a>启动服务</h3>
    <p>注意默认端口不是 <code>8080</code> 查看确认端口是否被占用。</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">brew services start nginx
</span><span class="code-line"><span class="token comment"># http://localhost:8080/</span>
</span></code><div onclick="copied(this)" data-code="brew services start nginx
# http://localhost:8080/
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="开机自启动"><a class="anchor" aria-hidden="true" tabindex="-1" href="#开机自启动"><span class="octicon octicon-link"></span></a>开机自启动</h2>
    <p><strong>开机自启动方法一：</strong></p>
    <p>编辑 <strong>vi /lib/systemd/system/nginx.service</strong> 文件，没有创建一个 <strong>touch nginx.service</strong> 然后将如下内容根据具体情况进行修改后，添加到nginx.service文件中：</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token assign-left variable">Description</span><span class="token operator">=</span>nginx
</span><span class="code-line"><span class="token assign-left variable">After</span><span class="token operator">=</span>network.target remote-fs.target nss-lookup.target
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
</span><span class="code-line"><span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/var/run/nginx.pid
</span><span class="code-line"><span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
</span><span class="code-line"><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
</span><span class="code-line"><span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill -s HUP <span class="token variable">$MAINPID</span>
</span><span class="code-line"><span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/bin/kill -s QUIT <span class="token variable">$MAINPID</span>
</span><span class="code-line"><span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</span></code><div onclick="copied(this)" data-code="[Unit]
Description=nginx
After=network.target remote-fs.target nss-lookup.target

[Service]

Type=forking
PIDFile=/var/run/nginx.pid
ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s QUIT $MAINPID
PrivateTmp=true

[Install]
WantedBy=multi-user.target
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <ul>
      <li><code>[Unit]</code>:服务的说明</li>
      <li><code>Description</code>:描述服务</li>
      <li><code>After</code>:描述服务类别</li>
      <li><code>[Service]</code>服务运行参数的设置</li>
      <li><code>Type=forking</code>是后台运行的形式</li>
      <li><code>ExecStart</code>为服务的具体运行命令</li>
      <li><code>ExecReload</code>为重启命令</li>
      <li><code>ExecStop</code>为停止命令</li>
      <li><code>PrivateTmp=True</code>表示给服务分配独立的临时空间</li>
    </ul>
    <p>注意：<code>[Service]</code>的启动、重启、停止命令全部要求使用绝对路径。</p>
    <p><code>[Install]</code>运行级别下服务安装的相关设置，可设置为多用户，即系统运行级别为<code>3</code>。</p>
    <p>保存退出。</p>
    <p>设置开机启动，使配置生效：</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># 启动nginx服务</span>
</span><span class="code-line">systemctl start nginx.service
</span><span class="code-line"><span class="token comment"># 停止开机自启动</span>
</span><span class="code-line">systemctl disable nginx.service
</span><span class="code-line"><span class="token comment"># 查看服务当前状态</span>
</span><span class="code-line">systemctl status nginx.service
</span><span class="code-line"><span class="token comment"># 查看所有已启动的服务</span>
</span><span class="code-line">systemctl list-units --type<span class="token operator">=</span>service
</span><span class="code-line"><span class="token comment"># 重新启动服务</span>
</span><span class="code-line">systemctl restart nginx.service
</span><span class="code-line"><span class="token comment"># 设置开机自启动</span>
</span><span class="code-line">systemctl <span class="token builtin class-name">enable</span> nginx.service
</span><span class="code-line"><span class="token comment"># 输出下面内容表示成功了</span>
</span><span class="code-line">Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.
</span></code><div onclick="copied(this)" data-code="# 启动nginx服务
systemctl start nginx.service
# 停止开机自启动
systemctl disable nginx.service
# 查看服务当前状态
systemctl status nginx.service
# 查看所有已启动的服务
systemctl list-units --type=service
# 重新启动服务
systemctl restart nginx.service
# 设置开机自启动
systemctl enable nginx.service
# 输出下面内容表示成功了
Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">systemctl is-enabled servicename.service <span class="token comment"># 查询服务是否开机启动</span>
</span><span class="code-line">systemctl <span class="token builtin class-name">enable</span> *.service <span class="token comment"># 开机运行服务</span>
</span><span class="code-line">systemctl disable *.service <span class="token comment"># 取消开机运行</span>
</span><span class="code-line">systemctl start *.service <span class="token comment"># 启动服务</span>
</span><span class="code-line">systemctl stop *.service <span class="token comment"># 停止服务</span>
</span><span class="code-line">systemctl restart *.service <span class="token comment"># 重启服务</span>
</span><span class="code-line">systemctl reload *.service <span class="token comment"># 重新加载服务配置文件</span>
</span><span class="code-line">systemctl status *.service <span class="token comment"># 查询服务运行状态</span>
</span><span class="code-line">systemctl --failed <span class="token comment"># 显示启动失败的服务</span>
</span></code><div onclick="copied(this)" data-code="systemctl is-enabled servicename.service # 查询服务是否开机启动
systemctl enable *.service # 开机运行服务
systemctl disable *.service # 取消开机运行
systemctl start *.service # 启动服务
systemctl stop *.service # 停止服务
systemctl restart *.service # 重启服务
systemctl reload *.service # 重新加载服务配置文件
systemctl status *.service # 查询服务运行状态
systemctl --failed # 显示启动失败的服务
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>注：*代表某个服务的名字，如http的服务名为httpd</p>
    <p><strong>开机自启动方法二：</strong></p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">vi</span> /etc/rc.local
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 在 rc.local 文件中，添加下面这条命令</span>
</span><span class="code-line">/usr/local/nginx/sbin/nginx start
</span></code><div onclick="copied(this)" data-code="vi /etc/rc.local

# 在 rc.local 文件中，添加下面这条命令
/usr/local/nginx/sbin/nginx start
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>如果开机后发现自启动脚本没有执行，你要去确认一下rc.local这个文件的访问权限是否是可执行的，因为rc.local默认是不可执行的。修改rc.local访问权限，增加可执行权限：</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># /etc/rc.local是/etc/rc.d/rc.local的软连接，</span>
</span><span class="code-line"><span class="token function">chmod</span> +x /etc/rc.d/rc.local
</span></code><div onclick="copied(this)" data-code="# /etc/rc.local是/etc/rc.d/rc.local的软连接，
chmod +x /etc/rc.d/rc.local
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>官方脚本 <a href="https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/">ed Hat NGINX Init Script</a>。</p>
    <h2 id="运维"><a class="anchor" aria-hidden="true" tabindex="-1" href="#运维"><span class="octicon octicon-link"></span></a>运维</h2>
    <h3 id="服务管理"><a class="anchor" aria-hidden="true" tabindex="-1" href="#服务管理"><span class="octicon octicon-link"></span></a>服务管理</h3>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># 启动</span>
</span><span class="code-line">/usr/local/nginx/sbin/nginx
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 重启</span>
</span><span class="code-line">/usr/local/nginx/sbin/nginx -s reload
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 关闭进程</span>
</span><span class="code-line">/usr/local/nginx/sbin/nginx -s stop
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 平滑关闭nginx</span>
</span><span class="code-line">/usr/local/nginx/sbin/nginx -s quit
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 查看nginx的安装状态，</span>
</span><span class="code-line">/usr/local/nginx/sbin/nginx -V 
</span></code><div onclick="copied(this)" data-code="# 启动
/usr/local/nginx/sbin/nginx

# 重启
/usr/local/nginx/sbin/nginx -s reload

# 关闭进程
/usr/local/nginx/sbin/nginx -s stop

# 平滑关闭nginx
/usr/local/nginx/sbin/nginx -s quit

# 查看nginx的安装状态，
/usr/local/nginx/sbin/nginx -V 
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p><strong>关闭防火墙，或者添加防火墙规则就可以测试了</strong></p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">service</span> iptables stop
</span></code><div onclick="copied(this)" data-code="service iptables stop
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>或者编辑配置文件：</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">vi</span> /etc/sysconfig/iptables
</span></code><div onclick="copied(this)" data-code="vi /etc/sysconfig/iptables
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>添加这样一条开放80端口的规则后保存：</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="token number">80</span> -j ACCEPT
</span></code><div onclick="copied(this)" data-code="-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>重启服务即可:</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">service</span> iptables restart
</span><span class="code-line"><span class="token comment"># 命令进行查看目前nat</span>
</span><span class="code-line">iptables -t nat -L
</span></code><div onclick="copied(this)" data-code="service iptables restart
# 命令进行查看目前nat
iptables -t nat -L
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="重启服务防火墙报错解决"><a class="anchor" aria-hidden="true" tabindex="-1" href="#重启服务防火墙报错解决"><span class="octicon octicon-link"></span></a>重启服务防火墙报错解决</h3>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">service</span> iptables restart
</span><span class="code-line"><span class="token comment"># Redirecting to /bin/systemctl restart  iptables.service</span>
</span><span class="code-line"><span class="token comment"># Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.</span>
</span></code><div onclick="copied(this)" data-code="service iptables restart
# Redirecting to /bin/systemctl restart  iptables.service
# Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>
      在CentOS 7或RHEL 7或Fedora中防火墙由 <strong>firewalld</strong> 来管理，当然你可以还原传统的管理方式。或则使用新的命令进行管理。
      假如采用传统请执行一下命令：
    </p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># 传统命令</span>
</span><span class="code-line">systemctl stop firewalld
</span><span class="code-line">systemctl mask firewalld
</span></code><div onclick="copied(this)" data-code="# 传统命令
systemctl stop firewalld
systemctl mask firewalld
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># 安装命令</span>
</span><span class="code-line">yum <span class="token function">install</span> iptables-services
</span><span class="code-line">
</span><span class="code-line">systemctl <span class="token builtin class-name">enable</span> iptables 
</span><span class="code-line"><span class="token function">service</span> iptables restart
</span></code><div onclick="copied(this)" data-code="# 安装命令
yum install iptables-services

systemctl enable iptables 
service iptables restart
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="nginx卸载"><a class="anchor" aria-hidden="true" tabindex="-1" href="#nginx卸载"><span class="octicon octicon-link"></span></a>nginx卸载</h2>
    <p>如果通过yum安装，使用下面命令安装。</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">yum remove nginx
</span></code><div onclick="copied(this)" data-code="yum remove nginx
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>
      编译安装，删除/usr/local/nginx目录即可
      如果配置了自启动脚本，也需要删除。
    </p>
    <h2 id="参数说明"><a class="anchor" aria-hidden="true" tabindex="-1" href="#参数说明"><span class="octicon octicon-link"></span></a>参数说明</h2>
    <table>
      <thead>
        <tr>
          <th>参数</th>
          <th>说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>--prefix=<code>&#x3C;path></code></td>
          <td>Nginx安装路径。如果没有指定，默认为 /usr/local/nginx。</td>
        </tr>
        <tr>
          <td>--sbin-path=<code>&#x3C;path></code></td>
          <td>Nginx可执行文件安装路径。只能安装时指定，如果没有指定，默认为<code>&#x3C;prefix></code>/sbin/nginx。</td>
        </tr>
        <tr>
          <td>--conf-path=<code>&#x3C;path></code></td>
          <td>在没有给定-c选项下默认的nginx.conf的路径。如果没有指定，默认为<code>&#x3C;prefix></code>/conf/nginx.conf。</td>
        </tr>
        <tr>
          <td>--pid-path=<code>&#x3C;path></code></td>
          <td>在nginx.conf中没有指定pid指令的情况下，默认的nginx.pid的路径。如果没有指定，默认为 <code>&#x3C;prefix></code>/logs/nginx.pid。</td>
        </tr>
        <tr>
          <td>--lock-path=<code>&#x3C;path></code></td>
          <td>nginx.lock文件的路径。</td>
        </tr>
        <tr>
          <td>--error-log-path=<code>&#x3C;path></code></td>
          <td>在nginx.conf中没有指定error_log指令的情况下，默认的错误日志的路径。如果没有指定，默认为 <code>&#x3C;prefix></code>/- logs/error.log。</td>
        </tr>
        <tr>
          <td>--http-log-path=<code>&#x3C;path></code></td>
          <td>在nginx.conf中没有指定access_log指令的情况下，默认的访问日志的路径。如果没有指定，默认为 <code>&#x3C;prefix></code>/- logs/access.log。</td>
        </tr>
        <tr>
          <td>--user=<code>&#x3C;user></code></td>
          <td>在nginx.conf中没有指定user指令的情况下，默认的nginx使用的用户。如果没有指定，默认为 nobody。</td>
        </tr>
        <tr>
          <td>--group=<code>&#x3C;group></code></td>
          <td>在nginx.conf中没有指定user指令的情况下，默认的nginx使用的组。如果没有指定，默认为 nobody。</td>
        </tr>
        <tr>
          <td>--builddir=DIR</td>
          <td>指定编译的目录</td>
        </tr>
        <tr>
          <td>--with-rtsig_module</td>
          <td>启用 rtsig 模块</td>
        </tr>
        <tr>
          <td>--with-select_module --without-select_module</td>
          <td>允许或不允许开启SELECT模式，如果 configure 没有找到更合适的模式，比如：kqueue(sun os),epoll (linux kenel 2.6+), rtsig(- 实时信号)或者/dev/poll(一种类似select的模式，底层实现与SELECT基本相 同，都是采用轮训方法) SELECT模式将是默认安装模式</td>
        </tr>
        <tr>
          <td>--with-poll_module --without-poll_module</td>
          <td>Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or /dev/poll is not discovered by configure.</td>
        </tr>
        <tr>
          <td>--with-http_ssl_module</td>
          <td>Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. 开启HTTP SSL模块，使NGINX可以支持HTTPS请求。这个模块需要已经安装了OPENSSL，在DEBIAN上是libssl</td>
        </tr>
        <tr>
          <td>--with-http_realip_module</td>
          <td>启用 ngx_http_realip_module</td>
        </tr>
        <tr>
          <td>--with-http_addition_module</td>
          <td>启用 ngx_http_addition_module</td>
        </tr>
        <tr>
          <td>--with-http_sub_module</td>
          <td>启用 ngx_http_sub_module</td>
        </tr>
        <tr>
          <td>--with-http_dav_module</td>
          <td>启用 ngx_http_dav_module</td>
        </tr>
        <tr>
          <td>--with-http_flv_module</td>
          <td>启用 ngx_http_flv_module</td>
        </tr>
        <tr>
          <td>--with-http_stub_status_module</td>
          <td>启用 "server status" 页</td>
        </tr>
        <tr>
          <td>--without-http_charset_module</td>
          <td>禁用 ngx_http_charset_module</td>
        </tr>
        <tr>
          <td>--without-http_gzip_module</td>
          <td>禁用 ngx_http_gzip_module. 如果启用，需要 zlib 。</td>
        </tr>
        <tr>
          <td>--without-http_ssi_module</td>
          <td>禁用 ngx_http_ssi_module</td>
        </tr>
        <tr>
          <td>--without-http_userid_module</td>
          <td>禁用 ngx_http_userid_module</td>
        </tr>
        <tr>
          <td>--without-http_access_module</td>
          <td>禁用 ngx_http_access_module</td>
        </tr>
        <tr>
          <td>--without-http_auth_basic_module</td>
          <td>禁用 ngx_http_auth_basic_module</td>
        </tr>
        <tr>
          <td>--without-http_autoindex_module</td>
          <td>禁用 ngx_http_autoindex_module</td>
        </tr>
        <tr>
          <td>--without-http_geo_module</td>
          <td>禁用 ngx_http_geo_module</td>
        </tr>
        <tr>
          <td>--without-http_map_module</td>
          <td>禁用 ngx_http_map_module</td>
        </tr>
        <tr>
          <td>--without-http_referer_module</td>
          <td>禁用 ngx_http_referer_module</td>
        </tr>
        <tr>
          <td>--without-http_rewrite_module</td>
          <td>禁用 ngx_http_rewrite_module. 如果启用需要 PCRE 。</td>
        </tr>
        <tr>
          <td>--without-http_proxy_module</td>
          <td>禁用 ngx_http_proxy_module</td>
        </tr>
        <tr>
          <td>--without-http_fastcgi_module</td>
          <td>禁用 ngx_http_fastcgi_module</td>
        </tr>
        <tr>
          <td>--without-http_memcached_module</td>
          <td>禁用 ngx_http_memcached_module</td>
        </tr>
        <tr>
          <td>--without-http_limit_zone_module</td>
          <td>禁用 ngx_http_limit_zone_module</td>
        </tr>
        <tr>
          <td>--without-http_empty_gif_module</td>
          <td>禁用 ngx_http_empty_gif_module</td>
        </tr>
        <tr>
          <td>--without-http_browser_module</td>
          <td>禁用 ngx_http_browser_module</td>
        </tr>
        <tr>
          <td>--without-http_upstream_ip_hash_module</td>
          <td>禁用 ngx_http_upstream_ip_hash_module</td>
        </tr>
        <tr>
          <td>--with-http_perl_module</td>
          <td>启用 ngx_http_perl_module</td>
        </tr>
        <tr>
          <td>--with-perl_modules_path=PATH</td>
          <td>指定 perl 模块的路径</td>
        </tr>
        <tr>
          <td>--with-perl=PATH</td>
          <td>指定 perl 执行文件的路径</td>
        </tr>
        <tr>
          <td>--http-log-path=PATH</td>
          <td>Set path to the http access log</td>
        </tr>
        <tr>
          <td>--http-client-body-temp-path=PATH</td>
          <td>Set path to the http client request body temporary files</td>
        </tr>
        <tr>
          <td>--http-proxy-temp-path=PATH</td>
          <td>Set path to the http proxy temporary files</td>
        </tr>
        <tr>
          <td>--http-fastcgi-temp-path=PATH</td>
          <td>Set path to the http fastcgi temporary files</td>
        </tr>
        <tr>
          <td>--without-http</td>
          <td>禁用 HTTP server</td>
        </tr>
        <tr>
          <td>--with-mail</td>
          <td>启用 IMAP4/POP3/SMTP 代理模块</td>
        </tr>
        <tr>
          <td>--with-mail_ssl_module</td>
          <td>启用 ngx_mail_ssl_module</td>
        </tr>
        <tr>
          <td>--with-cc=PATH</td>
          <td>指定 C 编译器的路径</td>
        </tr>
        <tr>
          <td>--with-cpp=PATH</td>
          <td>指定 C 预处理器的路径</td>
        </tr>
        <tr>
          <td>--with-cc-opt=OPTIONS</td>
          <td>Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate --with-cc-opt="-I /usr/local/include". If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: --with-cc-opt="-D FD_SETSIZE=2048".</td>
        </tr>
        <tr>
          <td>--with-ld-opt=OPTIONS</td>
          <td>Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate --with-ld-opt="-L /usr/local/lib".</td>
        </tr>
        <tr>
          <td>--with-cpu-opt=CPU</td>
          <td>为特定的 CPU 编译，有效的值包括：pentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64</td>
        </tr>
        <tr>
          <td>--without-pcre</td>
          <td>禁止 PCRE 库的使用。同时也会禁止 HTTP rewrite 模块。在 "location" 配置指令中的正则表达式也需要 PCRE 。</td>
        </tr>
        <tr>
          <td>--with-pcre=DIR</td>
          <td>指定 PCRE 库的源代码的路径。</td>
        </tr>
        <tr>
          <td>--with-pcre-opt=OPTIONS</td>
          <td>Set additional options for PCRE building.</td>
        </tr>
        <tr>
          <td>--with-md5=DIR</td>
          <td>Set path to md5 library sources.</td>
        </tr>
        <tr>
          <td>--with-md5-opt=OPTIONS</td>
          <td>Set additional options for md5 building.</td>
        </tr>
        <tr>
          <td>--with-md5-asm</td>
          <td>Use md5 assembler sources.</td>
        </tr>
        <tr>
          <td>--with-sha1=DIR</td>
          <td>Set path to sha1 library sources.</td>
        </tr>
        <tr>
          <td>--with-sha1-opt=OPTIONS</td>
          <td>Set additional options for sha1 building.</td>
        </tr>
        <tr>
          <td>--with-sha1-asm</td>
          <td>Use sha1 assembler sources.</td>
        </tr>
        <tr>
          <td>--with-zlib=DIR</td>
          <td>Set path to zlib library sources.</td>
        </tr>
        <tr>
          <td>--with-zlib-opt=OPTIONS</td>
          <td>Set additional options for zlib building.</td>
        </tr>
        <tr>
          <td>--with-zlib-asm=CPU</td>
          <td>Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro</td>
        </tr>
        <tr>
          <td>--with-openssl=DIR</td>
          <td>Set path to OpenSSL library sources</td>
        </tr>
        <tr>
          <td>--with-openssl-opt=OPTIONS</td>
          <td>Set additional options for OpenSSL building</td>
        </tr>
        <tr>
          <td>--with-debug</td>
          <td>启用调试日志</td>
        </tr>
        <tr>
          <td>--add-module=PATH</td>
          <td>Add in a third-party module found in directory PATH</td>
        </tr>
      </tbody>
    </table>
    <h2 id="配置"><a class="anchor" aria-hidden="true" tabindex="-1" href="#配置"><span class="octicon octicon-link"></span></a>配置</h2>
    <p>在Centos 默认配置文件在 <strong>/usr/local/nginx-1.5.1/conf/nginx.conf</strong> 我们要在这里配置一些文件。nginx.conf是主配置文件，由若干个部分组成，每个大括号<code>{}</code>表示一个部分。每一行指令都由分号结束<code>;</code>，标志着一行的结束。</p>
    <h3 id="常用正则"><a class="anchor" aria-hidden="true" tabindex="-1" href="#常用正则"><span class="octicon octicon-link"></span></a>常用正则</h3>
    <table>
      <thead>
        <tr>
          <th>正则</th>
          <th>说明</th>
          <th>正则</th>
          <th>说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>.</code></td>
          <td>匹配除换行符以外的任意字符</td>
          <td><code>$</code></td>
          <td>匹配字符串的结束</td>
        </tr>
        <tr>
          <td><code>?</code></td>
          <td>重复0次或1次</td>
          <td><code>{n}</code></td>
          <td>重复n次</td>
        </tr>
        <tr>
          <td><code>+</code></td>
          <td>重复1次或更多次</td>
          <td><code>{n,}</code></td>
          <td>重复n次或更多次</td>
        </tr>
        <tr>
          <td><code>*</code></td>
          <td>重复0次或更多次</td>
          <td><code>[c]</code></td>
          <td>匹配单个字符c</td>
        </tr>
        <tr>
          <td><code>\d</code></td>
          <td>匹配数字</td>
          <td><code>[a-z]</code></td>
          <td>匹配a-z小写字母的任意一个</td>
        </tr>
        <tr>
          <td><code>^</code></td>
          <td>匹配字符串的开始</td>
          <td>-</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
    <h3 id="全局变量"><a class="anchor" aria-hidden="true" tabindex="-1" href="#全局变量"><span class="octicon octicon-link"></span></a>全局变量</h3>
    <table>
      <thead>
        <tr>
          <th>变量</th>
          <th>说明</th>
          <th>变量</th>
          <th>说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>$args</td>
          <td>这个变量等于请求行中的参数，同$query_string</td>
          <td>$remote_port</td>
          <td>客户端的端口。</td>
        </tr>
        <tr>
          <td>$content_length</td>
          <td>请求头中的Content-length字段。</td>
          <td>$remote_user</td>
          <td>已经经过Auth Basic Module验证的用户名。</td>
        </tr>
        <tr>
          <td>$content_type</td>
          <td>请求头中的Content-Type字段。</td>
          <td>$request_filename</td>
          <td>当前请求的文件路径，由root或alias指令与URI请求生成。</td>
        </tr>
        <tr>
          <td>$document_root</td>
          <td>当前请求在root指令中指定的值。</td>
          <td>$scheme</td>
          <td>HTTP方法（如http，https）。</td>
        </tr>
        <tr>
          <td>$host</td>
          <td>请求主机头字段，否则为服务器名称。</td>
          <td>$server_protocol</td>
          <td>请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</td>
        </tr>
        <tr>
          <td>$http_user_agent</td>
          <td>客户端agent信息</td>
          <td>$server_addr</td>
          <td>服务器地址，在完成一次系统调用后可以确定这个值。</td>
        </tr>
        <tr>
          <td>$http_cookie</td>
          <td>客户端cookie信息</td>
          <td>$server_name</td>
          <td>服务器名称。</td>
        </tr>
        <tr>
          <td>$limit_rate</td>
          <td>这个变量可以限制连接速率。</td>
          <td>$server_port</td>
          <td>请求到达服务器的端口号。</td>
        </tr>
        <tr>
          <td>$request_method</td>
          <td>客户端请求的动作，通常为GET或POST。</td>
          <td>$request_uri</td>
          <td>包含请求参数的原始URI，不包含主机名，如：/foo/bar.php?arg=baz。</td>
        </tr>
        <tr>
          <td>$remote_addr</td>
          <td>客户端的IP地址。</td>
          <td>$uri</td>
          <td>不带请求参数的当前URI，$uri不包含主机名，如/foo/bar.html。</td>
        </tr>
        <tr>
          <td>$document_uri</td>
          <td>与$uri相同。</td>
          <td>-</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
    <p>例如请求：<code>http://localhost:3000/test1/test2/test.php</code></p>
    <p>$host：localhost<br>$server_port：3000<br>$request_uri：/test1/test2/test.php<br>$document_uri：/test1/test2/test.php<br>$document_root：/var/www/html<br>$request_filename：/var/www/html/test1/test2/test.php</p>
    <h3 id="符号参考"><a class="anchor" aria-hidden="true" tabindex="-1" href="#符号参考"><span class="octicon octicon-link"></span></a>符号参考</h3>
    <table>
      <thead>
        <tr>
          <th>符号</th>
          <th>说明</th>
          <th>符号</th>
          <th>说明</th>
          <th>符号</th>
          <th>说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>k,K</td>
          <td>千字节</td>
          <td>m,M</td>
          <td>兆字节</td>
          <td>ms</td>
          <td>毫秒</td>
        </tr>
        <tr>
          <td>s</td>
          <td>秒</td>
          <td>m</td>
          <td>分钟</td>
          <td>h</td>
          <td>小时</td>
        </tr>
        <tr>
          <td>d</td>
          <td>日</td>
          <td>w</td>
          <td>周</td>
          <td>M</td>
          <td>一个月, 30天</td>
        </tr>
      </tbody>
    </table>
    <p>例如，"8k"，"1m" 代表字节数计量。<br>例如，"1h 30m"，"1y 6M"。代表 "1小时 30分"，"1年零6个月"。</p>
    <h3 id="配置文件"><a class="anchor" aria-hidden="true" tabindex="-1" href="#配置文件"><span class="octicon octicon-link"></span></a>配置文件</h3>
    <p>nginx 的配置系统由一个主配置文件和其他一些辅助的配置文件构成。这些配置文件均是纯文本文件，全部位于 nginx 安装目录下的 conf 目录下。</p>
    <p>
      指令由 nginx 的各个模块提供，不同的模块会提供不同的指令来实现配置。
      指令除了 Key-Value 的形式，还有作用域指令。
    </p>
    <p>nginx.conf 中的配置信息，根据其逻辑上的意义，对它们进行了分类，也就是分成了多个作用域，或者称之为配置指令上下文。不同的作用域含有一个或者多个配置项。</p>
    <p>下面的这些上下文指令是用的比较多：</p>
    <table>
      <thead>
        <tr>
          <th>Directive</th>
          <th>Description</th>
          <th>Contains Directive</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>main</td>
          <td>nginx 在运行时与具体业务功能（比如 http 服务或者 email 服务代理）无关的一些参数，比如工作进程数，运行的身份等。</td>
          <td>user, worker_processes, error_log, events, http, mail</td>
        </tr>
        <tr>
          <td>http</td>
          <td>与提供 http 服务相关的一些配置参数。例如：是否使用 keepalive 啊，是否使用 gzip 进行压缩等。</td>
          <td>server</td>
        </tr>
        <tr>
          <td>server</td>
          <td>http 服务上支持若干虚拟主机。每个虚拟主机一个对应的 server 配置项，配置项里面包含该虚拟主机相关的配置。在提供 mail 服务的代理时，也可以建立若干 server. 每个 server 通过监听的地址来区分。</td>
          <td>listen, server_name, access_log, location, protocol, proxy, smtp_auth, xclient</td>
        </tr>
        <tr>
          <td>location</td>
          <td>http 服务中，某些特定的 URL 对应的一系列配置项。</td>
          <td>index, root</td>
        </tr>
        <tr>
          <td>mail</td>
          <td>实现 email 相关的 SMTP/IMAP/POP3 代理时，共享的一些配置项（因为可能实现多个代理，工作在多个监听地址上）。</td>
          <td>server, http, imap_capabilities</td>
        </tr>
        <tr>
          <td>include</td>
          <td>以便增强配置文件的可读性，使得部分配置文件可以重新使用。</td>
          <td>-</td>
        </tr>
        <tr>
          <td>valid_referers</td>
          <td>用来校验Http请求头Referer是否有效。</td>
          <td>-</td>
        </tr>
        <tr>
          <td>try_files</td>
          <td>用在server部分，不过最常见的还是用在location部分，它会按照给定的参数顺序进行尝试，第一个被匹配到的将会被使用。</td>
          <td>-</td>
        </tr>
        <tr>
          <td>if</td>
          <td>当在location块中使用if指令，在某些情况下它并不按照预期运行，一般来说避免使用if指令。</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
    <p>例如我们再 <strong>nginx.conf</strong> 里面引用两个配置 vhost/example.com.conf 和 vhost/gitlab.com.conf 它们都被放在一个我自己新建的目录 vhost 下面。nginx.conf 配置如下：</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">1</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span>
</span><span class="code-line">    <span class="token comment">#                  '$status $body_bytes_sent "$http_referer" '</span>
</span><span class="code-line">    <span class="token comment">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">#access_log  logs/access.log  main;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">#tcp_nopush     on;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">#keepalive_timeout  0;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">#gzip  on;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">include</span>  vhost/example.com.conf</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">include</span>  vhost/gitlab.com.conf</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="worker_processes  1;
events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &#x22;$request&#x22; &#x27;
    #                  &#x27;$status $body_bytes_sent &#x22;$http_referer&#x22; &#x27;
    #                  &#x27;&#x22;$http_user_agent&#x22; &#x22;$http_x_forwarded_for&#x22;&#x27;;

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;
    server {
        listen       80;
        server_name  localhost;
        location / {
            root   html;
            index  index.html index.htm;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
    include  vhost/example.com.conf;
    include  vhost/gitlab.com.conf;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>简单的配置: example.com.conf</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">#侦听的80端口</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>  baidu.com app.baidu.com</span><span class="token punctuation">;</span> <span class="token comment"># 这里指定域名</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">index</span>        index.html index.htm</span><span class="token punctuation">;</span>    <span class="token comment"># 这里指定默认入口页面</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">root</span> /home/www/app.baidu.com</span><span class="token punctuation">;</span>         <span class="token comment"># 这里指定目录</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
    #侦听的80端口
    listen       80;
    server_name  baidu.com app.baidu.com; # 这里指定域名
    index        index.html index.htm;    # 这里指定默认入口页面
    root /home/www/app.baidu.com;         # 这里指定目录
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="内置预定义变量"><a class="anchor" aria-hidden="true" tabindex="-1" href="#内置预定义变量"><span class="octicon octicon-link"></span></a>内置预定义变量</h3>
    <p>Nginx提供了许多预定义的变量，也可以通过使用set来设置变量。你可以在if中使用预定义变量，也可以将它们传递给代理服务器。以下是一些常见的预定义变量，<a href="http://nginx.org/en/docs/varindex.html">更多详见</a></p>
    <table>
      <thead>
        <tr>
          <th>变量名称</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>$args_name</td>
          <td>在请求中的name参数</td>
        </tr>
        <tr>
          <td>$args</td>
          <td>所有请求参数</td>
        </tr>
        <tr>
          <td>$query_string</td>
          <td>$args的别名</td>
        </tr>
        <tr>
          <td>$content_length</td>
          <td>请求头Content-Length的值</td>
        </tr>
        <tr>
          <td>$content_type</td>
          <td>请求头Content-Type的值</td>
        </tr>
        <tr>
          <td>$host</td>
          <td>如果当前有Host，则为请求头Host的值；如果没有这个头，那么该值等于匹配该请求的server_name的值</td>
        </tr>
        <tr>
          <td>$remote_addr</td>
          <td>客户端的IP地址</td>
        </tr>
        <tr>
          <td>$request</td>
          <td>完整的请求，从客户端收到，包括Http请求方法、URI、Http协议、头、请求体</td>
        </tr>
        <tr>
          <td>$request_uri</td>
          <td>完整请求的URI，从客户端来的请求，包括参数</td>
        </tr>
        <tr>
          <td>$scheme</td>
          <td>当前请求的协议</td>
        </tr>
        <tr>
          <td>$uri</td>
          <td>当前请求的标准化URI</td>
        </tr>
      </tbody>
    </table>
    <h3 id="反向代理"><a class="anchor" aria-hidden="true" tabindex="-1" href="#反向代理"><span class="octicon octicon-link"></span></a>反向代理</h3>
    <p>反向代理是一个Web服务器，它接受客户端的连接请求，然后将请求转发给上游服务器，并将从服务器得到的结果返回给连接的客户端。下面简单的反向代理的例子：</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>  
</span><span class="code-line">  <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>                                                        
</span><span class="code-line">  <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>                                              
</span><span class="code-line">  <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">1024M</span></span><span class="token punctuation">;</span>  <span class="token comment"># 允许客户端请求的最大单文件字节数</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_pass</span>                         http://localhost:8080</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host              <span class="token variable">$host</span>:<span class="token variable">$server_port</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For   <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span> <span class="token comment"># HTTP的请求端真实的IP</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>      <span class="token comment"># 为了正确地识别实际用户发出的协议是 http 还是 https</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {  
  listen       80;                                                        
  server_name  localhost;                                              
  client_max_body_size 1024M;  # 允许客户端请求的最大单文件字节数

  location / {
    proxy_pass                         http://localhost:8080;
    proxy_set_header Host              $host:$server_port;
    proxy_set_header X-Forwarded-For   $remote_addr; # HTTP的请求端真实的IP
    proxy_set_header X-Forwarded-Proto $scheme;      # 为了正确地识别实际用户发出的协议是 http 还是 https
  }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>复杂的配置: gitlab.com.conf。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">#侦听的80端口</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>  git.example.cn</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_pass</span>   http://localhost:3000</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token comment">#以下是一些反向代理的配置可删除</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token comment">#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">client_max_body_size</span>       <span class="token number">10m</span></span><span class="token punctuation">;</span> <span class="token comment">#允许客户端请求的最大单文件字节数</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">client_body_buffer_size</span>    <span class="token number">128k</span></span><span class="token punctuation">;</span> <span class="token comment">#缓冲区代理缓冲用户端请求的最大字节数</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span>      <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment">#nginx跟后端服务器连接超时时间(代理连接超时)</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_send_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment">#后端服务器数据回传时间(代理发送超时)</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_read_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment">#连接成功后，后端服务器响应时间(代理接收超时)</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_buffer_size</span>          <span class="token number">4k</span></span><span class="token punctuation">;</span> <span class="token comment">#设置代理服务器（nginx）保存用户头信息的缓冲区大小</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_buffers</span>              <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span> <span class="token comment">#proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span>    <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment">#高负荷下缓冲大小（proxy_buffers*2）</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
    #侦听的80端口
    listen       80;
    server_name  git.example.cn;
    location / {
        proxy_pass   http://localhost:3000;
        #以下是一些反向代理的配置可删除
        proxy_redirect             off;
        #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP
        proxy_set_header           Host $host;
        client_max_body_size       10m; #允许客户端请求的最大单文件字节数
        client_body_buffer_size    128k; #缓冲区代理缓冲用户端请求的最大字节数
        proxy_connect_timeout      300; #nginx跟后端服务器连接超时时间(代理连接超时)
        proxy_send_timeout         300; #后端服务器数据回传时间(代理发送超时)
        proxy_read_timeout         300; #连接成功后，后端服务器响应时间(代理接收超时)
        proxy_buffer_size          4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小
        proxy_buffers              4 32k; #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置
        proxy_busy_buffers_size    64k; #高负荷下缓冲大小（proxy_buffers*2）
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>代理到上游服务器的配置中，最重要的是proxy_pass指令。以下是代理模块中的一些常用指令：</p>
    <table>
      <thead>
        <tr>
          <th>指令</th>
          <th>说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>proxy_connect_timeout</td>
          <td>Nginx从接受请求至连接到上游服务器的最长等待时间</td>
        </tr>
        <tr>
          <td>proxy_send_timeout</td>
          <td>后端服务器数据回传时间(代理发送超时)</td>
        </tr>
        <tr>
          <td>proxy_read_timeout</td>
          <td>连接成功后，后端服务器响应时间(代理接收超时)</td>
        </tr>
        <tr>
          <td>proxy_cookie_domain</td>
          <td>替代从上游服务器来的Set-Cookie头的domain属性</td>
        </tr>
        <tr>
          <td>proxy_cookie_path</td>
          <td>替代从上游服务器来的Set-Cookie头的path属性</td>
        </tr>
        <tr>
          <td>proxy_buffer_size</td>
          <td>设置代理服务器（nginx）保存用户头信息的缓冲区大小</td>
        </tr>
        <tr>
          <td>proxy_buffers</td>
          <td>proxy_buffers缓冲区，网页平均在多少k以下</td>
        </tr>
        <tr>
          <td>proxy_set_header</td>
          <td>重写发送到上游服务器头的内容，也可以通过将某个头部的值设置为空字符串，而不发送某个头部的方法实现</td>
        </tr>
        <tr>
          <td>proxy_ignore_headers</td>
          <td>这个指令禁止处理来自代理服务器的应答。</td>
        </tr>
        <tr>
          <td>proxy_intercept_errors</td>
          <td>使nginx阻止HTTP应答代码为400或者更高的应答。</td>
        </tr>
      </tbody>
    </table>
    <h3 id="负载均衡"><a class="anchor" aria-hidden="true" tabindex="-1" href="#负载均衡"><span class="octicon octicon-link"></span></a>负载均衡</h3>
    <p>upstream指令启用一个新的配置区段，在该区段定义一组上游服务器。这些服务器可能被设置不同的权重，也可能出于对服务器进行维护，标记为down。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> gitlab</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment"># upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> 192.168.122.11:8081</span> <span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:82 weight=3</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:83 weight=3 down</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:84 weight=3</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">max_fails=3</span>  fail_timeout=20s</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:85 weight=4</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">#侦听的80端口</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>  git.example.cn</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_pass</span>   http://gitlab</span><span class="token punctuation">;</span>    <span class="token comment">#在这里设置一个代理，和upstream的名字一样</span>
</span><span class="code-line">        <span class="token comment">#以下是一些反向代理的配置可删除</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token comment">#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">client_max_body_size</span>       <span class="token number">10m</span></span><span class="token punctuation">;</span>  <span class="token comment">#允许客户端请求的最大单文件字节数</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">client_body_buffer_size</span>    <span class="token number">128k</span></span><span class="token punctuation">;</span> <span class="token comment">#缓冲区代理缓冲用户端请求的最大字节数</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span>      <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#nginx跟后端服务器连接超时时间(代理连接超时)</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_send_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#后端服务器数据回传时间(代理发送超时)</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_read_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#连接成功后，后端服务器响应时间(代理接收超时)</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_buffer_size</span>          <span class="token number">4k</span></span><span class="token punctuation">;</span> <span class="token comment">#设置代理服务器（nginx）保存用户头信息的缓冲区大小</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_buffers</span>              <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span><span class="token comment"># 缓冲区，网页平均在32k以下的话，这样设置</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span>    <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment">#高负荷下缓冲大小（proxy_buffers*2）</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_temp_file_write_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment">#设定缓存文件夹大小，大于这个值，将从upstream服务器传</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream gitlab {
    ip_hash;
    # upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。
    server 192.168.122.11:8081 ;
    server 127.0.0.1:82 weight=3;
    server 127.0.0.1:83 weight=3 down;
    server 127.0.0.1:84 weight=3; max_fails=3  fail_timeout=20s;
    server 127.0.0.1:85 weight=4;;
    keepalive 32;
}
server {
    #侦听的80端口
    listen       80;
    server_name  git.example.cn;
    location / {
        proxy_pass   http://gitlab;    #在这里设置一个代理，和upstream的名字一样
        #以下是一些反向代理的配置可删除
        proxy_redirect             off;
        #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP
        proxy_set_header           Host $host;
        proxy_set_header           X-Real-IP $remote_addr;
        proxy_set_header           X-Forwarded-For $proxy_add_x_forwarded_for;
        client_max_body_size       10m;  #允许客户端请求的最大单文件字节数
        client_body_buffer_size    128k; #缓冲区代理缓冲用户端请求的最大字节数
        proxy_connect_timeout      300;  #nginx跟后端服务器连接超时时间(代理连接超时)
        proxy_send_timeout         300;  #后端服务器数据回传时间(代理发送超时)
        proxy_read_timeout         300;  #连接成功后，后端服务器响应时间(代理接收超时)
        proxy_buffer_size          4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小
        proxy_buffers              4 32k;# 缓冲区，网页平均在32k以下的话，这样设置
        proxy_busy_buffers_size    64k; #高负荷下缓冲大小（proxy_buffers*2）
        proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</p>
    <p><strong>负载均衡：</strong></p>
    <p>upstream模块能够使用3种负载均衡算法：轮询、IP哈希、最少连接数。</p>
    <p><strong>轮询：</strong> 默认情况下使用轮询算法，不需要配置指令来激活它，它是基于在队列中谁是下一个的原理确保访问均匀地分布到每个上游服务器；<br><strong>IP哈希：</strong> 通过ip_hash指令来激活，Nginx通过IPv4地址的前3个字节或者整个IPv6地址作为哈希键来实现，同一个IP地址总是能被映射到同一个上游服务器；<br><strong>最少连接数：</strong> 通过least_conn指令来激活，该算法通过选择一个活跃数最少的上游服务器进行连接。如果上游服务器处理能力不同，可以通过给server配置weight权重来说明，该算法将考虑到不同服务器的加权最少连接数。</p>
    <h4 id="rr"><a class="anchor" aria-hidden="true" tabindex="-1" href="#rr"><span class="octicon octicon-link"></span></a>RR</h4>
    <p><strong>简单配置</strong> ，这里我配置了2台服务器，当然实际上是一台，只是端口不一样而已，而8081的服务器是不存在的，也就是说访问不到，但是我们访问 <code>http://localhost</code> 的时候，也不会有问题，会默认跳转到<code>http://localhost:8080</code>具体是因为Nginx会自动判断服务器的状态，如果服务器处于不能访问（服务器挂了），就不会跳转到这台服务器，所以也避免了一台服务器挂了影响使用的情况，由于Nginx默认是RR策略，所以我们不需要其他更多的设置</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">81</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">1024M</span></span><span class="token punctuation">;</span>
</span><span class="code-line"> 
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://test</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span>:<span class="token variable">$server_port</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream test {
    server localhost:8080;
    server localhost:8081;
}
server {
    listen       81;
    server_name  localhost;
    client_max_body_size 1024M;
 
    location / {
        proxy_pass http://test;
        proxy_set_header Host $host:$server_port;
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p><strong>负载均衡的核心代码为</strong></p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream test {
    server localhost:8080;
    server localhost:8081;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h4 id="权重"><a class="anchor" aria-hidden="true" tabindex="-1" href="#权重"><span class="octicon octicon-link"></span></a>权重</h4>
    <p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。 例如</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8080 weight=9</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8081 weight=1</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream test {
    server localhost:8080 weight=9;
    server localhost:8081 weight=1;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>那么10次一般只会有1次会访问到8081，而有9次会访问到8080</p>
    <h4 id="ip_hash"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ip_hash"><span class="octicon octicon-link"></span></a>ip_hash</h4>
    <p>上面的2种方式都有一个问题，那就是下一个请求来的时候请求可能分发到另外一个服务器，当我们的程序不是无状态的时候（采用了session保存数据），这时候就有一个很大的很问题了，比如把登录信息保存到了session中，那么跳转到另外一台服务器的时候就需要重新登录了，所以很多时候我们需要一个客户只访问一个服务器，那么就需要用iphash了，iphash的每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream test {
    ip_hash;
    server localhost:8080;
    server localhost:8081;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h4 id="fair"><a class="anchor" aria-hidden="true" tabindex="-1" href="#fair"><span class="octicon octicon-link"></span></a>fair</h4>
    <p>这是个第三方模块，按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">fair</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream backend {
    fair;
    server localhost:8080;
    server localhost:8081;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h4 id="url_hash"><a class="anchor" aria-hidden="true" tabindex="-1" href="#url_hash"><span class="octicon octicon-link"></span></a>url_hash</h4>
    <p>这是个第三方模块，按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。 在upstream中加入hash语句，server语句中不能写入weight等其他的参数，hash_method是使用的hash算法</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">hash_method</span> crc32</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream backend {
    hash $request_uri;
    hash_method crc32;
    server localhost:8080;
    server localhost:8081;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>以上5种负载均衡各自适用不同情况下使用，所以可以根据实际情况选择使用哪种策略模式，不过fair和url_hash需要安装第三方模块才能使用</p>
    <p><strong>server指令可选参数：</strong></p>
    <ol>
      <li>weight：设置一个服务器的访问权重，数值越高，收到的请求也越多；</li>
      <li>fail_timeout：在这个指定的时间内服务器必须提供响应，如果在这个时间内没有收到响应，那么服务器将会被标记为down状态；</li>
      <li>max_fails：设置在fail_timeout时间之内尝试对一个服务器连接的最大次数，如果超过这个次数，那么服务器将会被标记为down;</li>
      <li>down：标记一个服务器不再接受任何请求；</li>
      <li>backup：一旦其他服务器宕机，那么有该标记的机器将会接收请求。</li>
    </ol>
    <p><strong>keepalive指令：</strong></p>
    <p>Nginx服务器将会为每一个worker进行保持同上游服务器的连接。</p>
    <h3 id="屏蔽ip"><a class="anchor" aria-hidden="true" tabindex="-1" href="#屏蔽ip"><span class="octicon octicon-link"></span></a>屏蔽ip</h3>
    <p>在nginx的配置文件<code>nginx.conf</code>中加入如下配置，可以放到http, server, location, limit_except语句块，需要注意相对路径，本例当中<code>nginx.conf</code>，<code>blocksip.conf</code>在同一个目录中。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">include</span> blockip.conf</span><span class="token punctuation">;</span>
</span></code><div onclick="copied(this)" data-code="include blockip.conf;
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>在blockip.conf里面输入内容，如：</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">deny</span> 165.91.122.67</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token directive"><span class="token keyword">deny</span> IP</span><span class="token punctuation">;</span>   <span class="token comment"># 屏蔽单个ip访问</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">allow</span> IP</span><span class="token punctuation">;</span>  <span class="token comment"># 允许单个ip访问</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>  <span class="token comment"># 屏蔽所有ip访问</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span> <span class="token comment"># 允许所有ip访问</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">deny</span> 123.0.0.0/8   <span class="token comment"># 屏蔽整个段即从123.0.0.1到123.255.255.254访问的命令</span>
</span></span><span class="code-line"><span class="token directive">deny 124.45.0.0/16 <span class="token comment"># 屏蔽IP段即从123.45.0.1到123.45.255.254访问的命令</span>
</span></span><span class="code-line"><span class="token directive">deny 123.45.6.0/24 <span class="token comment"># 屏蔽IP段即从123.45.6.1到123.45.6.254访问的命令</span>
</span></span><span class="code-line"><span class="token directive">
</span></span><span class="code-line"><span class="token directive"><span class="token comment"># 如果你想实现这样的应用，除了几个IP外，其他全部拒绝</span>
</span></span><span class="code-line"><span class="token directive">allow 1.1.1.1</span><span class="token punctuation">;</span> 
</span><span class="code-line"><span class="token directive"><span class="token keyword">allow</span> 1.1.1.2</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span> 
</span></code><div onclick="copied(this)" data-code="deny 165.91.122.67;

deny IP;   # 屏蔽单个ip访问
allow IP;  # 允许单个ip访问
deny all;  # 屏蔽所有ip访问
allow all; # 允许所有ip访问
deny 123.0.0.0/8   # 屏蔽整个段即从123.0.0.1到123.255.255.254访问的命令
deny 124.45.0.0/16 # 屏蔽IP段即从123.45.0.1到123.45.255.254访问的命令
deny 123.45.6.0/24 # 屏蔽IP段即从123.45.6.1到123.45.6.254访问的命令

# 如果你想实现这样的应用，除了几个IP外，其他全部拒绝
allow 1.1.1.1; 
allow 1.1.1.2;
deny all; 
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="第三方模块安装方法"><a class="anchor" aria-hidden="true" tabindex="-1" href="#第三方模块安装方法"><span class="octicon octicon-link"></span></a>第三方模块安装方法</h2>
    <pre><code class="code-highlight"><span class="code-line">./configure --prefix=/你的安装目录  --add-module=/第三方模块目录
</span></code><div onclick="copied(this)" data-code="./configure --prefix=/你的安装目录  --add-module=/第三方模块目录
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="重定向"><a class="anchor" aria-hidden="true" tabindex="-1" href="#重定向"><span class="octicon octicon-link"></span></a>重定向</h2>
    <ul>
      <li><code>permanent</code> 永久性重定向。请求日志中的状态码为301</li>
      <li><code>redirect</code> 临时重定向。请求日志中的状态码为302</li>
    </ul>
    <h3 id="重定向整个网站"><a class="anchor" aria-hidden="true" tabindex="-1" href="#重定向整个网站"><span class="octicon octicon-link"></span></a>重定向整个网站</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span> old-site.com
</span></span><span class="code-line"><span class="token directive">    return <span class="token number">301</span> <span class="token variable">$scheme</span>://new-site.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
    server_name old-site.com
    return 301 $scheme://new-site.com$request_uri;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="重定向单页"><a class="anchor" aria-hidden="true" tabindex="-1" href="#重定向单页"><span class="octicon octicon-link"></span></a>重定向单页</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> = /oldpage.html</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> http://example.org/newpage.html</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
    location = /oldpage.html {
        return 301 http://example.org/newpage.html;
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="重定向整个子路径"><a class="anchor" aria-hidden="true" tabindex="-1" href="#重定向整个子路径"><span class="octicon octicon-link"></span></a>重定向整个子路径</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> /old-site</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">rewrite</span> ^/old-site/(.*) http://example.org/new-site/<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location /old-site {
    rewrite ^/old-site/(.*) http://example.org/new-site/$1 permanent;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="性能"><a class="anchor" aria-hidden="true" tabindex="-1" href="#性能"><span class="octicon octicon-link"></span></a>性能</h2>
    <h3 id="内容缓存"><a class="anchor" aria-hidden="true" tabindex="-1" href="#内容缓存"><span class="octicon octicon-link"></span></a>内容缓存</h3>
    <p>允许浏览器基本上永久地缓存静态内容。 Nginx将为您设置Expires和Cache-Control头信息。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> /static</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">root</span> /data</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">expires</span> max</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location /static {
    root /data;
    expires max;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>如果要求浏览器永远不会缓存响应（例如用于跟踪请求），请使用-1。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> = /empty.gif</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">empty_gif</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">expires</span> -1</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location = /empty.gif {
    empty_gif;
    expires -1;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="gzip压缩"><a class="anchor" aria-hidden="true" tabindex="-1" href="#gzip压缩"><span class="octicon octicon-link"></span></a>Gzip压缩</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">gzip</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">256</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">gzip_types</span>
</span></span><span class="code-line"><span class="token directive">    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml
</span></span><span class="code-line"><span class="token directive">    text/javascript application/javascript application/x-javascript
</span></span><span class="code-line"><span class="token directive">    text/x-json application/json application/x-web-app-manifest+json
</span></span><span class="code-line"><span class="token directive">    text/css text/plain text/x-component
</span></span><span class="code-line"><span class="token directive">    font/opentype application/x-font-ttf application/vnd.ms-fontobject
</span></span><span class="code-line"><span class="token directive">    image/x-icon</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">gzip_disable</span>  <span class="token string">"msie6"</span></span><span class="token punctuation">;</span>
</span></code><div onclick="copied(this)" data-code="gzip  on;
gzip_buffers 16 8k;
gzip_comp_level 6;
gzip_http_version 1.1;
gzip_min_length 256;
gzip_proxied any;
gzip_vary on;
gzip_types
    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml
    text/javascript application/javascript application/x-javascript
    text/x-json application/json application/x-web-app-manifest+json
    text/css text/plain text/x-component
    font/opentype application/x-font-ttf application/vnd.ms-fontobject
    image/x-icon;
gzip_disable  &#x22;msie6&#x22;;
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="打开文件缓存"><a class="anchor" aria-hidden="true" tabindex="-1" href="#打开文件缓存"><span class="octicon octicon-link"></span></a>打开文件缓存</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">open_file_cache</span> max=1000 inactive=20s</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">open_file_cache_valid</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">open_file_cache_min_uses</span> <span class="token number">2</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">open_file_cache_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</span></code><div onclick="copied(this)" data-code="open_file_cache max=1000 inactive=20s;
open_file_cache_valid 30s;
open_file_cache_min_uses 2;
open_file_cache_errors on;
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="ssl缓存"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ssl缓存"><span class="octicon octicon-link"></span></a>SSL缓存</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">ssl_session_cache</span> shared:SSL:10m</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">10m</span></span><span class="token punctuation">;</span>
</span></code><div onclick="copied(this)" data-code="ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="上游keepalive"><a class="anchor" aria-hidden="true" tabindex="-1" href="#上游keepalive"><span class="octicon octicon-link"></span></a>上游Keepalive</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    ...
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">""</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream backend {
    server 127.0.0.1:8080;
    keepalive 32;
}
server {
    ...
    location /api/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Connection &#x22;&#x22;;
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="监控"><a class="anchor" aria-hidden="true" tabindex="-1" href="#监控"><span class="octicon octicon-link"></span></a>监控</h3>
    <p>使用<code>ngxtop</code>实时解析nginx访问日志，并且将处理结果输出到终端，功能类似于系统命令top。所有示例都读取nginx配置文件的访问日志位置和格式。如果要指定访问日志文件和/或日志格式，请使用-f和-a选项。</p>
    <p>注意：在nginx配置中<code>/usr/local/nginx/conf/nginx.conf</code>日志文件必须是绝对路径。</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># 安装 ngxtop</span>
</span><span class="code-line">pip <span class="token function">install</span> ngxtop
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 实时状态</span>
</span><span class="code-line">ngxtop
</span><span class="code-line"><span class="token comment"># 状态为404的前10个请求的路径：</span>
</span><span class="code-line">ngxtop <span class="token function">top</span> request_path --filter <span class="token string">'status == 404'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 发送总字节数最多的前10个请求</span>
</span><span class="code-line">ngxtop --order-by <span class="token string">'avg(bytes_sent) * count'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 排名前十位的IP，例如，谁攻击你最多</span>
</span><span class="code-line">ngxtop --group-by remote_addr
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 打印具有4xx或5xx状态的请求，以及status和http referer</span>
</span><span class="code-line">ngxtop -i <span class="token string">'status >= 400'</span> print request status http_referer
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 由200个请求路径响应发送的平均正文字节以'foo'开始：</span>
</span><span class="code-line">ngxtop avg bytes_sent --filter <span class="token string">'status == 200 and request_path.startswith("foo")'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 使用“common”日志格式从远程机器分析apache访问日志</span>
</span><span class="code-line"><span class="token function">ssh</span> remote <span class="token function">tail</span> -f /var/log/apache2/access.log <span class="token operator">|</span> ngxtop -f common
</span></code><div onclick="copied(this)" data-code="# 安装 ngxtop
pip install ngxtop

# 实时状态
ngxtop
# 状态为404的前10个请求的路径：
ngxtop top request_path --filter &#x27;status == 404&#x27;

# 发送总字节数最多的前10个请求
ngxtop --order-by &#x27;avg(bytes_sent) * count&#x27;

# 排名前十位的IP，例如，谁攻击你最多
ngxtop --group-by remote_addr

# 打印具有4xx或5xx状态的请求，以及status和http referer
ngxtop -i &#x27;status >= 400&#x27; print request status http_referer

# 由200个请求路径响应发送的平均正文字节以&#x27;foo&#x27;开始：
ngxtop avg bytes_sent --filter &#x27;status == 200 and request_path.startswith(&#x22;foo&#x22;)&#x27;

# 使用“common”日志格式从远程机器分析apache访问日志
ssh remote tail -f /var/log/apache2/access.log | ngxtop -f common
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="常见使用场景"><a class="anchor" aria-hidden="true" tabindex="-1" href="#常见使用场景"><span class="octicon octicon-link"></span></a>常见使用场景</h2>
    <h3 id="跨域问题"><a class="anchor" aria-hidden="true" tabindex="-1" href="#跨域问题"><span class="octicon octicon-link"></span></a>跨域问题</h3>
    <p>在工作中，有时候会遇到一些接口不支持跨域，这时候可以简单的添加add_headers来支持cors跨域。配置如下：</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">server_name</span> api.xxx.com</span><span class="token punctuation">;</span>
</span><span class="code-line">    
</span><span class="code-line">  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span></span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span></span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET,POST,HEAD'</span></span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host  <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>    
</span><span class="code-line">  <span class="token punctuation">}</span> 
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
  listen 80;
  server_name api.xxx.com;
    
  add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;
  add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;
  add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET,POST,HEAD&#x27;;

  location / {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host  $http_host;    
  } 
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>上面更改头信息，还有一种，使用 <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">rewrite</a> 指令重定向URI来解决跨域问题。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">server_name</span> api.xxx.com</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span> 
</span><span class="code-line">    <span class="token directive"><span class="token keyword">root</span>  html</span><span class="token punctuation">;</span>                   <span class="token comment">#去请求../html文件夹里的文件</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>  <span class="token comment">#首页响应地址</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token comment"># 用于拦截请求，匹配任何以 /api/开头的地址，</span>
</span><span class="code-line">  <span class="token comment"># 匹配符合以后，停止往下搜索正则。</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">location</span> ^~/api/</span><span class="token punctuation">{</span> 
</span><span class="code-line">    <span class="token comment"># 代表重写拦截进来的请求，并且只能对域名后边的除去传递的参数外的字符串起作用，</span>
</span><span class="code-line">    <span class="token comment"># 例如www.a.com/proxy/api/msg?meth=1&#x26;par=2重写，只对/proxy/api/msg重写。</span>
</span><span class="code-line">    <span class="token comment"># rewrite后面的参数是一个简单的正则 ^/api/(.*)$，</span>
</span><span class="code-line">    <span class="token comment"># $1代表正则中的第一个()，$2代表第二个()的值，以此类推。</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">rewrite</span> ^/api/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment"># 把请求代理到其他主机 </span>
</span><span class="code-line">    <span class="token comment"># 其中 http://www.b.com/ 写法和 http://www.b.com写法的区别如下</span>
</span><span class="code-line">    <span class="token comment"># 如果你的请求地址是他 http://server/html/test.jsp</span>
</span><span class="code-line">    <span class="token comment"># 配置一： http://www.b.com/ 后面有“/” </span>
</span><span class="code-line">    <span class="token comment">#         将反向代理成 http://www.b.com/html/test.jsp 访问</span>
</span><span class="code-line">    <span class="token comment"># 配置一： http://www.b.com 后面没有有“/” </span>
</span><span class="code-line">    <span class="token comment">#         将反向代理成 http://www.b.com/test.jsp 访问</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://test</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># 如果 proxy_pass  URL 是 http://a.xx.com/platform/ 这种情况</span>
</span><span class="code-line">    <span class="token comment"># proxy_cookie_path应该设置成 /platform/ / (注意两个斜杠之间有空格)。</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_cookie_path</span> /platfrom/ /</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header</span>
</span><span class="code-line">    <span class="token comment"># 设置 Cookie 头通过</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_pass_header</span> Set-Cookie</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> 
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream test {
  server 127.0.0.1:8080;
  server localhost:8081;
}
server {
  listen 80;
  server_name api.xxx.com;
  location / { 
    root  html;                   #去请求../html文件夹里的文件
    index  index.html index.htm;  #首页响应地址
  }
  # 用于拦截请求，匹配任何以 /api/开头的地址，
  # 匹配符合以后，停止往下搜索正则。
  location ^~/api/{ 
    # 代表重写拦截进来的请求，并且只能对域名后边的除去传递的参数外的字符串起作用，
    # 例如www.a.com/proxy/api/msg?meth=1&#x26;par=2重写，只对/proxy/api/msg重写。
    # rewrite后面的参数是一个简单的正则 ^/api/(.*)$，
    # $1代表正则中的第一个()，$2代表第二个()的值，以此类推。
    rewrite ^/api/(.*)$ /$1 break;
    
    # 把请求代理到其他主机 
    # 其中 http://www.b.com/ 写法和 http://www.b.com写法的区别如下
    # 如果你的请求地址是他 http://server/html/test.jsp
    # 配置一： http://www.b.com/ 后面有“/” 
    #         将反向代理成 http://www.b.com/html/test.jsp 访问
    # 配置一： http://www.b.com 后面没有有“/” 
    #         将反向代理成 http://www.b.com/test.jsp 访问
    proxy_pass http://test;

    # 如果 proxy_pass  URL 是 http://a.xx.com/platform/ 这种情况
    # proxy_cookie_path应该设置成 /platform/ / (注意两个斜杠之间有空格)。
    proxy_cookie_path /platfrom/ /;

    # http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header
    # 设置 Cookie 头通过
    proxy_pass_header Set-Cookie;
  } 
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="跳转到带www的域上面"><a class="anchor" aria-hidden="true" tabindex="-1" href="#跳转到带www的域上面"><span class="octicon octicon-link"></span></a>跳转到带www的域上面</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment"># 配置正常的带www的域名</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span> www.wangchujiang.com</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">root</span> /home/www/wabg/download</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html =404</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment"># 这个要放到下面，</span>
</span><span class="code-line">    <span class="token comment"># 将不带www的 wangchujiang.com 永久性重定向到  https://www.wangchujiang.com</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span> wangchujiang.com</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">rewrite</span> ^(.*) https://www.wangchujiang.com<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
    listen 80;
    # 配置正常的带www的域名
    server_name www.wangchujiang.com;
    root /home/www/wabg/download;
    location / {
        try_files $uri $uri/ /index.html =404;
    }
}
server {
    # 这个要放到下面，
    # 将不带www的 wangchujiang.com 永久性重定向到  https://www.wangchujiang.com
    server_name wangchujiang.com;
    rewrite ^(.*) https://www.wangchujiang.com$1 permanent;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="代理转发"><a class="anchor" aria-hidden="true" tabindex="-1" href="#代理转发"><span class="octicon octicon-link"></span></a>代理转发</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> server-api</span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment"># api 代理服务地址</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3110</span><span class="token punctuation">;</span>    
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">upstream</span> server-resource</span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment"># 静态资源 代理服务地址</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3120</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">3111</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>      <span class="token comment"># 这里指定域名</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">root</span> /home/www/server-statics</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment"># 匹配 api 路由的反向代理到API服务</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> ^~/api/</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-api</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token comment"># 假设这里验证码也在API服务中</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> ^~/captcha</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-api</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token comment"># 假设你的图片资源全部在另外一个服务上面</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> ^~/img/</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-resource</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token comment"># 路由在前端，后端没有真实路由，在路由不存在的 404状态的页面返回 /index.html</span>
</span><span class="code-line">    <span class="token comment"># 这个方式使用场景，你在写React或者Vue项目的时候，没有真实路由</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html =404</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token comment">#                               ^ 空格很重要</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="upstream server-api{
    # api 代理服务地址
    server 127.0.0.1:3110;    
}
upstream server-resource{
    # 静态资源 代理服务地址
    server 127.0.0.1:3120;
}
server {
    listen       3111;
    server_name  localhost;      # 这里指定域名
    root /home/www/server-statics;
    # 匹配 api 路由的反向代理到API服务
    location ^~/api/ {
        rewrite ^/(.*)$ /$1 break;
        proxy_pass http://server-api;
    }
    # 假设这里验证码也在API服务中
    location ^~/captcha {
        rewrite ^/(.*)$ /$1 break;
        proxy_pass http://server-api;
    }
    # 假设你的图片资源全部在另外一个服务上面
    location ^~/img/ {
        rewrite ^/(.*)$ /$1 break;
        proxy_pass http://server-resource;
    }
    # 路由在前端，后端没有真实路由，在路由不存在的 404状态的页面返回 /index.html
    # 这个方式使用场景，你在写React或者Vue项目的时候，没有真实路由
    location / {
        try_files $uri $uri/ /index.html =404;
        #                               ^ 空格很重要
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="监控状态信息"><a class="anchor" aria-hidden="true" tabindex="-1" href="#监控状态信息"><span class="octicon octicon-link"></span></a>监控状态信息</h3>
    <p>通过 <code>nginx -V</code> 来查看是否有 <code>with-http_stub_status_module</code> 该模块。</p>
    <blockquote>
      <p><code>nginx -V</code> 这里 <code>V</code> 是大写的，如果是小写的 <code>v</code> 即 <code>nginx -v</code>，则不会出现有哪些模块，只会出现 <code>nginx</code> 的版本</p>
    </blockquote>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> /nginx_status</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">stub_status</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location /nginx_status {
    stub_status on;
    access_log off;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>通过 <a href="http://127.0.0.1/nginx_status">http://127.0.0.1/nginx_status</a> 访问出现下面结果。</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">Active connections: <span class="token number">3</span>
</span><span class="code-line">server accepts handled requests
</span><span class="code-line"> <span class="token number">7</span> <span class="token number">7</span> <span class="token number">5</span> 
</span><span class="code-line">Reading: <span class="token number">0</span> Writing: <span class="token number">1</span> Waiting: <span class="token number">2</span> 
</span></code><div onclick="copied(this)" data-code="Active connections: 3
server accepts handled requests
 7 7 5 
Reading: 0 Writing: 1 Waiting: 2 
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <ol>
      <li>主动连接(第 1 行)</li>
    </ol>
    <p>当前与http建立的连接数，包括等待的客户端连接：3</p>
    <ol start="2">
      <li>服务器接受处理的请求(第 2~3 行)</li>
    </ol>
    <p>接受的客户端连接总数目：7<br>处理的客户端连接总数目：7<br>客户端总的请求数目：5</p>
    <ol start="3">
      <li>读取其它信(第 4 行)</li>
    </ol>
    <p>当前，nginx读请求连接<br>当前，nginx写响应返回给客户端<br>目前有多少空闲客户端请求连接</p>
    <h3 id="代理转发连接替换"><a class="anchor" aria-hidden="true" tabindex="-1" href="#代理转发连接替换"><span class="octicon octicon-link"></span></a>代理转发连接替换</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> ^~/api/upload</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /wfs/v1/upload break</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://wfs-api</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location ^~/api/upload {
    rewrite ^/(.*)$ /wfs/v1/upload break;
    proxy_pass http://wfs-api;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="ssl配置"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ssl配置"><span class="octicon octicon-link"></span></a>ssl配置</h3>
    <p>超文本传输安全协议（缩写：HTTPS，英语：Hypertext Transfer Protocol Secure）是超文本传输协议和SSL/TLS的组合，用以提供加密通讯及对网络服务器身份的鉴定。HTTPS连接经常被用于万维网上的交易支付和企业信息系统中敏感信息的传输。HTTPS不应与在RFC 2660中定义的安全超文本传输协议（S-HTTP）相混。HTTPS 目前已经是所有注重隐私和安全的网站的首选，随着技术的不断发展，HTTPS 网站已不再是大型网站的专利，所有普通的个人站长和博客均可以自己动手搭建一个安全的加密的网站。</p>
    <p>创建SSL证书，如果你购买的证书，就可以直接下载</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/nginx/ssl
</span><span class="code-line"><span class="token comment"># 创建了有效期100年，加密强度为RSA2048的SSL密钥key和X509证书文件。</span>
</span><span class="code-line"><span class="token function">sudo</span> openssl req -x509 -nodes -days <span class="token number">36500</span> -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt
</span><span class="code-line"><span class="token comment"># 上面命令，会有下面需要填写内容</span>
</span><span class="code-line">Country Name <span class="token punctuation">(</span><span class="token number">2</span> letter code<span class="token punctuation">)</span> <span class="token punctuation">[</span>AU<span class="token punctuation">]</span>:US
</span><span class="code-line">State or Province Name <span class="token punctuation">(</span>full name<span class="token punctuation">)</span> <span class="token punctuation">[</span>Some-State<span class="token punctuation">]</span>:New York
</span><span class="code-line">Locality Name <span class="token punctuation">(</span>eg, city<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:New York City
</span><span class="code-line">Organization Name <span class="token punctuation">(</span>eg, company<span class="token punctuation">)</span> <span class="token punctuation">[</span>Internet Widgits Pty Ltd<span class="token punctuation">]</span>:Bouncy Castles, Inc.
</span><span class="code-line">Organizational Unit Name <span class="token punctuation">(</span>eg, section<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:Ministry of Water Slides
</span><span class="code-line">Common Name <span class="token punctuation">(</span>e.g. server FQDN or YOUR name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:your_domain.com
</span><span class="code-line">Email Address <span class="token punctuation">[</span><span class="token punctuation">]</span>:admin@your_domain.com
</span></code><div onclick="copied(this)" data-code="sudo mkdir /etc/nginx/ssl
# 创建了有效期100年，加密强度为RSA2048的SSL密钥key和X509证书文件。
sudo openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt
# 上面命令，会有下面需要填写内容
Country Name (2 letter code) [AU]:US
State or Province Name (full name) [Some-State]:New York
Locality Name (eg, city) []:New York City
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Bouncy Castles, Inc.
Organizational Unit Name (eg, section) []:Ministry of Water Slides
Common Name (e.g. server FQDN or YOUR name) []:your_domain.com
Email Address []:admin@your_domain.com
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>创建自签证书</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">首先，创建证书和私钥的目录
</span><span class="code-line"><span class="token comment"># mkdir -p /etc/nginx/cert</span>
</span><span class="code-line"><span class="token comment"># cd /etc/nginx/cert</span>
</span><span class="code-line">创建服务器私钥，命令会让你输入一个口令：
</span><span class="code-line"><span class="token comment"># openssl genrsa -des3 -out nginx.key 2048</span>
</span><span class="code-line">创建签名请求的证书（CSR）：
</span><span class="code-line"><span class="token comment"># openssl req -new -key nginx.key -out nginx.csr</span>
</span><span class="code-line">在加载SSL支持的Nginx并使用上述私钥时除去必须的口令：
</span><span class="code-line"><span class="token comment"># cp nginx.key nginx.key.org</span>
</span><span class="code-line"><span class="token comment"># openssl rsa -in nginx.key.org -out nginx.key</span>
</span><span class="code-line">最后标记证书使用上述私钥和CSR：
</span><span class="code-line"><span class="token comment"># openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt</span>
</span></code><div onclick="copied(this)" data-code="首先，创建证书和私钥的目录
# mkdir -p /etc/nginx/cert
# cd /etc/nginx/cert
创建服务器私钥，命令会让你输入一个口令：
# openssl genrsa -des3 -out nginx.key 2048
创建签名请求的证书（CSR）：
# openssl req -new -key nginx.key -out nginx.csr
在加载SSL支持的Nginx并使用上述私钥时除去必须的口令：
# cp nginx.key nginx.key.org
# openssl rsa -in nginx.key.org -out nginx.key
最后标记证书使用上述私钥和CSR：
# openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>查看目前nginx编译选项</p>
    <pre><code class="code-highlight"><span class="code-line">sbin/nginx -V
</span></code><div onclick="copied(this)" data-code="sbin/nginx -V
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>输出下面内容</p>
    <pre><code class="code-highlight"><span class="code-line">nginx version: nginx/1.7.8
</span><span class="code-line">built by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)
</span><span class="code-line">TLS SNI support enabled
</span><span class="code-line">configure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre
</span></code><div onclick="copied(this)" data-code="nginx version: nginx/1.7.8
built by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)
TLS SNI support enabled
configure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>如果依赖的模块不存在，可以进入安装目录，输入下面命令重新编译安装。</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">./configure --prefix<span class="token operator">=</span>/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
</span></code><div onclick="copied(this)" data-code="./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>运行完成之后还需要<code>make</code> (不用make install)</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># 备份nginx的二进制文件</span>
</span><span class="code-line"><span class="token function">cp</span> -rf /usr/local/nginx/sbin/nginx　 /usr/local/nginx/sbin/nginx.bak
</span><span class="code-line"><span class="token comment"># 覆盖nginx的二进制文件</span>
</span><span class="code-line"><span class="token function">cp</span> -rf objs/nginx   /usr/local/nginx/sbin/
</span></code><div onclick="copied(this)" data-code="# 备份nginx的二进制文件
cp -rf /usr/local/nginx/sbin/nginx　 /usr/local/nginx/sbin/nginx.bak
# 覆盖nginx的二进制文件
cp -rf objs/nginx   /usr/local/nginx/sbin/
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>HTTPS server</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/ssl/nginx.crt</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/ssl/nginx.key</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment"># 禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment"># 设置ssl/tls会话缓存的类型和大小。如果设置了这个参数一般是shared，buildin可能会参数内存碎片，默认是none，和off差不多，停用缓存。如shared:SSL:10m表示我所有的nginx工作进程共享ssl会话缓存，官网介绍说1M可以存放约4000个sessions。 </span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_session_cache</span>    shared:SSL:1m</span><span class="token punctuation">;</span> 
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># 客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_session_timeout</span>  <span class="token number">5m</span></span><span class="token punctuation">;</span> 
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># 选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。</span>
</span><span class="code-line">    <span class="token comment"># 这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher 'RC4:HIGH:!aNULL:!MD5'（后面是你所指定的套件加密算法） 来看所支持算法。</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_ciphers</span>  HIGH:!aNULL:!MD5</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># 设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
    listen       443 ssl;
    server_name  localhost;

    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;
    # 禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击
    server_tokens off;
    # 设置ssl/tls会话缓存的类型和大小。如果设置了这个参数一般是shared，buildin可能会参数内存碎片，默认是none，和off差不多，停用缓存。如shared:SSL:10m表示我所有的nginx工作进程共享ssl会话缓存，官网介绍说1M可以存放约4000个sessions。 
    ssl_session_cache    shared:SSL:1m; 

    # 客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。
    ssl_session_timeout  5m; 

    # 选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。
    # 这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher &#x27;RC4:HIGH:!aNULL:!MD5&#x27;（后面是你所指定的套件加密算法） 来看所支持算法。
    ssl_ciphers  HIGH:!aNULL:!MD5;

    # 设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。
    ssl_prefer_server_ciphers  on;

    location / {
        root   html;
        index  index.html index.htm;
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="强制将http重定向到https"><a class="anchor" aria-hidden="true" tabindex="-1" href="#强制将http重定向到https"><span class="octicon octicon-link"></span></a>强制将http重定向到https</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>  example.com</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">rewrite</span> ^ https://<span class="token variable">$http_host</span><span class="token variable">$request_uri?</span> permanent</span><span class="token punctuation">;</span>    <span class="token comment"># 强制将http重定向到https</span>
</span><span class="code-line">    <span class="token comment"># 在错误页面和“服务器”响应头字段中启用或禁用发射nginx版本。 防止黑客利用版本漏洞攻击</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
    listen       80;
    server_name  example.com;
    rewrite ^ https://$http_host$request_uri? permanent;    # 强制将http重定向到https
    # 在错误页面和“服务器”响应头字段中启用或禁用发射nginx版本。 防止黑客利用版本漏洞攻击
    server_tokens off;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="两个虚拟主机"><a class="anchor" aria-hidden="true" tabindex="-1" href="#两个虚拟主机"><span class="octicon octicon-link"></span></a>两个虚拟主机</h3>
    <p>纯静态-html 支持</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">server_name</span>     www.domain1.com</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">access_log</span>      logs/domain1.access.log main</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token directive"><span class="token keyword">root</span>  /var/www/domain1.com/htdocs</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">server_name</span>     www.domain2.com</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">access_log</span>      logs/domain2.access.log main</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token directive"><span class="token keyword">root</span>  /var/www/domain2.com/htdocs</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="http {
    server {
        listen          80;
        server_name     www.domain1.com;
        access_log      logs/domain1.access.log main;
        location / {
            index index.html;
            root  /var/www/domain1.com/htdocs;
        }
    }
    server {
        listen          80;
        server_name     www.domain2.com;
        access_log      logs/domain2.access.log main;
        location / {
            index index.html;
            root  /var/www/domain2.com/htdocs;
        }
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="虚拟主机标准配置"><a class="anchor" aria-hidden="true" tabindex="-1" href="#虚拟主机标准配置"><span class="octicon octicon-link"></span></a>虚拟主机标准配置</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span> default</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>     _ *</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">access_log</span>      logs/default.access.log main</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">       <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
</span><span class="code-line">       <span class="token directive"><span class="token keyword">root</span>  /var/www/default/htdocs</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="http {
  server {
    listen          80 default;
    server_name     _ *;
    access_log      logs/default.access.log main;
    location / {
       index index.html;
       root  /var/www/default/htdocs;
    }
  }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="爬虫过滤"><a class="anchor" aria-hidden="true" tabindex="-1" href="#爬虫过滤"><span class="octicon octicon-link"></span></a>爬虫过滤</h3>
    <p>根据 <code>User-Agent</code> 过滤请求，通过一个简单的正则表达式，就可以过滤不符合要求的爬虫请求(初级爬虫)。</p>
    <blockquote>
      <p><code>~*</code> 表示不区分大小写的正则匹配</p>
    </blockquote>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* <span class="token string">"python|curl|java|wget|httpclient|okhttp"</span>)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">return</span> <span class="token number">503</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token comment"># 正常处理</span>
</span><span class="code-line">    <span class="token comment"># ...</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location / {
    if ($http_user_agent ~* &#x22;python|curl|java|wget|httpclient|okhttp&#x22;) {
        return 503;
    }
    # 正常处理
    # ...
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="防盗链"><a class="anchor" aria-hidden="true" tabindex="-1" href="#防盗链"><span class="octicon octicon-link"></span></a>防盗链</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|png|swf|flv)$</span> <span class="token punctuation">{</span>
</span><span class="code-line">   <span class="token directive"><span class="token keyword">root</span> html
</span></span><span class="code-line"><span class="token directive">   valid_referers none blocked *.nginxcn.com</span><span class="token punctuation">;</span>
</span><span class="code-line">   <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
</span><span class="code-line">     rewrite ^/ www.nginx.cn
</span><span class="code-line">     <span class="token comment">#return 404;</span>
</span><span class="code-line">   <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location ~* \.(gif|jpg|png|swf|flv)$ {
   root html
   valid_referers none blocked *.nginxcn.com;
   if ($invalid_referer) {
     rewrite ^/ www.nginx.cn
     #return 404;
   }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="虚拟目录配置"><a class="anchor" aria-hidden="true" tabindex="-1" href="#虚拟目录配置"><span class="octicon octicon-link"></span></a>虚拟目录配置</h3>
    <p>alias指定的目录是准确的，root是指定目录的上级目录，并且该上级目录要含有location指定名称的同名目录。</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> /img/</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">alias</span> /var/www/image/</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token comment"># 访问/img/目录里面的文件时，ningx会自动去/var/www/image/目录找文件</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">location</span> /img/</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">root</span> /var/www/image</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token comment"># 访问/img/目录下的文件时，nginx会去/var/www/image/img/目录下找文件。]</span>
</span></code><div onclick="copied(this)" data-code="location /img/ {
    alias /var/www/image/;
}
# 访问/img/目录里面的文件时，ningx会自动去/var/www/image/目录找文件
location /img/ {
    root /var/www/image;
}
# 访问/img/目录下的文件时，nginx会去/var/www/image/img/目录下找文件。]
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="防盗图配置"><a class="anchor" aria-hidden="true" tabindex="-1" href="#防盗图配置"><span class="octicon octicon-link"></span></a>防盗图配置</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> ~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">valid_referers</span> none blocked *.jslite.io</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/  http://wangchujiang.com/piratesp.png</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location ~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf) {
    valid_referers none blocked *.jslite.io;
    if ($invalid_referer) {
        rewrite ^/  http://wangchujiang.com/piratesp.png;
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="屏蔽git等文件"><a class="anchor" aria-hidden="true" tabindex="-1" href="#屏蔽git等文件"><span class="octicon octicon-link"></span></a>屏蔽.git等文件</h3>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">location</span> ~ (.git|.gitattributes|.gitignore|.svn)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="location ~ (.git|.gitattributes|.gitignore|.svn) {
    deny all;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="域名路径加不加需要都能正常访问"><a class="anchor" aria-hidden="true" tabindex="-1" href="#域名路径加不加需要都能正常访问"><span class="octicon octicon-link"></span></a>域名路径加不加需要都能正常访问</h3>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">http://wangchujiang.com/api/index.php?a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&#x26;</span><span class="token assign-left variable">name</span><span class="token operator">=</span>wcj
</span><span class="code-line">                                  ^ 有后缀
</span><span class="code-line">
</span><span class="code-line">http://wangchujiang.com/api/index?a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&#x26;</span><span class="token assign-left variable">name</span><span class="token operator">=</span>wcj
</span><span class="code-line">                                 ^ 没有后缀
</span></code><div onclick="copied(this)" data-code="http://wangchujiang.com/api/index.php?a=1&#x26;name=wcj
                                  ^ 有后缀

http://wangchujiang.com/api/index?a=1&#x26;name=wcj
                                 ^ 没有后缀
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>nginx rewrite规则如下：</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)/$ /index.php?/<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">if</span> (!-d <span class="token variable">$request_filename</span>)</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$rule_1</span> 1<span class="token variable">$rule_1</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">if</span> (!-f <span class="token variable">$request_filename</span>)</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$rule_1</span> 2<span class="token variable">$rule_1</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$rule_1</span> = <span class="token string">"21"</span>)</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/ /index.php last</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="rewrite ^/(.*)/$ /index.php?/$1 permanent;
if (!-d $request_filename){
        set $rule_1 1$rule_1;
}
if (!-f $request_filename){
        set $rule_1 2$rule_1;
}
if ($rule_1 = &#x22;21&#x22;){
        rewrite ^/ /index.php last;
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h3 id="cockpit"><a class="anchor" aria-hidden="true" tabindex="-1" href="#cockpit"><span class="octicon octicon-link"></span></a>cockpit</h3>
    <p><a href="https://github.com/cockpit-project/cockpit">https://github.com/cockpit-project/cockpit</a></p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span> cockpit.xxxxxxx.com</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"> 
</span><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span> cockpit.xxxxxxx.com</span><span class="token punctuation">;</span>
</span><span class="code-line"> 
</span><span class="code-line">    <span class="token comment">#ssl on;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/cert/cockpit.xxxxxxx.com.pem</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/cert/cockpit.xxxxxxx.com.key</span><span class="token punctuation">;</span>
</span><span class="code-line"> 
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">root</span> /</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://websocket</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">"upgrade"</span></span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server{
    listen 80;
    server_name cockpit.xxxxxxx.com;
    return 301 https://$server_name$request_uri;
}
 
server {
    listen 443 ssl;
    server_name cockpit.xxxxxxx.com;
 
    #ssl on;
    ssl_certificate /etc/nginx/cert/cockpit.xxxxxxx.com.pem;
    ssl_certificate_key /etc/nginx/cert/cockpit.xxxxxxx.com.key;
 
    location / {
        root /;
        index index.html;
        proxy_redirect off;
        proxy_pass http://websocket;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &#x22;upgrade&#x22;;
        proxy_set_header Host $http_host;
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>这时输入域名，能看到登录页面，但登录后，显示不出内容，页面全白。这里要对 <code>cockpit.conf</code> 进行设置修改。</p>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/cockpit/cockpit.conf
</span></code><div onclick="copied(this)" data-code="sudo vim /etc/cockpit/cockpit.conf
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>参照如下配置修改，注意域名替换为 <code>your_domain_host</code>：</p>
    <pre class="language-toml"><code class="language-toml code-highlight"><span class="code-line"><span class="token punctuation">[</span><span class="token table class-name">WebService</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token key property">Origins</span> <span class="token punctuation">=</span> https://cockpit<span class="token punctuation">.</span>xxxxxxx<span class="token punctuation">.</span>com https://<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span>:<span class="token number">9090</span>
</span><span class="code-line"><span class="token key property">ProtocolHeader</span> <span class="token punctuation">=</span> X-Forwarded-Proto
</span><span class="code-line"><span class="token key property">AllowUnencrypted</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span></code><div onclick="copied(this)" data-code="[WebService]
Origins = https://cockpit.xxxxxxx.com https://127.0.0.1:9090
ProtocolHeader = X-Forwarded-Proto
AllowUnencrypted = true
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="错误问题"><a class="anchor" aria-hidden="true" tabindex="-1" href="#错误问题"><span class="octicon octicon-link"></span></a>错误问题</h2>
    <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">The plain HTTP request was sent to HTTPS port
</span></code><div onclick="copied(this)" data-code="The plain HTTP request was sent to HTTPS port
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <p>解决办法，<code>fastcgi_param HTTPS $https if_not_empty</code> 添加这条规则，</p>
    <pre class="language-nginx"><code class="language-nginx code-highlight"><span class="code-line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span> <span class="token comment"># 注意这条规则</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">server_name</span>  my.domain.com</span><span class="token punctuation">;</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token directive"><span class="token keyword">fastcgi_param</span> HTTPS <span class="token variable">$https</span> if_not_empty</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">fastcgi_param</span> HTTPS <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/ssl/certs/your.pem</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/ssl/private/your.key</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment"># Your config here...</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div onclick="copied(this)" data-code="server {
    listen 443 ssl; # 注意这条规则
    server_name  my.domain.com;
    
    fastcgi_param HTTPS $https if_not_empty;
    fastcgi_param HTTPS on;

    ssl_certificate /etc/ssl/certs/your.pem;
    ssl_certificate_key /etc/ssl/private/your.key;

    location / {
        # Your config here...
    }
}
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="nginx-模块"><a class="anchor" aria-hidden="true" tabindex="-1" href="#nginx-模块"><span class="octicon octicon-link"></span></a>Nginx 模块</h2>
    <ul>
      <li><a href="https://gitlab.com/rbdr/ngx_http_office_hours_filter_module">Nginx Office Hours</a> 一个 nginx 模块，允许您仅在办公时间内提供访问访问网站。</li>
    </ul>
    <h2 id="精品文章参考"><a class="anchor" aria-hidden="true" tabindex="-1" href="#精品文章参考"><span class="octicon octicon-link"></span></a>精品文章参考</h2>
    <ul>
      <li><a href="https://my.oschina.net/u/3341316/blog/877206">负载均衡原理的解析</a></li>
      <li><a href="http://blog.githuber.cn/posts/73">Nginx泛域名解析，实现多个二级域名</a></li>
      <li><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">深入 NGINX: 我们如何设计性能和扩展</a></li>
      <li><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">Inside NGINX: How We Designed for Performance &#x26; Scale</a></li>
      <li><a href="http://tengine.taobao.org/book/index.html">Nginx开发从入门到精通</a></li>
      <li><a href="http://os.51cto.com/art/201703/535326.htm#topx">Nginx的优化与防盗链</a></li>
      <li><a href="https://segmentfault.com/a/1190000009769143">实战开发一个Nginx扩展 (Nginx Module)</a></li>
      <li><a href="https://my.oschina.net/xshuai/blog/917097">Nginx+Keepalived(双机热备)搭建高可用负载均衡环境(HA)</a></li>
      <li><a href="http://www.huxd.org/articles/2017/07/24/1500890692329.html">Nginx 平滑升级</a></li>
      <li><a href="https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&#x26;mid=2247483708&#x26;idx=1&#x26;sn=90b0b1dccd9c337922a0588245277666&#x26;chksm=97f38cf7a08405e1928e0b46d923d630e529e7db8ac7ca2a91310a075986f8bcb2cee5b4953d#rd">Nginx最新模块—ngx_http_mirror_module分析可以做版本发布前的预先验证，进行流量放大后的压测等等</a></li>
    </ul>
    <h2 id="contributors"><a class="anchor" aria-hidden="true" tabindex="-1" href="#contributors"><span class="octicon octicon-link"></span></a>Contributors</h2>
    <p>As always, thanks to our amazing contributors!</p><a href="https://github.com/jaywcjlove/nginx-tutorial/graphs/contributors"><img src="https://jaywcjlove.github.io/nginx-tutorial/CONTRIBUTORS.svg"></a>
    <p>Made with <a href="https://github.com/jaywcjlove/github-action-contributors">action-contributors</a>.</p>
    <h2 id="license"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license"><span class="octicon octicon-link"></span></a>License</h2>
    <p>Licensed under the MIT License.</p>
  <style>.markdown-body pre .copied {
  
  visibility: hidden;
  position: absolute;
  cursor: pointer;
  color: #a5afbb;
  top: 6px;
  right: 6px;
  border-radius: 5px;
  background: #82828226;
  padding: 6px;
  font-size: 12px;
  transition: all .3s;
}
.markdown-body pre .copied:not(.active) {
  visibility: hidden;
}
.markdown-body pre:hover .copied {
  visibility: visible;
}
.markdown-body pre:hover .copied:hover {
  background: #4caf50;
  color: #fff;
}
.markdown-body pre:hover .copied:active,
.markdown-body pre .copied.active {
  background: #2e9b33;
  color: #fff;
}
.markdown-body pre .copied .octicon-copy {
  display: block;
}
.markdown-body pre .copied .octicon-check {
  display: none;
}
.markdown-body pre .active .octicon-copy {
  display: none;
}
.markdown-body pre .active .octicon-check {
  display: block;
}</style><script>/*! @uiw/copy-to-clipboard v1.0.12 | MIT (c) 2021 Kenny Wang | https://github.com/uiwjs/copy-to-clipboard.git */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).copyTextToClipboard=t()}(this,(function(){"use strict";return function(e,t){const o=document.createElement("textarea");o.value=e,o.setAttribute("readonly",""),o.style={position:"absolute",left:"-9999px"},document.body.appendChild(o);const n=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);o.select();let c=!1;try{c=!!document.execCommand("copy")}catch(e){c=!1}document.body.removeChild(o),n&&document.getSelection&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(n)),t&&t(c)}}));

function copied(target, str) {
  target.classList.add('active');
  copyTextToClipboard(target.dataset.code, function() {
    setTimeout(() => {
      target.classList.remove('active');
    }, 2000);
  });
}</script></markdown-style></body>
</html>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Nginx Tutorial å…¥é—¨æ•™ç¨‹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta description="Nginx æ˜¯ä¸€æ¬¾é¢å‘æ€§èƒ½è®¾è®¡çš„ HTTP æœåŠ¡å™¨ï¼Œèƒ½åå‘ä»£ç† HTTPï¼ŒHTTPS å’Œé‚®ä»¶ç›¸å…³(SMTPï¼ŒPOP3ï¼ŒIMAP)çš„åè®®é“¾æ¥ã€‚å¹¶ä¸”æä¾›äº†è´Ÿè½½å‡è¡¡ä»¥åŠ HTTP ç¼“å­˜ã€‚å®ƒçš„è®¾è®¡å……åˆ†ä½¿ç”¨å¼‚æ­¥äº‹ä»¶æ¨¡å‹ï¼Œå‰Šå‡ä¸Šä¸‹æ–‡è°ƒåº¦çš„å¼€é”€ï¼Œæé«˜æœåŠ¡å™¨å¹¶å‘èƒ½åŠ›ã€‚é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œæä¾›äº†ä¸°å¯Œæ¨¡å—çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚">
    <meta keywords="nginx,tutorial,centos">
    <link rel="icon" href="data:image/svg+xml;utf8,<svg viewBox=&#x27;0 0 1024 1024&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;><path d=&#x27;M900.3614811 232.86518557l-339.81629553-194.18074112c-29.12711111-16.99081443-65.536-16.99081443-97.09037114 0l-339.81629553 194.18074112c-29.12711111 16.99081443-48.54518557 48.54518557-48.54518557 84.95407331v388.36148224c0 33.98163001 19.41807445 67.96325888 48.54518557 84.95407331l339.81629553 194.18074112c29.12711111 16.99081443 65.536 16.99081443 97.09037114 0l339.81629553-194.18074112c29.12711111-16.99081443 48.54518557-48.54518557 48.54518557-84.95407331V317.81925888c0-33.98163001-19.41807445-65.536-48.54518557-84.95407331z m-228.16236999 490.30636998c-21.84533333 0-48.54518557-9.70903666-65.536-29.1271111L390.63703666 436.75496334v240.29866667c0 26.69985223-19.41807445 46.11792555-46.11792555 46.11792554H342.09185223c-26.69985223 0-46.11792555-21.84533333-46.11792668-46.11792554V346.94636999c0-24.27259221 21.84533333-46.11792555 53.39970446-46.11792554 24.27259221 0 48.54518557 9.70903666 65.536 29.1271111l216.02607332 257.28948111v-240.29866667c0-26.69985223 21.84533333-46.11792555 46.11792668-46.11792554h2.42725888c26.69985223 0 46.11792555 21.84533333 46.11792554 46.11792554v330.10726002c2.42725888 26.69985223-21.84533333 46.11792555-53.39970332 46.11792554z&#x27; fill=&#x27;#1ac807&#x27;></path></svg>" type="image/x-icon">
    <style>.task-list-item { list-style-type: none;}.task-list-item label { font-weight: 400;}.task-list-item.enabled label { cursor: pointer;}.task-list-item+.task-list-item { margin-top: 3px;}.task-list-item .handle { display: none;}.task-list-item-checkbox { margin: 0 .2em .25em -1.6em; vertical-align: middle;}.wmde-markdown h1,.wmde-markdown h2,.wmde-markdown h3,.wmde-markdown h4,.wmde-markdown h5,.wmde-markdown h6 { font-weight: 600; line-height: 1.25; margin-bottom: 16px; margin-top: 24px;}.wmde-markdown h1 .anchor,.wmde-markdown h2 .anchor,.wmde-markdown h3 .anchor,.wmde-markdown h4 .anchor,.wmde-markdown h5 .anchor,.wmde-markdown h6 .anchor { float: left; padding-right: 4px; margin-left: -20px; line-height: 1;}.wmde-markdown h1 .octicon-link,.wmde-markdown h2 .octicon-link,.wmde-markdown h3 .octicon-link,.wmde-markdown h4 .octicon-link,.wmde-markdown h5 .octicon-link,.wmde-markdown h6 .octicon-link { visibility: hidden; vertical-align: middle;}.wmde-markdown h1:hover .octicon-link,.wmde-markdown h2:hover .octicon-link,.wmde-markdown h3:hover .octicon-link,.wmde-markdown h4:hover .octicon-link,.wmde-markdown h5:hover .octicon-link,.wmde-markdown h6:hover .octicon-link { visibility: visible;}.github-corner:hover .octo-arm { -webkit-animation: octocat-wave .56s ease-in-out; animation: octocat-wave .56s ease-in-out;}@-webkit-keyframes octocat-wave { 0%, to { -webkit-transform: rotate(0); transform: rotate(0); } 20%, 60% { -webkit-transform: rotate(-25deg); transform: rotate(-25deg); } 40%, 80% { -webkit-transform: rotate(10deg); transform: rotate(10deg); }}@keyframes octocat-wave { 0%, to { -webkit-transform: rotate(0); transform: rotate(0) } 20%, 60% { -webkit-transform: rotate(-25deg); transform: rotate(-25deg); } 40%, 80% { -webkit-transform: rotate(10deg); transform: rotate(10deg); }}.wmde-markdown { font-size: 16px; line-height: 1.5; font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji; max-width: 1024px; margin: 28px auto 60px auto;}.wmde-markdown > :first-child { margin-top: 0 !important;}.wmde-markdown > :last-child { margin-bottom: 0 !important;}.wmde-markdown code[class*="language-"],.wmde-markdown pre[class*="language-"] { color: black; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; word-wrap: normal; -webkit-hyphens: none; hyphens: none;}.wmde-markdown pre code { background: none; overflow-wrap: normal; white-space: inherit; -moz-tab-size: 2; tab-size: 2; padding: 16px; font-size: 95%; line-height: 1.5; display: block; text-shadow: 0 1px #fff;}.wmde-markdown pre { margin-bottom: 18px; font-size: 85%; line-height: 1.45; position: relative; overflow-x: auto; background-color: #f6f8fa; border-radius: 3px;}.wmde-markdown code,.wmde-markdown tt { background-color: rgba(27, 31, 35, 0.05); border-radius: 3px; font-size: 85%; margin: 0; padding: 0.2em 0.4em;}.wmde-markdown pre,.wmde-markdown code,.wmde-markdown tt { font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;}.wmde-markdown img { max-width: 100%;}.wmde-markdown input { vertical-align: middle; margin: 0 0.2em 0.25em -1.6em;}.wmde-markdown input + p { display: inline;}.wmde-markdown h1,.wmde-markdown h2 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em;}.wmde-markdown h1,.wmde-markdown h2,.wmde-markdown h3,.wmde-markdown h4,.wmde-markdown h5,.wmde-markdown h6 { font-weight: 600; line-height: 1.25; margin-bottom: 16px; margin-top: 24px;}.wmde-markdown h1 .anchor,.wmde-markdown h2 .anchor,.wmde-markdown h3 .anchor,.wmde-markdown h4 .anchor,.wmde-markdown h5 .anchor,.wmde-markdown h6 .anchor { float: left; padding-right: 4px; margin-left: -20px; line-height: 1;}.wmde-markdown h1 .octicon-link,.wmde-markdown h2 .octicon-link,.wmde-markdown h3 .octicon-link,.wmde-markdown h4 .octicon-link,.wmde-markdown h5 .octicon-link,.wmde-markdown h6 .octicon-link { visibility: hidden; vertical-align: middle;}.wmde-markdown h1:hover .octicon-link,.wmde-markdown h2:hover .octicon-link,.wmde-markdown h3:hover .octicon-link,.wmde-markdown h4:hover .octicon-link,.wmde-markdown h5:hover .octicon-link,.wmde-markdown h6:hover .octicon-link { visibility: visible;}.wmde-markdown h1 { font-size: 2em;}.wmde-markdown h2 { font-size: 1.5em;}.wmde-markdown h3 { font-size: 1.25em;}.wmde-markdown h4 { font-size: 1em;}.wmde-markdown h5 { font-size: 0.875em;}.wmde-markdown h6 { font-size: 0.85em;}.wmde-markdown ol,.wmde-markdown ul { padding-left: 2em;}.wmde-markdown ol > p,.wmde-markdown ul > p { margin-bottom: 0;}.wmde-markdown ul { margin-bottom: 16px; margin-top: 0; list-style: initial;}.wmde-markdown > blockquote,.wmde-markdown > blockquote blockquote { margin: 0; border-left: 0.25em solid #dfe2e5; color: #6a737d; padding: 0 1em;}.wmde-markdown > blockquote > :last-child,.wmde-markdown > blockquote blockquote > :last-child { margin-bottom: 0;}.wmde-markdown > blockquote > :first-child,.wmde-markdown > blockquote blockquote > :first-child { margin-top: 0;}.wmde-markdown hr { margin: 1.5em auto; border: 0; border-top: 2px dotted #eee; height: 1px;}.wmde-markdown > table,.wmde-markdown > blockquote table { display: block; overflow: auto; width: 100%; border-collapse: collapse; border-spacing: 0; font-size: 14px;}.wmde-markdown > table tr,.wmde-markdown > blockquote table tr { background-color: #fff; border-top: 1px solid #c6cbd1;}.wmde-markdown > table td,.wmde-markdown > blockquote table td,.wmde-markdown > table th,.wmde-markdown > blockquote table th { border: 1px solid #dfe2e5; padding: 6px 13px;}.wmde-markdown blockquote,.wmde-markdown details,.wmde-markdown dl,.wmde-markdown ol,.wmde-markdown p,.wmde-markdown pre,.wmde-markdown table,.wmde-markdown ul { margin-bottom: 16px; margin-top: 0;}.wmde-markdown a { color: #0366d6; text-decoration: none;}.wmde-markdown a:hover { text-decoration: underline;}.wmde-markdown .namespace { opacity: 0.7;}.wmde-markdown .token.important { font-weight: normal;}.wmde-markdown .token.bold { font-weight: bold;}.wmde-markdown .token.italic { font-style: italic;}.wmde-markdown .token.entity { cursor: help;}.wmde-markdown kbd { background-color: #fafbfc; border-bottom-color: #d1d5da; border: 1px solid #d1d5da; border-radius: 3px; box-shadow: inset 0 -1px 0 #d1d5da; color: #56595d; display: inline-block; font-size: 10px; font-family: ui-monospace, SFMono-Regular, SF Mono, Consolas, Liberation Mono, Menlo, monospace; line-height: 10px; padding: 2px 4px; vertical-align: middle;}.wmde-markdown .token.tag .attr-value { color: #032f62;}.wmde-markdown .token.property,.wmde-markdown .token.tag,.wmde-markdown .token.boolean,.wmde-markdown .token.number,.wmde-markdown .token.function-name,.wmde-markdown .token.constant,.wmde-markdown .token.symbol,.wmde-markdown .token.deleted { color: #0060c9;}.wmde-markdown .token.punctuation { color: #a0a0a0;}.wmde-markdown code[class*="language-"] { color: black;}.wmde-markdown code[class*="language-"] .token.selector,.wmde-markdown code[class*="language-"] .token.attr-name,.wmde-markdown code[class*="language-"] .token.string,.wmde-markdown code[class*="language-"] .token.char,.wmde-markdown code[class*="language-"] .token.function,.wmde-markdown code[class*="language-"] .token.builtin { color: #6f42c1;}.wmde-markdown code[class*="language-"] .token.inserted { color: #22863a; background-color: #f0fff4;}.wmde-markdown code[class*="language-"] .token.deleted { color: #b31d28; background-color: #ffeef0;}.wmde-markdown code[class*="language-"] .token.class-name { color: #6f42c1;}.wmde-markdown code[class*="language-"] .code-block { color: #032f62;}.wmde-markdown code[class*="language-"] .token.comment,.wmde-markdown code[class*="language-"] .token.block-comment,.wmde-markdown code[class*="language-"] .token.prolog,.wmde-markdown code[class*="language-"] .token.doctype,.wmde-markdown code[class*="language-"] .token.cdata { color: #7D8B99;}.wmde-markdown code[class*="language-"] .token.punctuation { color: #a0a0a0;}.wmde-markdown code[class*="language-"] .token.operator,.wmde-markdown code[class*="language-"] .token.entity,.wmde-markdown code[class*="language-"] .token.url,.wmde-markdown code[class*="language-"] .token.variable { color: #d73a49; background: rgba(255, 255, 255, 0.5);}.wmde-markdown code[class*="language-"] .token.atrule,.wmde-markdown code[class*="language-"] .token.attr-value { color: #004698;}.wmde-markdown code[class*="language-"] .token.keyword { color: #d63200;}.wmde-markdown code[class*="language-"] .token.regex,.wmde-markdown code[class*="language-"] .token.important { color: #e90;}.wmde-markdown code[class*="language-"] .token.string { color: #0a53c1;}</style>
    <style></style>
  </head>
  <body><div class="wmde-markdown"><a aria-label="View source on GitHub" target="__blank" class="github-corner" href="https://github.com/jaywcjlove/nginx-tutorial"><svg width="54" height="54" viewBox="0 0 250 250" aria-hidden="true" style="fill: rgb(32, 34, 37); color: rgb(255, 255, 255); position: fixed; z-index: 99999; border: 0px; top: 0px; right: 0px;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path style="transform-origin: 130px 106px;" class="octo-arm" fill="currentColor" d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"></path><path class="octo-body" fill="currentColor" d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"></path></svg></a>
    <p align="center"><a href="http://nginx.org/"><img width="210" src="./nginx.svg"></a></p>
    <p>Nginx æ˜¯ä¸€æ¬¾é¢å‘æ€§èƒ½è®¾è®¡çš„ HTTP æœåŠ¡å™¨ï¼Œèƒ½åå‘ä»£ç† HTTPï¼ŒHTTPS å’Œé‚®ä»¶ç›¸å…³(SMTPï¼ŒPOP3ï¼ŒIMAP)çš„åè®®é“¾æ¥ã€‚å¹¶ä¸”æä¾›äº†è´Ÿè½½å‡è¡¡ä»¥åŠ HTTP ç¼“å­˜ã€‚å®ƒçš„è®¾è®¡å……åˆ†ä½¿ç”¨å¼‚æ­¥äº‹ä»¶æ¨¡å‹ï¼Œå‰Šå‡ä¸Šä¸‹æ–‡è°ƒåº¦çš„å¼€é”€ï¼Œæé«˜æœåŠ¡å™¨å¹¶å‘èƒ½åŠ›ã€‚é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œæä¾›äº†ä¸°å¯Œæ¨¡å—çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚</p>
    <p>æ‰€ä»¥å…³äº Nginxï¼Œæœ‰è¿™äº›æ ‡ç­¾ï¼šã€Œå¼‚æ­¥ã€ã€Œäº‹ä»¶ã€ã€Œæ¨¡å—åŒ–ã€ã€Œé«˜æ€§èƒ½ã€ã€Œé«˜å¹¶å‘ã€ã€Œåå‘ä»£ç†ã€ã€Œè´Ÿè½½å‡è¡¡ã€</p>
    <p>
      Linuxç³»ç»Ÿï¼š<code>Centos 7 x64</code>
      Nginxç‰ˆæœ¬ï¼š<code>1.11.5</code>
    </p>
    <h1 id="ç›®å½•"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ç›®å½•"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ç›®å½•</h1>
    <ul>
      <li><a href="#%E5%AE%89%E8%A3%85">å®‰è£…</a>
        <ul>
          <li><a href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96">å®‰è£…ä¾èµ–</a></li>
          <li><a href="#%E4%B8%8B%E8%BD%BD">ä¸‹è½½</a></li>
          <li><a href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85">ç¼–è¯‘å®‰è£…</a></li>
          <li><a href="#nginx%E6%B5%8B%E8%AF%95">nginxæµ‹è¯•</a></li>
          <li><a href="#%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%80nginx%E5%91%BD%E4%BB%A4">è®¾ç½®å…¨å±€nginxå‘½ä»¤</a></li>
        </ul>
      </li>
      <li><a href="#mac-%E5%AE%89%E8%A3%85">Mac å®‰è£…</a>
        <ul>
          <li><a href="#%E5%AE%89%E8%A3%85nginx">å®‰è£…nginx</a></li>
          <li><a href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1">å¯åŠ¨æœåŠ¡</a></li>
        </ul>
      </li>
      <li><a href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8">å¼€æœºè‡ªå¯åŠ¨</a></li>
      <li><a href="#%E8%BF%90%E7%BB%B4">è¿ç»´</a>
        <ul>
          <li><a href="#%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86">æœåŠ¡ç®¡ç†</a></li>
          <li><a href="#%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3">é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³</a></li>
        </ul>
      </li>
      <li><a href="#nginx%E5%8D%B8%E8%BD%BD">nginxå¸è½½</a></li>
      <li><a href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">å‚æ•°è¯´æ˜</a></li>
      <li><a href="#%E9%85%8D%E7%BD%AE">é…ç½®</a>
        <ul>
          <li><a href="#%E5%B8%B8%E7%94%A8%E6%AD%A3%E5%88%99">å¸¸ç”¨æ­£åˆ™</a></li>
          <li><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">å…¨å±€å˜é‡</a></li>
          <li><a href="#%E7%AC%A6%E5%8F%B7%E5%8F%82%E8%80%83">ç¬¦å·å‚è€ƒ</a></li>
          <li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">é…ç½®æ–‡ä»¶</a></li>
          <li><a href="#%E5%86%85%E7%BD%AE%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F">å†…ç½®é¢„å®šä¹‰å˜é‡</a></li>
          <li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">åå‘ä»£ç†</a></li>
          <li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">è´Ÿè½½å‡è¡¡</a>
            <ul>
              <li><a href="#rr">RR</a></li>
              <li><a href="#%E6%9D%83%E9%87%8D">æƒé‡</a></li>
              <li><a href="#ip_hash">ip_hash</a></li>
              <li><a href="#fair">fair</a></li>
              <li><a href="#url_hash">url_hash</a></li>
            </ul>
          </li>
          <li><a href="#%E5%B1%8F%E8%94%BDip">å±è”½ip</a></li>
        </ul>
      </li>
      <li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95">ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•</a></li>
      <li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91">é‡å®šå‘</a>
        <ul>
          <li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%95%B4%E4%B8%AA%E7%BD%91%E7%AB%99">é‡å®šå‘æ•´ä¸ªç½‘ç«™</a></li>
          <li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91%E5%8D%95%E9%A1%B5">é‡å®šå‘å•é¡µ</a></li>
          <li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%95%B4%E4%B8%AA%E5%AD%90%E8%B7%AF%E5%BE%84">é‡å®šå‘æ•´ä¸ªå­è·¯å¾„</a></li>
        </ul>
      </li>
      <li><a href="#%E6%80%A7%E8%83%BD">æ€§èƒ½</a>
        <ul>
          <li><a href="#%E5%86%85%E5%AE%B9%E7%BC%93%E5%AD%98">å†…å®¹ç¼“å­˜</a></li>
          <li><a href="#gzip%E5%8E%8B%E7%BC%A9">Gzipå‹ç¼©</a></li>
          <li><a href="#%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6%E7%BC%93%E5%AD%98">æ‰“å¼€æ–‡ä»¶ç¼“å­˜</a></li>
          <li><a href="#ssl%E7%BC%93%E5%AD%98">SSLç¼“å­˜</a></li>
          <li><a href="#%E4%B8%8A%E6%B8%B8keepalive">ä¸Šæ¸¸Keepalive</a></li>
          <li><a href="#%E7%9B%91%E6%8E%A7">ç›‘æ§</a></li>
        </ul>
      </li>
      <li><a href="#%E5%B8%B8%E8%A7%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">å¸¸è§ä½¿ç”¨åœºæ™¯</a>
        <ul>
          <li><a href="#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98">è·¨åŸŸé—®é¢˜</a></li>
          <li><a href="#%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%B8%A6www%E7%9A%84%E5%9F%9F%E4%B8%8A%E9%9D%A2">è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢</a></li>
          <li><a href="#%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91">ä»£ç†è½¬å‘</a></li>
          <li><a href="#%E7%9B%91%E6%8E%A7%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF">ç›‘æ§çŠ¶æ€ä¿¡æ¯</a></li>
          <li><a href="#%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91%E8%BF%9E%E6%8E%A5%E6%9B%BF%E6%8D%A2">ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢</a></li>
          <li><a href="#ssl%E9%85%8D%E7%BD%AE">sslé…ç½®</a></li>
          <li><a href="#%E5%BC%BA%E5%88%B6%E5%B0%86http%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0https">å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https</a></li>
          <li><a href="#%E4%B8%A4%E4%B8%AA%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA">ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº</a></li>
          <li><a href="#%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%A0%87%E5%87%86%E9%85%8D%E7%BD%AE">è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®</a></li>
          <li><a href="#%E7%88%AC%E8%99%AB%E8%BF%87%E6%BB%A4">çˆ¬è™«è¿‡æ»¤</a></li>
          <li><a href="#%E9%98%B2%E7%9B%97%E9%93%BE">é˜²ç›—é“¾</a></li>
          <li><a href="#%E8%99%9A%E6%8B%9F%E7%9B%AE%E5%BD%95%E9%85%8D%E7%BD%AE">è™šæ‹Ÿç›®å½•é…ç½®</a></li>
          <li><a href="#%E9%98%B2%E7%9B%97%E5%9B%BE%E9%85%8D%E7%BD%AE">é˜²ç›—å›¾é…ç½®</a></li>
          <li><a href="#%E5%B1%8F%E8%94%BDgit%E7%AD%89%E6%96%87%E4%BB%B6">å±è”½.gitç­‰æ–‡ä»¶</a></li>
          <li><a href="#%E5%9F%9F%E5%90%8D%E8%B7%AF%E5%BE%84%E5%8A%A0%E4%B8%8D%E5%8A%A0%E9%9C%80%E8%A6%81%E9%83%BD%E8%83%BD%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE">åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®</a></li>
          <li><a href="#cockpit">cockpit</a></li>
        </ul>
      </li>
      <li><a href="#%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98">é”™è¯¯é—®é¢˜</a></li>
      <li><a href="#%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0%E5%8F%82%E8%80%83">ç²¾å“æ–‡ç« å‚è€ƒ</a></li>
    </ul>
    <h2 id="å®‰è£…"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å®‰è£…"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å®‰è£…</h2>
    <h3 id="å®‰è£…ä¾èµ–"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å®‰è£…ä¾èµ–"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å®‰è£…ä¾èµ–</h3>
    <blockquote>
      <p>prce(é‡å®šå‘æ”¯æŒ)å’Œopenssl(httpsæ”¯æŒï¼Œå¦‚æœä¸éœ€è¦httpså¯ä»¥ä¸å®‰è£…ã€‚)</p>
    </blockquote>
    <pre class="language-bash"><code class="language-bash">yum <span class="token function">install</span> -y pcre-devel 
yum -y <span class="token function">install</span> gcc <span class="token function">make</span> gcc-c++ <span class="token function">wget</span>
yum -y <span class="token function">install</span> openssl openssl-devel 
</code></pre>
    <p>CentOS 6.5 æˆ‘å®‰è£…çš„æ—¶å€™æ˜¯é€‰æ‹©çš„â€œåŸºæœ¬æœåŠ¡å™¨â€ï¼Œé»˜è®¤è¿™ä¸¤ä¸ªåŒ…éƒ½æ²¡å®‰è£…å…¨ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªéƒ½è¿è¡Œå®‰è£…å³å¯ã€‚</p>
    <h3 id="ä¸‹è½½"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ä¸‹è½½"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ä¸‹è½½</h3>
    <p><a href="http://nginx.org/download/">nginxçš„æ‰€æœ‰ç‰ˆæœ¬åœ¨è¿™é‡Œ</a></p>
    <pre class="language-bash"><code class="language-bash"><span class="token function">wget</span> http://nginx.org/download/nginx-1.13.3.tar.gz
<span class="token function">wget</span> http://nginx.org/download/nginx-1.13.7.tar.gz

<span class="token comment"># å¦‚æœæ²¡æœ‰å®‰è£…wget</span>
<span class="token comment"># ä¸‹è½½å·²ç¼–è¯‘ç‰ˆæœ¬</span>
$ yum <span class="token function">install</span> <span class="token function">wget</span>

<span class="token comment"># è§£å‹å‹ç¼©åŒ…</span>
<span class="token function">tar</span> zxf nginx-1.13.3.tar.gz
</code></pre>
    <h3 id="ç¼–è¯‘å®‰è£…"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ç¼–è¯‘å®‰è£…"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ç¼–è¯‘å®‰è£…</h3>
    <p>ç„¶åè¿›å…¥ç›®å½•ç¼–è¯‘å®‰è£…ï¼Œ<a href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">configureå‚æ•°è¯´æ˜</a></p>
    <pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> nginx-1.11.5
./configure

<span class="token punctuation">..</span><span class="token punctuation">..</span>
Configuration summary
  + using system PCRE library
  + OpenSSL library is not used
  + using system zlib library

  nginx path prefix: <span class="token string">"/usr/local/nginx"</span>
  nginx binary file: <span class="token string">"/usr/local/nginx/sbin/nginx"</span>
  nginx modules path: <span class="token string">"/usr/local/nginx/modules"</span>
  nginx configuration prefix: <span class="token string">"/usr/local/nginx/conf"</span>
  nginx configuration file: <span class="token string">"/usr/local/nginx/conf/nginx.conf"</span>
  nginx pid file: <span class="token string">"/usr/local/nginx/logs/nginx.pid"</span>
  nginx error log file: <span class="token string">"/usr/local/nginx/logs/error.log"</span>
  nginx http access log file: <span class="token string">"/usr/local/nginx/logs/access.log"</span>
  nginx http client request body temporary files: <span class="token string">"client_body_temp"</span>
  nginx http proxy temporary files: <span class="token string">"proxy_temp"</span>
  nginx http fastcgi temporary files: <span class="token string">"fastcgi_temp"</span>
  nginx http uwsgi temporary files: <span class="token string">"uwsgi_temp"</span>
  nginx http scgi temporary files: <span class="token string">"scgi_temp"</span>
</code></pre>
    <p>å®‰è£…æŠ¥é”™è¯¯çš„è¯æ¯”å¦‚ï¼šâ€œC compiler cc is not foundâ€ï¼Œè¿™ä¸ªå°±æ˜¯ç¼ºå°‘ç¼–è¯‘ç¯å¢ƒï¼Œå®‰è£…ä¸€ä¸‹å°±å¯ä»¥äº† <strong>yum -y install gcc make gcc-c++ openssl-devel</strong></p>
    <p>å¦‚æœæ²¡æœ‰errorä¿¡æ¯ï¼Œå°±å¯ä»¥æ‰§è¡Œä¸‹è¾¹çš„å®‰è£…äº†ï¼š</p>
    <pre class="language-bash"><code class="language-bash"><span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre>
    <h3 id="nginxæµ‹è¯•"><a class="anchor" aria-hidden="true" tabindex="-1" href="#nginxæµ‹è¯•"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>nginxæµ‹è¯•</h3>
    <p>è¿è¡Œä¸‹é¢å‘½ä»¤ä¼šå‡ºç°ä¸¤ä¸ªç»“æœï¼Œä¸€èˆ¬æƒ…å†µnginxä¼šå®‰è£…åœ¨<code>/usr/local/nginx</code>ç›®å½•ä¸­</p>
    <pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /usr/local/nginx/sbin/
./nginx -t

<span class="token comment"># nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span>
<span class="token comment"># nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span>
</code></pre>
    <h3 id="è®¾ç½®å…¨å±€nginxå‘½ä»¤"><a class="anchor" aria-hidden="true" tabindex="-1" href="#è®¾ç½®å…¨å±€nginxå‘½ä»¤"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>è®¾ç½®å…¨å±€nginxå‘½ä»¤</h3>
    <pre class="language-bash"><code class="language-bash"><span class="token function">vi</span> ~/.bash_profile
</code></pre>
    <p>å°†ä¸‹é¢å†…å®¹æ·»åŠ åˆ° <code>~/.bash_profile</code> æ–‡ä»¶ä¸­</p>
    <pre class="language-bash"><code class="language-bash"><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/bin:/usr/local/nginx/sbin/
<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span>
</code></pre>
    <p>è¿è¡Œå‘½ä»¤ <strong><code>source ~/.bash_profile</code></strong> è®©é…ç½®ç«‹å³ç”Ÿæ•ˆã€‚ä½ å°±å¯ä»¥å…¨å±€è¿è¡Œ <code>nginx</code> å‘½ä»¤äº†ã€‚</p>
    <h2 id="mac-å®‰è£…"><a class="anchor" aria-hidden="true" tabindex="-1" href="#mac-å®‰è£…"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Mac å®‰è£…</h2>
    <p>Mac OSX å®‰è£…ç‰¹åˆ«ç®€å•ï¼Œé¦–å…ˆä½ éœ€è¦å®‰è£… <a href="https://brew.sh/">Brew</a>ï¼Œ é€šè¿‡ <code>brew</code> å¿«é€Ÿå®‰è£… <code>nginx</code>ã€‚</p>
    <h3 id="å®‰è£…nginx"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å®‰è£…nginx"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å®‰è£…nginx</h3>
    <pre class="language-bash"><code class="language-bash">brew <span class="token function">install</span> nginx
<span class="token comment"># Updating Homebrew...</span>
<span class="token comment"># ==> Auto-updated Homebrew!</span>
<span class="token comment"># Updated 2 taps (homebrew/core, homebrew/cask).</span>
<span class="token comment"># ==> Updated Formulae</span>
<span class="token comment"># ==> Installing dependencies for nginx: openssl, pcre</span>
<span class="token comment"># ==> Installing nginx dependency: openssl</span>
<span class="token comment"># ==> Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ######################################################################## 100.0%</span>
<span class="token comment"># ==> Pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ==> Caveats</span>
<span class="token comment"># A CA file has been bootstrapped using certificates from the SystemRoots</span>
<span class="token comment"># keychain. To add additional certificates (e.g. the certificates added in</span>
<span class="token comment"># the System keychain), place .pem files in</span>
<span class="token comment">#   /usr/local/etc/openssl/certs</span>
<span class="token comment"># </span>
<span class="token comment"># and run</span>
<span class="token comment">#   /usr/local/opt/openssl/bin/c_rehash</span>
<span class="token comment"># </span>
<span class="token comment"># This formula is keg-only, which means it was not symlinked into /usr/local,</span>
<span class="token comment"># because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.</span>
<span class="token comment"># </span>
<span class="token comment"># If you need to have this software first in your PATH run:</span>
<span class="token comment">#   echo 'export PATH="/usr/local/opt/openssl/bin:$PATH"' >> ~/.zshrc</span>
<span class="token comment"># </span>
<span class="token comment"># For compilers to find this software you may need to set:</span>
<span class="token comment">#     LDFLAGS:  -L/usr/local/opt/openssl/lib</span>
<span class="token comment">#     CPPFLAGS: -I/usr/local/opt/openssl/include</span>
<span class="token comment"># For pkg-config to find this software you may need to set:</span>
<span class="token comment">#     PKG_CONFIG_PATH: /usr/local/opt/openssl/lib/pkgconfig</span>
<span class="token comment"># </span>
<span class="token comment"># ==> Summary</span>
<span class="token comment"># ğŸº  /usr/local/Cellar/openssl/1.0.2o_1: 1,791 files, 12.3MB</span>
<span class="token comment"># ==> Installing nginx dependency: pcre</span>
<span class="token comment"># ==> Downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ######################################################################## 100.0%</span>
<span class="token comment"># ==> Pouring pcre-8.42.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ğŸº  /usr/local/Cellar/pcre/8.42: 204 files, 5.3MB</span>
<span class="token comment"># ==> Installing nginx</span>
<span class="token comment"># ==> Downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ######################################################################## 100.0%</span>
<span class="token comment"># ==> Pouring nginx-1.13.12.high_sierra.bottle.tar.gz</span>
<span class="token comment"># ==> Caveats</span>
<span class="token comment"># Docroot is: /usr/local/var/www</span>
<span class="token comment"># </span>
<span class="token comment"># The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</span>
<span class="token comment"># nginx can run without sudo.</span>
<span class="token comment"># </span>
<span class="token comment"># nginx will load all files in /usr/local/etc/nginx/servers/.</span>
<span class="token comment"># </span>
<span class="token comment"># To have launchd start nginx now and restart at login:</span>
<span class="token comment">#   brew services start nginx</span>
<span class="token comment"># Or, if you don't wacd /usr/local/Cellar/nginx/1.13.12/n just run:</span>
<span class="token comment"># cd /usr/local/Cellar/nginx/1.13.12/</span>
</code></pre>
    <h3 id="å¯åŠ¨æœåŠ¡"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å¯åŠ¨æœåŠ¡"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å¯åŠ¨æœåŠ¡</h3>
    <p>æ³¨æ„é»˜è®¤ç«¯å£ä¸æ˜¯ <code>8080</code> æŸ¥çœ‹ç¡®è®¤ç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚</p>
    <pre class="language-bash"><code class="language-bash">brew services start nginx
<span class="token comment"># http://localhost:8080/</span>
</code></pre>
    <h2 id="å¼€æœºè‡ªå¯åŠ¨"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å¼€æœºè‡ªå¯åŠ¨"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å¼€æœºè‡ªå¯åŠ¨</h2>
    <p><strong>å¼€æœºè‡ªå¯åŠ¨æ–¹æ³•ä¸€ï¼š</strong></p>
    <p>ç¼–è¾‘ <strong>vi /lib/systemd/system/nginx.service</strong> æ–‡ä»¶ï¼Œæ²¡æœ‰åˆ›å»ºä¸€ä¸ª <strong>touch nginx.service</strong> ç„¶åå°†å¦‚ä¸‹å†…å®¹æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œä¿®æ”¹åï¼Œæ·»åŠ åˆ°nginx.serviceæ–‡ä»¶ä¸­ï¼š</p>
    <pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>nginx
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target remote-fs.target nss-lookup.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>

<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/var/run/nginx.pid
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill -s HUP <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/bin/kill -s QUIT <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre>
    <ul>
      <li><code>[Unit]</code>:æœåŠ¡çš„è¯´æ˜</li>
      <li><code>Description</code>:æè¿°æœåŠ¡</li>
      <li><code>After</code>:æè¿°æœåŠ¡ç±»åˆ«</li>
      <li><code>[Service]</code>æœåŠ¡è¿è¡Œå‚æ•°çš„è®¾ç½®</li>
      <li><code>Type=forking</code>æ˜¯åå°è¿è¡Œçš„å½¢å¼</li>
      <li><code>ExecStart</code>ä¸ºæœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤</li>
      <li><code>ExecReload</code>ä¸ºé‡å¯å‘½ä»¤</li>
      <li><code>ExecStop</code>ä¸ºåœæ­¢å‘½ä»¤</li>
      <li><code>PrivateTmp=True</code>è¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´</li>
    </ul>
    <p>æ³¨æ„ï¼š<code>[Service]</code>çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚</p>
    <p><code>[Install]</code>è¿è¡Œçº§åˆ«ä¸‹æœåŠ¡å®‰è£…çš„ç›¸å…³è®¾ç½®ï¼Œå¯è®¾ç½®ä¸ºå¤šç”¨æˆ·ï¼Œå³ç³»ç»Ÿè¿è¡Œçº§åˆ«ä¸º<code>3</code>ã€‚</p>
    <p>ä¿å­˜é€€å‡ºã€‚</p>
    <p>è®¾ç½®å¼€æœºå¯åŠ¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
    <pre class="language-bash"><code class="language-bash"><span class="token comment"># å¯åŠ¨nginxæœåŠ¡</span>
systemctl start nginx.service
<span class="token comment"># åœæ­¢å¼€æœºè‡ªå¯åŠ¨</span>
systemctl disable nginx.service
<span class="token comment"># æŸ¥çœ‹æœåŠ¡å½“å‰çŠ¶æ€</span>
systemctl status nginx.service
<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰å·²å¯åŠ¨çš„æœåŠ¡</span>
systemctl list-units --type<span class="token operator">=</span>service
<span class="token comment"># é‡æ–°å¯åŠ¨æœåŠ¡</span>
systemctl restart nginx.service
<span class="token comment"># è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span>
systemctl <span class="token builtin class-name">enable</span> nginx.service
<span class="token comment"># è¾“å‡ºä¸‹é¢å†…å®¹è¡¨ç¤ºæˆåŠŸäº†</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.
</code></pre>
    <pre class="language-bash"><code class="language-bash">systemctl is-enabled servicename.service <span class="token comment"># æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</span>
systemctl <span class="token builtin class-name">enable</span> *.service <span class="token comment"># å¼€æœºè¿è¡ŒæœåŠ¡</span>
systemctl disable *.service <span class="token comment"># å–æ¶ˆå¼€æœºè¿è¡Œ</span>
systemctl start *.service <span class="token comment"># å¯åŠ¨æœåŠ¡</span>
systemctl stop *.service <span class="token comment"># åœæ­¢æœåŠ¡</span>
systemctl restart *.service <span class="token comment"># é‡å¯æœåŠ¡</span>
systemctl reload *.service <span class="token comment"># é‡æ–°åŠ è½½æœåŠ¡é…ç½®æ–‡ä»¶</span>
systemctl status *.service <span class="token comment"># æŸ¥è¯¢æœåŠ¡è¿è¡ŒçŠ¶æ€</span>
systemctl --failed <span class="token comment"># æ˜¾ç¤ºå¯åŠ¨å¤±è´¥çš„æœåŠ¡</span>
</code></pre>
    <p>æ³¨ï¼š*ä»£è¡¨æŸä¸ªæœåŠ¡çš„åå­—ï¼Œå¦‚httpçš„æœåŠ¡åä¸ºhttpd</p>
    <p><strong>å¼€æœºè‡ªå¯åŠ¨æ–¹æ³•äºŒï¼š</strong></p>
    <pre class="language-bash"><code class="language-bash"><span class="token function">vi</span> /etc/rc.local

<span class="token comment"># åœ¨ rc.local æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢è¿™æ¡å‘½ä»¤</span>
/usr/local/nginx/sbin/nginx start
</code></pre>
    <p>å¦‚æœå¼€æœºåå‘ç°è‡ªå¯åŠ¨è„šæœ¬æ²¡æœ‰æ‰§è¡Œï¼Œä½ è¦å»ç¡®è®¤ä¸€ä¸‹rc.localè¿™ä¸ªæ–‡ä»¶çš„è®¿é—®æƒé™æ˜¯å¦æ˜¯å¯æ‰§è¡Œçš„ï¼Œå› ä¸ºrc.localé»˜è®¤æ˜¯ä¸å¯æ‰§è¡Œçš„ã€‚ä¿®æ”¹rc.localè®¿é—®æƒé™ï¼Œå¢åŠ å¯æ‰§è¡Œæƒé™ï¼š</p>
    <pre class="language-bash"><code class="language-bash"><span class="token comment"># /etc/rc.localæ˜¯/etc/rc.d/rc.localçš„è½¯è¿æ¥ï¼Œ</span>
<span class="token function">chmod</span> +x /etc/rc.d/rc.local
</code></pre>
    <p>å®˜æ–¹è„šæœ¬ <a href="https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/">ed Hat NGINX Init Script</a>ã€‚</p>
    <h2 id="è¿ç»´"><a class="anchor" aria-hidden="true" tabindex="-1" href="#è¿ç»´"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>è¿ç»´</h2>
    <h3 id="æœåŠ¡ç®¡ç†"><a class="anchor" aria-hidden="true" tabindex="-1" href="#æœåŠ¡ç®¡ç†"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>æœåŠ¡ç®¡ç†</h3>
    <pre class="language-bash"><code class="language-bash"><span class="token comment"># å¯åŠ¨</span>
/usr/local/nginx/sbin/nginx

<span class="token comment"># é‡å¯</span>
/usr/local/nginx/sbin/nginx -s reload

<span class="token comment"># å…³é—­è¿›ç¨‹</span>
/usr/local/nginx/sbin/nginx -s stop

<span class="token comment"># å¹³æ»‘å…³é—­nginx</span>
/usr/local/nginx/sbin/nginx -s quit

<span class="token comment"># æŸ¥çœ‹nginxçš„å®‰è£…çŠ¶æ€ï¼Œ</span>
/usr/local/nginx/sbin/nginx -V 
</code></pre>
    <p><strong>å…³é—­é˜²ç«å¢™ï¼Œæˆ–è€…æ·»åŠ é˜²ç«å¢™è§„åˆ™å°±å¯ä»¥æµ‹è¯•äº†</strong></p>
    <pre class="language-bash"><code class="language-bash"><span class="token function">service</span> iptables stop
</code></pre>
    <p>æˆ–è€…ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š</p>
    <pre class="language-bash"><code class="language-bash"><span class="token function">vi</span> /etc/sysconfig/iptables
</code></pre>
    <p>æ·»åŠ è¿™æ ·ä¸€æ¡å¼€æ”¾80ç«¯å£çš„è§„åˆ™åä¿å­˜ï¼š</p>
    <pre class="language-bash"><code class="language-bash">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="token number">80</span> -j ACCEPT
</code></pre>
    <p>é‡å¯æœåŠ¡å³å¯:</p>
    <pre class="language-bash"><code class="language-bash"><span class="token function">service</span> iptables restart
<span class="token comment"># å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ç›®å‰nat</span>
iptables -t nat -L
</code></pre>
    <h3 id="é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³</h3>
    <pre class="language-bash"><code class="language-bash"><span class="token function">service</span> iptables restart
<span class="token comment"># Redirecting to /bin/systemctl restart  iptables.service</span>
<span class="token comment"># Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.</span>
</code></pre>
    <p>
      åœ¨CentOS 7æˆ–RHEL 7æˆ–Fedoraä¸­é˜²ç«å¢™ç”± <strong>firewalld</strong> æ¥ç®¡ç†ï¼Œå½“ç„¶ä½ å¯ä»¥è¿˜åŸä¼ ç»Ÿçš„ç®¡ç†æ–¹å¼ã€‚æˆ–åˆ™ä½¿ç”¨æ–°çš„å‘½ä»¤è¿›è¡Œç®¡ç†ã€‚
      å‡å¦‚é‡‡ç”¨ä¼ ç»Ÿè¯·æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š
    </p>
    <pre class="language-bash"><code class="language-bash"><span class="token comment"># ä¼ ç»Ÿå‘½ä»¤</span>
systemctl stop firewalld
systemctl mask firewalld
</code></pre>
    <pre class="language-bash"><code class="language-bash"><span class="token comment"># å®‰è£…å‘½ä»¤</span>
yum <span class="token function">install</span> iptables-services

systemctl <span class="token builtin class-name">enable</span> iptables 
<span class="token function">service</span> iptables restart
</code></pre>
    <h2 id="nginxå¸è½½"><a class="anchor" aria-hidden="true" tabindex="-1" href="#nginxå¸è½½"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>nginxå¸è½½</h2>
    <p>å¦‚æœé€šè¿‡yumå®‰è£…ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…ã€‚</p>
    <pre class="language-bash"><code class="language-bash">yum remove nginx
</code></pre>
    <p>
      ç¼–è¯‘å®‰è£…ï¼Œåˆ é™¤/usr/local/nginxç›®å½•å³å¯
      å¦‚æœé…ç½®äº†è‡ªå¯åŠ¨è„šæœ¬ï¼Œä¹Ÿéœ€è¦åˆ é™¤ã€‚
    </p>
    <h2 id="å‚æ•°è¯´æ˜"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å‚æ•°è¯´æ˜"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å‚æ•°è¯´æ˜</h2>
    <table>
      <thead>
        <tr>
          <th>å‚æ•°</th>
          <th>è¯´æ˜</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>--prefix=<code>&#x3C;path></code></td>
          <td>Nginxå®‰è£…è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º /usr/local/nginxã€‚</td>
        </tr>
        <tr>
          <td>--sbin-path=<code>&#x3C;path></code></td>
          <td>Nginxå¯æ‰§è¡Œæ–‡ä»¶å®‰è£…è·¯å¾„ã€‚åªèƒ½å®‰è£…æ—¶æŒ‡å®šï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º<code>&#x3C;prefix></code>/sbin/nginxã€‚</td>
        </tr>
        <tr>
          <td>--conf-path=<code>&#x3C;path></code></td>
          <td>åœ¨æ²¡æœ‰ç»™å®š-cé€‰é¡¹ä¸‹é»˜è®¤çš„nginx.confçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º<code>&#x3C;prefix></code>/conf/nginx.confã€‚</td>
        </tr>
        <tr>
          <td>--pid-path=<code>&#x3C;path></code></td>
          <td>åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®špidæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginx.pidçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º <code>&#x3C;prefix></code>/logs/nginx.pidã€‚</td>
        </tr>
        <tr>
          <td>--lock-path=<code>&#x3C;path></code></td>
          <td>nginx.lockæ–‡ä»¶çš„è·¯å¾„ã€‚</td>
        </tr>
        <tr>
          <td>--error-log-path=<code>&#x3C;path></code></td>
          <td>åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šerror_logæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„é”™è¯¯æ—¥å¿—çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º <code>&#x3C;prefix></code>/- logs/error.logã€‚</td>
        </tr>
        <tr>
          <td>--http-log-path=<code>&#x3C;path></code></td>
          <td>åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šaccess_logæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„è®¿é—®æ—¥å¿—çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º <code>&#x3C;prefix></code>/- logs/access.logã€‚</td>
        </tr>
        <tr>
          <td>--user=<code>&#x3C;user></code></td>
          <td>åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šuseræŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginxä½¿ç”¨çš„ç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º nobodyã€‚</td>
        </tr>
        <tr>
          <td>--group=<code>&#x3C;group></code></td>
          <td>åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šuseræŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginxä½¿ç”¨çš„ç»„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º nobodyã€‚</td>
        </tr>
        <tr>
          <td>--builddir=DIR</td>
          <td>æŒ‡å®šç¼–è¯‘çš„ç›®å½•</td>
        </tr>
        <tr>
          <td>--with-rtsig_module</td>
          <td>å¯ç”¨ rtsig æ¨¡å—</td>
        </tr>
        <tr>
          <td>--with-select_module --without-select_module</td>
          <td>å…è®¸æˆ–ä¸å…è®¸å¼€å¯SELECTæ¨¡å¼ï¼Œå¦‚æœ configure æ²¡æœ‰æ‰¾åˆ°æ›´åˆé€‚çš„æ¨¡å¼ï¼Œæ¯”å¦‚ï¼škqueue(sun os),epoll (linux kenel 2.6+), rtsig(- å®æ—¶ä¿¡å·)æˆ–è€…/dev/poll(ä¸€ç§ç±»ä¼¼selectçš„æ¨¡å¼ï¼Œåº•å±‚å®ç°ä¸SELECTåŸºæœ¬ç›¸ åŒï¼Œéƒ½æ˜¯é‡‡ç”¨è½®è®­æ–¹æ³•) SELECTæ¨¡å¼å°†æ˜¯é»˜è®¤å®‰è£…æ¨¡å¼</td>
        </tr>
        <tr>
          <td>--with-poll_module --without-poll_module</td>
          <td>Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or /dev/poll is not discovered by configure.</td>
        </tr>
        <tr>
          <td>--with-http_ssl_module</td>
          <td>Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. å¼€å¯HTTP SSLæ¨¡å—ï¼Œä½¿NGINXå¯ä»¥æ”¯æŒHTTPSè¯·æ±‚ã€‚è¿™ä¸ªæ¨¡å—éœ€è¦å·²ç»å®‰è£…äº†OPENSSLï¼Œåœ¨DEBIANä¸Šæ˜¯libssl</td>
        </tr>
        <tr>
          <td>--with-http_realip_module</td>
          <td>å¯ç”¨ ngx_http_realip_module</td>
        </tr>
        <tr>
          <td>--with-http_addition_module</td>
          <td>å¯ç”¨ ngx_http_addition_module</td>
        </tr>
        <tr>
          <td>--with-http_sub_module</td>
          <td>å¯ç”¨ ngx_http_sub_module</td>
        </tr>
        <tr>
          <td>--with-http_dav_module</td>
          <td>å¯ç”¨ ngx_http_dav_module</td>
        </tr>
        <tr>
          <td>--with-http_flv_module</td>
          <td>å¯ç”¨ ngx_http_flv_module</td>
        </tr>
        <tr>
          <td>--with-http_stub_status_module</td>
          <td>å¯ç”¨ "server status" é¡µ</td>
        </tr>
        <tr>
          <td>--without-http_charset_module</td>
          <td>ç¦ç”¨ ngx_http_charset_module</td>
        </tr>
        <tr>
          <td>--without-http_gzip_module</td>
          <td>ç¦ç”¨ ngx_http_gzip_module. å¦‚æœå¯ç”¨ï¼Œéœ€è¦ zlib ã€‚</td>
        </tr>
        <tr>
          <td>--without-http_ssi_module</td>
          <td>ç¦ç”¨ ngx_http_ssi_module</td>
        </tr>
        <tr>
          <td>--without-http_userid_module</td>
          <td>ç¦ç”¨ ngx_http_userid_module</td>
        </tr>
        <tr>
          <td>--without-http_access_module</td>
          <td>ç¦ç”¨ ngx_http_access_module</td>
        </tr>
        <tr>
          <td>--without-http_auth_basic_module</td>
          <td>ç¦ç”¨ ngx_http_auth_basic_module</td>
        </tr>
        <tr>
          <td>--without-http_autoindex_module</td>
          <td>ç¦ç”¨ ngx_http_autoindex_module</td>
        </tr>
        <tr>
          <td>--without-http_geo_module</td>
          <td>ç¦ç”¨ ngx_http_geo_module</td>
        </tr>
        <tr>
          <td>--without-http_map_module</td>
          <td>ç¦ç”¨ ngx_http_map_module</td>
        </tr>
        <tr>
          <td>--without-http_referer_module</td>
          <td>ç¦ç”¨ ngx_http_referer_module</td>
        </tr>
        <tr>
          <td>--without-http_rewrite_module</td>
          <td>ç¦ç”¨ ngx_http_rewrite_module. å¦‚æœå¯ç”¨éœ€è¦ PCRE ã€‚</td>
        </tr>
        <tr>
          <td>--without-http_proxy_module</td>
          <td>ç¦ç”¨ ngx_http_proxy_module</td>
        </tr>
        <tr>
          <td>--without-http_fastcgi_module</td>
          <td>ç¦ç”¨ ngx_http_fastcgi_module</td>
        </tr>
        <tr>
          <td>--without-http_memcached_module</td>
          <td>ç¦ç”¨ ngx_http_memcached_module</td>
        </tr>
        <tr>
          <td>--without-http_limit_zone_module</td>
          <td>ç¦ç”¨ ngx_http_limit_zone_module</td>
        </tr>
        <tr>
          <td>--without-http_empty_gif_module</td>
          <td>ç¦ç”¨ ngx_http_empty_gif_module</td>
        </tr>
        <tr>
          <td>--without-http_browser_module</td>
          <td>ç¦ç”¨ ngx_http_browser_module</td>
        </tr>
        <tr>
          <td>--without-http_upstream_ip_hash_module</td>
          <td>ç¦ç”¨ ngx_http_upstream_ip_hash_module</td>
        </tr>
        <tr>
          <td>--with-http_perl_module</td>
          <td>å¯ç”¨ ngx_http_perl_module</td>
        </tr>
        <tr>
          <td>--with-perl_modules_path=PATH</td>
          <td>æŒ‡å®š perl æ¨¡å—çš„è·¯å¾„</td>
        </tr>
        <tr>
          <td>--with-perl=PATH</td>
          <td>æŒ‡å®š perl æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„</td>
        </tr>
        <tr>
          <td>--http-log-path=PATH</td>
          <td>Set path to the http access log</td>
        </tr>
        <tr>
          <td>--http-client-body-temp-path=PATH</td>
          <td>Set path to the http client request body temporary files</td>
        </tr>
        <tr>
          <td>--http-proxy-temp-path=PATH</td>
          <td>Set path to the http proxy temporary files</td>
        </tr>
        <tr>
          <td>--http-fastcgi-temp-path=PATH</td>
          <td>Set path to the http fastcgi temporary files</td>
        </tr>
        <tr>
          <td>--without-http</td>
          <td>ç¦ç”¨ HTTP server</td>
        </tr>
        <tr>
          <td>--with-mail</td>
          <td>å¯ç”¨ IMAP4/POP3/SMTP ä»£ç†æ¨¡å—</td>
        </tr>
        <tr>
          <td>--with-mail_ssl_module</td>
          <td>å¯ç”¨ ngx_mail_ssl_module</td>
        </tr>
        <tr>
          <td>--with-cc=PATH</td>
          <td>æŒ‡å®š C ç¼–è¯‘å™¨çš„è·¯å¾„</td>
        </tr>
        <tr>
          <td>--with-cpp=PATH</td>
          <td>æŒ‡å®š C é¢„å¤„ç†å™¨çš„è·¯å¾„</td>
        </tr>
        <tr>
          <td>--with-cc-opt=OPTIONS</td>
          <td>Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate --with-cc-opt="-I /usr/local/include". If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: --with-cc-opt="-D FD_SETSIZE=2048".</td>
        </tr>
        <tr>
          <td>--with-ld-opt=OPTIONS</td>
          <td>Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate --with-ld-opt="-L /usr/local/lib".</td>
        </tr>
        <tr>
          <td>--with-cpu-opt=CPU</td>
          <td>ä¸ºç‰¹å®šçš„ CPU ç¼–è¯‘ï¼Œæœ‰æ•ˆçš„å€¼åŒ…æ‹¬ï¼špentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64</td>
        </tr>
        <tr>
          <td>--without-pcre</td>
          <td>ç¦æ­¢ PCRE åº“çš„ä½¿ç”¨ã€‚åŒæ—¶ä¹Ÿä¼šç¦æ­¢ HTTP rewrite æ¨¡å—ã€‚åœ¨ "location" é…ç½®æŒ‡ä»¤ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿéœ€è¦ PCRE ã€‚</td>
        </tr>
        <tr>
          <td>--with-pcre=DIR</td>
          <td>æŒ‡å®š PCRE åº“çš„æºä»£ç çš„è·¯å¾„ã€‚</td>
        </tr>
        <tr>
          <td>--with-pcre-opt=OPTIONS</td>
          <td>Set additional options for PCRE building.</td>
        </tr>
        <tr>
          <td>--with-md5=DIR</td>
          <td>Set path to md5 library sources.</td>
        </tr>
        <tr>
          <td>--with-md5-opt=OPTIONS</td>
          <td>Set additional options for md5 building.</td>
        </tr>
        <tr>
          <td>--with-md5-asm</td>
          <td>Use md5 assembler sources.</td>
        </tr>
        <tr>
          <td>--with-sha1=DIR</td>
          <td>Set path to sha1 library sources.</td>
        </tr>
        <tr>
          <td>--with-sha1-opt=OPTIONS</td>
          <td>Set additional options for sha1 building.</td>
        </tr>
        <tr>
          <td>--with-sha1-asm</td>
          <td>Use sha1 assembler sources.</td>
        </tr>
        <tr>
          <td>--with-zlib=DIR</td>
          <td>Set path to zlib library sources.</td>
        </tr>
        <tr>
          <td>--with-zlib-opt=OPTIONS</td>
          <td>Set additional options for zlib building.</td>
        </tr>
        <tr>
          <td>--with-zlib-asm=CPU</td>
          <td>Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro</td>
        </tr>
        <tr>
          <td>--with-openssl=DIR</td>
          <td>Set path to OpenSSL library sources</td>
        </tr>
        <tr>
          <td>--with-openssl-opt=OPTIONS</td>
          <td>Set additional options for OpenSSL building</td>
        </tr>
        <tr>
          <td>--with-debug</td>
          <td>å¯ç”¨è°ƒè¯•æ—¥å¿—</td>
        </tr>
        <tr>
          <td>--add-module=PATH</td>
          <td>Add in a third-party module found in directory PATH</td>
        </tr>
      </tbody>
    </table>
    <h2 id="é…ç½®"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é…ç½®"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é…ç½®</h2>
    <p>åœ¨Centos é»˜è®¤é…ç½®æ–‡ä»¶åœ¨ <strong>/usr/local/nginx-1.5.1/conf/nginx.conf</strong> æˆ‘ä»¬è¦åœ¨è¿™é‡Œé…ç½®ä¸€äº›æ–‡ä»¶ã€‚nginx.confæ˜¯ä¸»é…ç½®æ–‡ä»¶ï¼Œç”±è‹¥å¹²ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ¯ä¸ªå¤§æ‹¬å·<code>{}</code>è¡¨ç¤ºä¸€ä¸ªéƒ¨åˆ†ã€‚æ¯ä¸€è¡ŒæŒ‡ä»¤éƒ½ç”±åˆ†å·ç»“æŸ<code>;</code>ï¼Œæ ‡å¿—ç€ä¸€è¡Œçš„ç»“æŸã€‚</p>
    <h3 id="å¸¸ç”¨æ­£åˆ™"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å¸¸ç”¨æ­£åˆ™"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å¸¸ç”¨æ­£åˆ™</h3>
    <table>
      <thead>
        <tr>
          <th>æ­£åˆ™</th>
          <th>è¯´æ˜</th>
          <th>æ­£åˆ™</th>
          <th>è¯´æ˜</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>.</code></td>
          <td>åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td>
          <td><code>$</code></td>
          <td>åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</td>
        </tr>
        <tr>
          <td><code>?</code></td>
          <td>é‡å¤0æ¬¡æˆ–1æ¬¡</td>
          <td><code>{n}</code></td>
          <td>é‡å¤næ¬¡</td>
        </tr>
        <tr>
          <td><code>+</code></td>
          <td>é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡</td>
          <td><code>{n,}</code></td>
          <td>é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡</td>
        </tr>
        <tr>
          <td><code>*</code></td>
          <td>é‡å¤0æ¬¡æˆ–æ›´å¤šæ¬¡</td>
          <td><code>[c]</code></td>
          <td>åŒ¹é…å•ä¸ªå­—ç¬¦c</td>
        </tr>
        <tr>
          <td><code>\d</code></td>
          <td>åŒ¹é…æ•°å­—</td>
          <td><code>[a-z]</code></td>
          <td>åŒ¹é…a-zå°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ª</td>
        </tr>
        <tr>
          <td><code>^</code></td>
          <td>åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</td>
          <td>-</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
    <h3 id="å…¨å±€å˜é‡"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å…¨å±€å˜é‡"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å…¨å±€å˜é‡</h3>
    <table>
      <thead>
        <tr>
          <th>å˜é‡</th>
          <th>è¯´æ˜</th>
          <th>å˜é‡</th>
          <th>è¯´æ˜</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>$args</td>
          <td>è¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ$query_string</td>
          <td>$remote_port</td>
          <td>å®¢æˆ·ç«¯çš„ç«¯å£ã€‚</td>
        </tr>
        <tr>
          <td>$content_length</td>
          <td>è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µã€‚</td>
          <td>$remote_user</td>
          <td>å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·åã€‚</td>
        </tr>
        <tr>
          <td>$content_type</td>
          <td>è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µã€‚</td>
          <td>$request_filename</td>
          <td>å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚</td>
        </tr>
        <tr>
          <td>$document_root</td>
          <td>å½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚</td>
          <td>$scheme</td>
          <td>HTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰ã€‚</td>
        </tr>
        <tr>
          <td>$host</td>
          <td>è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚</td>
          <td>$server_protocol</td>
          <td>è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–HTTP/1.1ã€‚</td>
        </tr>
        <tr>
          <td>$http_user_agent</td>
          <td>å®¢æˆ·ç«¯agentä¿¡æ¯</td>
          <td>$server_addr</td>
          <td>æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚</td>
        </tr>
        <tr>
          <td>$http_cookie</td>
          <td>å®¢æˆ·ç«¯cookieä¿¡æ¯</td>
          <td>$server_name</td>
          <td>æœåŠ¡å™¨åç§°ã€‚</td>
        </tr>
        <tr>
          <td>$limit_rate</td>
          <td>è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚</td>
          <td>$server_port</td>
          <td>è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚</td>
        </tr>
        <tr>
          <td>$request_method</td>
          <td>å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POSTã€‚</td>
          <td>$request_uri</td>
          <td>åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼š/foo/bar.php?arg=bazã€‚</td>
        </tr>
        <tr>
          <td>$remote_addr</td>
          <td>å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚</td>
          <td>$uri</td>
          <td>ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚/foo/bar.htmlã€‚</td>
        </tr>
        <tr>
          <td>$document_uri</td>
          <td>ä¸$uriç›¸åŒã€‚</td>
          <td>-</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
    <p>ä¾‹å¦‚è¯·æ±‚ï¼š<code>http://localhost:3000/test1/test2/test.php</code></p>
    <p>$hostï¼šlocalhost<br>$server_portï¼š3000<br>$request_uriï¼š/test1/test2/test.php<br>$document_uriï¼š/test1/test2/test.php<br>$document_rootï¼š/var/www/html<br>$request_filenameï¼š/var/www/html/test1/test2/test.php</p>
    <h3 id="ç¬¦å·å‚è€ƒ"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ç¬¦å·å‚è€ƒ"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ç¬¦å·å‚è€ƒ</h3>
    <table>
      <thead>
        <tr>
          <th>ç¬¦å·</th>
          <th>è¯´æ˜</th>
          <th>ç¬¦å·</th>
          <th>è¯´æ˜</th>
          <th>ç¬¦å·</th>
          <th>è¯´æ˜</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>k,K</td>
          <td>åƒå­—èŠ‚</td>
          <td>m,M</td>
          <td>å…†å­—èŠ‚</td>
          <td>ms</td>
          <td>æ¯«ç§’</td>
        </tr>
        <tr>
          <td>s</td>
          <td>ç§’</td>
          <td>m</td>
          <td>åˆ†é’Ÿ</td>
          <td>h</td>
          <td>å°æ—¶</td>
        </tr>
        <tr>
          <td>d</td>
          <td>æ—¥</td>
          <td>w</td>
          <td>å‘¨</td>
          <td>M</td>
          <td>ä¸€ä¸ªæœˆ, 30å¤©</td>
        </tr>
      </tbody>
    </table>
    <p>ä¾‹å¦‚ï¼Œ"8k"ï¼Œ"1m" ä»£è¡¨å­—èŠ‚æ•°è®¡é‡ã€‚<br>ä¾‹å¦‚ï¼Œ"1h 30m"ï¼Œ"1y 6M"ã€‚ä»£è¡¨ "1å°æ—¶ 30åˆ†"ï¼Œ"1å¹´é›¶6ä¸ªæœˆ"ã€‚</p>
    <h3 id="é…ç½®æ–‡ä»¶"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é…ç½®æ–‡ä»¶"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é…ç½®æ–‡ä»¶</h3>
    <p>nginx çš„é…ç½®ç³»ç»Ÿç”±ä¸€ä¸ªä¸»é…ç½®æ–‡ä»¶å’Œå…¶ä»–ä¸€äº›è¾…åŠ©çš„é…ç½®æ–‡ä»¶æ„æˆã€‚è¿™äº›é…ç½®æ–‡ä»¶å‡æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå…¨éƒ¨ä½äº nginx å®‰è£…ç›®å½•ä¸‹çš„ conf ç›®å½•ä¸‹ã€‚</p>
    <p>
      æŒ‡ä»¤ç”± nginx çš„å„ä¸ªæ¨¡å—æä¾›ï¼Œä¸åŒçš„æ¨¡å—ä¼šæä¾›ä¸åŒçš„æŒ‡ä»¤æ¥å®ç°é…ç½®ã€‚
      æŒ‡ä»¤é™¤äº† Key-Value çš„å½¢å¼ï¼Œè¿˜æœ‰ä½œç”¨åŸŸæŒ‡ä»¤ã€‚
    </p>
    <p>nginx.conf ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œæ ¹æ®å…¶é€»è¾‘ä¸Šçš„æ„ä¹‰ï¼Œå¯¹å®ƒä»¬è¿›è¡Œäº†åˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯åˆ†æˆäº†å¤šä¸ªä½œç”¨åŸŸï¼Œæˆ–è€…ç§°ä¹‹ä¸ºé…ç½®æŒ‡ä»¤ä¸Šä¸‹æ–‡ã€‚ä¸åŒçš„ä½œç”¨åŸŸå«æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®é¡¹ã€‚</p>
    <p>ä¸‹é¢çš„è¿™äº›ä¸Šä¸‹æ–‡æŒ‡ä»¤æ˜¯ç”¨çš„æ¯”è¾ƒå¤šï¼š</p>
    <table>
      <thead>
        <tr>
          <th>Directive</th>
          <th>Description</th>
          <th>Contains Directive</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>main</td>
          <td>nginx åœ¨è¿è¡Œæ—¶ä¸å…·ä½“ä¸šåŠ¡åŠŸèƒ½ï¼ˆæ¯”å¦‚ http æœåŠ¡æˆ–è€… email æœåŠ¡ä»£ç†ï¼‰æ— å…³çš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚å·¥ä½œè¿›ç¨‹æ•°ï¼Œè¿è¡Œçš„èº«ä»½ç­‰ã€‚</td>
          <td>user, worker_processes, error_log, events, http, mail</td>
        </tr>
        <tr>
          <td>http</td>
          <td>ä¸æä¾› http æœåŠ¡ç›¸å…³çš„ä¸€äº›é…ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼šæ˜¯å¦ä½¿ç”¨ keepalive å•Šï¼Œæ˜¯å¦ä½¿ç”¨ gzip è¿›è¡Œå‹ç¼©ç­‰ã€‚</td>
          <td>server</td>
        </tr>
        <tr>
          <td>server</td>
          <td>http æœåŠ¡ä¸Šæ”¯æŒè‹¥å¹²è™šæ‹Ÿä¸»æœºã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºä¸€ä¸ªå¯¹åº”çš„ server é…ç½®é¡¹ï¼Œé…ç½®é¡¹é‡Œé¢åŒ…å«è¯¥è™šæ‹Ÿä¸»æœºç›¸å…³çš„é…ç½®ã€‚åœ¨æä¾› mail æœåŠ¡çš„ä»£ç†æ—¶ï¼Œä¹Ÿå¯ä»¥å»ºç«‹è‹¥å¹² server. æ¯ä¸ª server é€šè¿‡ç›‘å¬çš„åœ°å€æ¥åŒºåˆ†ã€‚</td>
          <td>listen, server_name, access_log, location, protocol, proxy, smtp_auth, xclient</td>
        </tr>
        <tr>
          <td>location</td>
          <td>http æœåŠ¡ä¸­ï¼ŒæŸäº›ç‰¹å®šçš„ URL å¯¹åº”çš„ä¸€ç³»åˆ—é…ç½®é¡¹ã€‚</td>
          <td>index, root</td>
        </tr>
        <tr>
          <td>mail</td>
          <td>å®ç° email ç›¸å…³çš„ SMTP/IMAP/POP3 ä»£ç†æ—¶ï¼Œå…±äº«çš„ä¸€äº›é…ç½®é¡¹ï¼ˆå› ä¸ºå¯èƒ½å®ç°å¤šä¸ªä»£ç†ï¼Œå·¥ä½œåœ¨å¤šä¸ªç›‘å¬åœ°å€ä¸Šï¼‰ã€‚</td>
          <td>server, http, imap_capabilities</td>
        </tr>
        <tr>
          <td>include</td>
          <td>ä»¥ä¾¿å¢å¼ºé…ç½®æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œä½¿å¾—éƒ¨åˆ†é…ç½®æ–‡ä»¶å¯ä»¥é‡æ–°ä½¿ç”¨ã€‚</td>
          <td>-</td>
        </tr>
        <tr>
          <td>valid_referers</td>
          <td>ç”¨æ¥æ ¡éªŒHttpè¯·æ±‚å¤´Refereræ˜¯å¦æœ‰æ•ˆã€‚</td>
          <td>-</td>
        </tr>
        <tr>
          <td>try_files</td>
          <td>ç”¨åœ¨serveréƒ¨åˆ†ï¼Œä¸è¿‡æœ€å¸¸è§çš„è¿˜æ˜¯ç”¨åœ¨locationéƒ¨åˆ†ï¼Œå®ƒä¼šæŒ‰ç…§ç»™å®šçš„å‚æ•°é¡ºåºè¿›è¡Œå°è¯•ï¼Œç¬¬ä¸€ä¸ªè¢«åŒ¹é…åˆ°çš„å°†ä¼šè¢«ä½¿ç”¨ã€‚</td>
          <td>-</td>
        </tr>
        <tr>
          <td>if</td>
          <td>å½“åœ¨locationå—ä¸­ä½¿ç”¨ifæŒ‡ä»¤ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å®ƒå¹¶ä¸æŒ‰ç…§é¢„æœŸè¿è¡Œï¼Œä¸€èˆ¬æ¥è¯´é¿å…ä½¿ç”¨ifæŒ‡ä»¤ã€‚</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
    <p>ä¾‹å¦‚æˆ‘ä»¬å† <strong>nginx.conf</strong> é‡Œé¢å¼•ç”¨ä¸¤ä¸ªé…ç½® vhost/example.com.conf å’Œ vhost/gitlab.com.conf å®ƒä»¬éƒ½è¢«æ”¾åœ¨ä¸€ä¸ªæˆ‘è‡ªå·±æ–°å»ºçš„ç›®å½• vhost ä¸‹é¢ã€‚nginx.conf é…ç½®å¦‚ä¸‹ï¼š</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">1</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token comment">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span>
    <span class="token comment">#                  '$status $body_bytes_sent "$http_referer" '</span>
    <span class="token comment">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span>

    <span class="token comment">#access_log  logs/access.log  main;</span>

    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">include</span>  vhost/example.com.conf</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span>  vhost/gitlab.com.conf</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>ç®€å•çš„é…ç½®: example.com.conf</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token comment">#ä¾¦å¬çš„80ç«¯å£</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  baidu.com app.baidu.com</span><span class="token punctuation">;</span> <span class="token comment"># è¿™é‡ŒæŒ‡å®šåŸŸå</span>
    <span class="token directive"><span class="token keyword">index</span>        index.html index.htm</span><span class="token punctuation">;</span>    <span class="token comment"># è¿™é‡ŒæŒ‡å®šé»˜è®¤å…¥å£é¡µé¢</span>
    <span class="token directive"><span class="token keyword">root</span> /home/www/app.baidu.com</span><span class="token punctuation">;</span>         <span class="token comment"># è¿™é‡ŒæŒ‡å®šç›®å½•</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="å†…ç½®é¢„å®šä¹‰å˜é‡"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å†…ç½®é¢„å®šä¹‰å˜é‡"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å†…ç½®é¢„å®šä¹‰å˜é‡</h3>
    <p>Nginxæä¾›äº†è®¸å¤šé¢„å®šä¹‰çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨setæ¥è®¾ç½®å˜é‡ã€‚ä½ å¯ä»¥åœ¨ifä¸­ä½¿ç”¨é¢„å®šä¹‰å˜é‡ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä»¬ä¼ é€’ç»™ä»£ç†æœåŠ¡å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é¢„å®šä¹‰å˜é‡ï¼Œ<a href="http://nginx.org/en/docs/varindex.html">æ›´å¤šè¯¦è§</a></p>
    <table>
      <thead>
        <tr>
          <th>å˜é‡åç§°</th>
          <th>å€¼</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>$args_name</td>
          <td>åœ¨è¯·æ±‚ä¸­çš„nameå‚æ•°</td>
        </tr>
        <tr>
          <td>$args</td>
          <td>æ‰€æœ‰è¯·æ±‚å‚æ•°</td>
        </tr>
        <tr>
          <td>$query_string</td>
          <td>$argsçš„åˆ«å</td>
        </tr>
        <tr>
          <td>$content_length</td>
          <td>è¯·æ±‚å¤´Content-Lengthçš„å€¼</td>
        </tr>
        <tr>
          <td>$content_type</td>
          <td>è¯·æ±‚å¤´Content-Typeçš„å€¼</td>
        </tr>
        <tr>
          <td>$host</td>
          <td>å¦‚æœå½“å‰æœ‰Hostï¼Œåˆ™ä¸ºè¯·æ±‚å¤´Hostçš„å€¼ï¼›å¦‚æœæ²¡æœ‰è¿™ä¸ªå¤´ï¼Œé‚£ä¹ˆè¯¥å€¼ç­‰äºåŒ¹é…è¯¥è¯·æ±‚çš„server_nameçš„å€¼</td>
        </tr>
        <tr>
          <td>$remote_addr</td>
          <td>å®¢æˆ·ç«¯çš„IPåœ°å€</td>
        </tr>
        <tr>
          <td>$request</td>
          <td>å®Œæ•´çš„è¯·æ±‚ï¼Œä»å®¢æˆ·ç«¯æ”¶åˆ°ï¼ŒåŒ…æ‹¬Httpè¯·æ±‚æ–¹æ³•ã€URIã€Httpåè®®ã€å¤´ã€è¯·æ±‚ä½“</td>
        </tr>
        <tr>
          <td>$request_uri</td>
          <td>å®Œæ•´è¯·æ±‚çš„URIï¼Œä»å®¢æˆ·ç«¯æ¥çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬å‚æ•°</td>
        </tr>
        <tr>
          <td>$scheme</td>
          <td>å½“å‰è¯·æ±‚çš„åè®®</td>
        </tr>
        <tr>
          <td>$uri</td>
          <td>å½“å‰è¯·æ±‚çš„æ ‡å‡†åŒ–URI</td>
        </tr>
      </tbody>
    </table>
    <h3 id="åå‘ä»£ç†"><a class="anchor" aria-hidden="true" tabindex="-1" href="#åå‘ä»£ç†"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>åå‘ä»£ç†</h3>
    <p>åå‘ä»£ç†æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨å¾—åˆ°çš„ç»“æœè¿”å›ç»™è¿æ¥çš„å®¢æˆ·ç«¯ã€‚ä¸‹é¢ç®€å•çš„åå‘ä»£ç†çš„ä¾‹å­ï¼š</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>  
  <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>                                                        
  <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>                                              
  <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">1024M</span></span><span class="token punctuation">;</span>  <span class="token comment"># å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span>

  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span>                         http://localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host              <span class="token variable">$host</span>:<span class="token variable">$server_port</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For   <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span> <span class="token comment"># HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IP</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>      <span class="token comment"># ä¸ºäº†æ­£ç¡®åœ°è¯†åˆ«å®é™…ç”¨æˆ·å‘å‡ºçš„åè®®æ˜¯ http è¿˜æ˜¯ https</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>å¤æ‚çš„é…ç½®: gitlab.com.confã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token comment">#ä¾¦å¬çš„80ç«¯å£</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  git.example.cn</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span>   http://localhost:3000</span><span class="token punctuation">;</span>
        <span class="token comment">#ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤</span>
        <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token comment">#åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">client_max_body_size</span>       <span class="token number">10m</span></span><span class="token punctuation">;</span> <span class="token comment">#å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span>
        <span class="token directive"><span class="token keyword">client_body_buffer_size</span>    <span class="token number">128k</span></span><span class="token punctuation">;</span> <span class="token comment">#ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°</span>
        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span>      <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment">#nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span>
        <span class="token directive"><span class="token keyword">proxy_send_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment">#åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</span>
        <span class="token directive"><span class="token keyword">proxy_read_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span> <span class="token comment">#è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span>
        <span class="token directive"><span class="token keyword">proxy_buffer_size</span>          <span class="token number">4k</span></span><span class="token punctuation">;</span> <span class="token comment">#è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span>
        <span class="token directive"><span class="token keyword">proxy_buffers</span>              <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span> <span class="token comment">#proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®</span>
        <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span>    <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment">#é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>ä»£ç†åˆ°ä¸Šæ¸¸æœåŠ¡å™¨çš„é…ç½®ä¸­ï¼Œæœ€é‡è¦çš„æ˜¯proxy_passæŒ‡ä»¤ã€‚ä»¥ä¸‹æ˜¯ä»£ç†æ¨¡å—ä¸­çš„ä¸€äº›å¸¸ç”¨æŒ‡ä»¤ï¼š</p>
    <table>
      <thead>
        <tr>
          <th>æŒ‡ä»¤</th>
          <th>è¯´æ˜</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>proxy_connect_timeout</td>
          <td>Nginxä»æ¥å—è¯·æ±‚è‡³è¿æ¥åˆ°ä¸Šæ¸¸æœåŠ¡å™¨çš„æœ€é•¿ç­‰å¾…æ—¶é—´</td>
        </tr>
        <tr>
          <td>proxy_send_timeout</td>
          <td>åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</td>
        </tr>
        <tr>
          <td>proxy_read_timeout</td>
          <td>è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</td>
        </tr>
        <tr>
          <td>proxy_cookie_domain</td>
          <td>æ›¿ä»£ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥çš„Set-Cookieå¤´çš„domainå±æ€§</td>
        </tr>
        <tr>
          <td>proxy_cookie_path</td>
          <td>æ›¿ä»£ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥çš„Set-Cookieå¤´çš„pathå±æ€§</td>
        </tr>
        <tr>
          <td>proxy_buffer_size</td>
          <td>è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</td>
        </tr>
        <tr>
          <td>proxy_buffers</td>
          <td>proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨å¤šå°‘kä»¥ä¸‹</td>
        </tr>
        <tr>
          <td>proxy_set_header</td>
          <td>é‡å†™å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡å™¨å¤´çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°†æŸä¸ªå¤´éƒ¨çš„å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè€Œä¸å‘é€æŸä¸ªå¤´éƒ¨çš„æ–¹æ³•å®ç°</td>
        </tr>
        <tr>
          <td>proxy_ignore_headers</td>
          <td>è¿™ä¸ªæŒ‡ä»¤ç¦æ­¢å¤„ç†æ¥è‡ªä»£ç†æœåŠ¡å™¨çš„åº”ç­”ã€‚</td>
        </tr>
        <tr>
          <td>proxy_intercept_errors</td>
          <td>ä½¿nginxé˜»æ­¢HTTPåº”ç­”ä»£ç ä¸º400æˆ–è€…æ›´é«˜çš„åº”ç­”ã€‚</td>
        </tr>
      </tbody>
    </table>
    <h3 id="è´Ÿè½½å‡è¡¡"><a class="anchor" aria-hidden="true" tabindex="-1" href="#è´Ÿè½½å‡è¡¡"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>è´Ÿè½½å‡è¡¡</h3>
    <p>upstreamæŒ‡ä»¤å¯ç”¨ä¸€ä¸ªæ–°çš„é…ç½®åŒºæ®µï¼Œåœ¨è¯¥åŒºæ®µå®šä¹‰ä¸€ç»„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚è¿™äº›æœåŠ¡å™¨å¯èƒ½è¢«è®¾ç½®ä¸åŒçš„æƒé‡ï¼Œä¹Ÿå¯èƒ½å‡ºäºå¯¹æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ï¼Œæ ‡è®°ä¸ºdownã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> gitlab</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
    <span class="token comment"># upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.122.11:8081</span> <span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:82 weight=3</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:83 weight=3 down</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:84 weight=3</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">max_fails=3</span>  fail_timeout=20s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:85 weight=4</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token comment">#ä¾¦å¬çš„80ç«¯å£</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  git.example.cn</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span>   http://gitlab</span><span class="token punctuation">;</span>    <span class="token comment">#åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªä»£ç†ï¼Œå’Œupstreamçš„åå­—ä¸€æ ·</span>
        <span class="token comment">#ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤</span>
        <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token comment">#åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>           X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">client_max_body_size</span>       <span class="token number">10m</span></span><span class="token punctuation">;</span>  <span class="token comment">#å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span>
        <span class="token directive"><span class="token keyword">client_body_buffer_size</span>    <span class="token number">128k</span></span><span class="token punctuation">;</span> <span class="token comment">#ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°</span>
        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span>      <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span>
        <span class="token directive"><span class="token keyword">proxy_send_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</span>
        <span class="token directive"><span class="token keyword">proxy_read_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment">#è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span>
        <span class="token directive"><span class="token keyword">proxy_buffer_size</span>          <span class="token number">4k</span></span><span class="token punctuation">;</span> <span class="token comment">#è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span>
        <span class="token directive"><span class="token keyword">proxy_buffers</span>              <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span><span class="token comment"># ç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®</span>
        <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span>    <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment">#é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span>
        <span class="token directive"><span class="token keyword">proxy_temp_file_write_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span> <span class="token comment">#è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚</p>
    <p><strong>è´Ÿè½½å‡è¡¡ï¼š</strong></p>
    <p>upstreamæ¨¡å—èƒ½å¤Ÿä½¿ç”¨3ç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šè½®è¯¢ã€IPå“ˆå¸Œã€æœ€å°‘è¿æ¥æ•°ã€‚</p>
    <p><strong>è½®è¯¢ï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨è½®è¯¢ç®—æ³•ï¼Œä¸éœ€è¦é…ç½®æŒ‡ä»¤æ¥æ¿€æ´»å®ƒï¼Œå®ƒæ˜¯åŸºäºåœ¨é˜Ÿåˆ—ä¸­è°æ˜¯ä¸‹ä¸€ä¸ªçš„åŸç†ç¡®ä¿è®¿é—®å‡åŒ€åœ°åˆ†å¸ƒåˆ°æ¯ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼›<br><strong>IPå“ˆå¸Œï¼š</strong> é€šè¿‡ip_hashæŒ‡ä»¤æ¥æ¿€æ´»ï¼ŒNginxé€šè¿‡IPv4åœ°å€çš„å‰3ä¸ªå­—èŠ‚æˆ–è€…æ•´ä¸ªIPv6åœ°å€ä½œä¸ºå“ˆå¸Œé”®æ¥å®ç°ï¼ŒåŒä¸€ä¸ªIPåœ°å€æ€»æ˜¯èƒ½è¢«æ˜ å°„åˆ°åŒä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼›<br><strong>æœ€å°‘è¿æ¥æ•°ï¼š</strong> é€šè¿‡least_connæŒ‡ä»¤æ¥æ¿€æ´»ï¼Œè¯¥ç®—æ³•é€šè¿‡é€‰æ‹©ä¸€ä¸ªæ´»è·ƒæ•°æœ€å°‘çš„ä¸Šæ¸¸æœåŠ¡å™¨è¿›è¡Œè¿æ¥ã€‚å¦‚æœä¸Šæ¸¸æœåŠ¡å™¨å¤„ç†èƒ½åŠ›ä¸åŒï¼Œå¯ä»¥é€šè¿‡ç»™serveré…ç½®weightæƒé‡æ¥è¯´æ˜ï¼Œè¯¥ç®—æ³•å°†è€ƒè™‘åˆ°ä¸åŒæœåŠ¡å™¨çš„åŠ æƒæœ€å°‘è¿æ¥æ•°ã€‚</p>
    <h4 id="rr"><a class="anchor" aria-hidden="true" tabindex="-1" href="#rr"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>RR</h4>
    <p><strong>ç®€å•é…ç½®</strong> ï¼Œè¿™é‡Œæˆ‘é…ç½®äº†2å°æœåŠ¡å™¨ï¼Œå½“ç„¶å®é™…ä¸Šæ˜¯ä¸€å°ï¼Œåªæ˜¯ç«¯å£ä¸ä¸€æ ·è€Œå·²ï¼Œè€Œ8081çš„æœåŠ¡å™¨æ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è®¿é—®ä¸åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¬è®¿é—® <code>http://localhost</code> çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä¼šé»˜è®¤è·³è½¬åˆ°<code>http://localhost:8080</code>å…·ä½“æ˜¯å› ä¸ºNginxä¼šè‡ªåŠ¨åˆ¤æ–­æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œå¦‚æœæœåŠ¡å™¨å¤„äºä¸èƒ½è®¿é—®ï¼ˆæœåŠ¡å™¨æŒ‚äº†ï¼‰ï¼Œå°±ä¸ä¼šè·³è½¬åˆ°è¿™å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¹Ÿé¿å…äº†ä¸€å°æœåŠ¡å™¨æŒ‚äº†å½±å“ä½¿ç”¨çš„æƒ…å†µï¼Œç”±äºNginxé»˜è®¤æ˜¯RRç­–ç•¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å…¶ä»–æ›´å¤šçš„è®¾ç½®</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">81</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">1024M</span></span><span class="token punctuation">;</span>
 
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://test</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span>:<span class="token variable">$server_port</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p><strong>è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒä»£ç ä¸º</strong></p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4 id="æƒé‡"><a class="anchor" aria-hidden="true" tabindex="-1" href="#æƒé‡"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>æƒé‡</h4>
    <p>æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ä¾‹å¦‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080 weight=9</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081 weight=1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>é‚£ä¹ˆ10æ¬¡ä¸€èˆ¬åªä¼šæœ‰1æ¬¡ä¼šè®¿é—®åˆ°8081ï¼Œè€Œæœ‰9æ¬¡ä¼šè®¿é—®åˆ°8080</p>
    <h4 id="ip_hash"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ip_hash"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ip_hash</h4>
    <p>ä¸Šé¢çš„2ç§æ–¹å¼éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™è¯·æ±‚å¯èƒ½åˆ†å‘åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸æ˜¯æ— çŠ¶æ€çš„æ—¶å€™ï¼ˆé‡‡ç”¨äº†sessionä¿å­˜æ•°æ®ï¼‰ï¼Œè¿™æ—¶å€™å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¾ˆé—®é¢˜äº†ï¼Œæ¯”å¦‚æŠŠç™»å½•ä¿¡æ¯ä¿å­˜åˆ°äº†sessionä¸­ï¼Œé‚£ä¹ˆè·³è½¬åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™å°±éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¢æˆ·åªè®¿é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨iphashäº†ï¼Œiphashçš„æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4 id="fair"><a class="anchor" aria-hidden="true" tabindex="-1" href="#fair"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>fair</h4>
    <p>è¿™æ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒæŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">fair</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4 id="url_hash"><a class="anchor" aria-hidden="true" tabindex="-1" href="#url_hash"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>url_hash</h4>
    <p>è¿™æ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒæŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ åœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">hash_method</span> crc32</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>ä»¥ä¸Š5ç§è´Ÿè½½å‡è¡¡å„è‡ªé€‚ç”¨ä¸åŒæƒ…å†µä¸‹ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä½¿ç”¨å“ªç§ç­–ç•¥æ¨¡å¼ï¼Œä¸è¿‡fairå’Œurl_hashéœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—æ‰èƒ½ä½¿ç”¨</p>
    <p><strong>serveræŒ‡ä»¤å¯é€‰å‚æ•°ï¼š</strong></p>
    <ol>
      <li>weightï¼šè®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨çš„è®¿é—®æƒé‡ï¼Œæ•°å€¼è¶Šé«˜ï¼Œæ”¶åˆ°çš„è¯·æ±‚ä¹Ÿè¶Šå¤šï¼›</li>
      <li>fail_timeoutï¼šåœ¨è¿™ä¸ªæŒ‡å®šçš„æ—¶é—´å†…æœåŠ¡å™¨å¿…é¡»æä¾›å“åº”ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šè¢«æ ‡è®°ä¸ºdownçŠ¶æ€ï¼›</li>
      <li>max_failsï¼šè®¾ç½®åœ¨fail_timeoutæ—¶é—´ä¹‹å†…å°è¯•å¯¹ä¸€ä¸ªæœåŠ¡å™¨è¿æ¥çš„æœ€å¤§æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ¬¡æ•°ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šè¢«æ ‡è®°ä¸ºdown;</li>
      <li>downï¼šæ ‡è®°ä¸€ä¸ªæœåŠ¡å™¨ä¸å†æ¥å—ä»»ä½•è¯·æ±‚ï¼›</li>
      <li>backupï¼šä¸€æ—¦å…¶ä»–æœåŠ¡å™¨å®•æœºï¼Œé‚£ä¹ˆæœ‰è¯¥æ ‡è®°çš„æœºå™¨å°†ä¼šæ¥æ”¶è¯·æ±‚ã€‚</li>
    </ol>
    <p><strong>keepaliveæŒ‡ä»¤ï¼š</strong></p>
    <p>NginxæœåŠ¡å™¨å°†ä¼šä¸ºæ¯ä¸€ä¸ªworkerè¿›è¡Œä¿æŒåŒä¸Šæ¸¸æœåŠ¡å™¨çš„è¿æ¥ã€‚</p>
    <h3 id="å±è”½ip"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å±è”½ip"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å±è”½ip</h3>
    <p>åœ¨nginxçš„é…ç½®æ–‡ä»¶<code>nginx.conf</code>ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œå¯ä»¥æ”¾åˆ°http, server, location, limit_exceptè¯­å¥å—ï¼Œéœ€è¦æ³¨æ„ç›¸å¯¹è·¯å¾„ï¼Œæœ¬ä¾‹å½“ä¸­<code>nginx.conf</code>ï¼Œ<code>blocksip.conf</code>åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">include</span> blockip.conf</span><span class="token punctuation">;</span>
</code></pre>
    <p>åœ¨blockip.confé‡Œé¢è¾“å…¥å†…å®¹ï¼Œå¦‚ï¼š</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">deny</span> 165.91.122.67</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">deny</span> IP</span><span class="token punctuation">;</span>   <span class="token comment"># å±è”½å•ä¸ªipè®¿é—®</span>
<span class="token directive"><span class="token keyword">allow</span> IP</span><span class="token punctuation">;</span>  <span class="token comment"># å…è®¸å•ä¸ªipè®¿é—®</span>
<span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>  <span class="token comment"># å±è”½æ‰€æœ‰ipè®¿é—®</span>
<span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span> <span class="token comment"># å…è®¸æ‰€æœ‰ipè®¿é—®</span>
<span class="token directive"><span class="token keyword">deny</span> 123.0.0.0/8   <span class="token comment"># å±è”½æ•´ä¸ªæ®µå³ä»123.0.0.1åˆ°123.255.255.254è®¿é—®çš„å‘½ä»¤</span>
deny 124.45.0.0/16 <span class="token comment"># å±è”½IPæ®µå³ä»123.45.0.1åˆ°123.45.255.254è®¿é—®çš„å‘½ä»¤</span>
deny 123.45.6.0/24 <span class="token comment"># å±è”½IPæ®µå³ä»123.45.6.1åˆ°123.45.6.254è®¿é—®çš„å‘½ä»¤</span>

<span class="token comment"># å¦‚æœä½ æƒ³å®ç°è¿™æ ·çš„åº”ç”¨ï¼Œé™¤äº†å‡ ä¸ªIPå¤–ï¼Œå…¶ä»–å…¨éƒ¨æ‹’ç»</span>
allow 1.1.1.1</span><span class="token punctuation">;</span> 
<span class="token directive"><span class="token keyword">allow</span> 1.1.1.2</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span> 
</code></pre>
    <h2 id="ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•</h2>
    <pre><code>./configure --prefix=/ä½ çš„å®‰è£…ç›®å½•  --add-module=/ç¬¬ä¸‰æ–¹æ¨¡å—ç›®å½•
</code></pre>
    <h2 id="é‡å®šå‘"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é‡å®šå‘"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é‡å®šå‘</h2>
    <ul>
      <li><code>permanent</code> æ°¸ä¹…æ€§é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º301</li>
      <li><code>redirect</code> ä¸´æ—¶é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º302</li>
    </ul>
    <h3 id="é‡å®šå‘æ•´ä¸ªç½‘ç«™"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é‡å®šå‘æ•´ä¸ªç½‘ç«™"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é‡å®šå‘æ•´ä¸ªç½‘ç«™</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> old-site.com
    return <span class="token number">301</span> <span class="token variable">$scheme</span>://new-site.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="é‡å®šå‘å•é¡µ"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é‡å®šå‘å•é¡µ"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é‡å®šå‘å•é¡µ</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> = /oldpage.html</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> http://example.org/newpage.html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="é‡å®šå‘æ•´ä¸ªå­è·¯å¾„"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é‡å®šå‘æ•´ä¸ªå­è·¯å¾„"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é‡å®šå‘æ•´ä¸ªå­è·¯å¾„</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /old-site</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/old-site/(.*) http://example.org/new-site/<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2 id="æ€§èƒ½"><a class="anchor" aria-hidden="true" tabindex="-1" href="#æ€§èƒ½"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>æ€§èƒ½</h2>
    <h3 id="å†…å®¹ç¼“å­˜"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å†…å®¹ç¼“å­˜"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å†…å®¹ç¼“å­˜</h3>
    <p>å…è®¸æµè§ˆå™¨åŸºæœ¬ä¸Šæ°¸ä¹…åœ°ç¼“å­˜é™æ€å†…å®¹ã€‚ Nginxå°†ä¸ºæ‚¨è®¾ç½®Expireså’ŒCache-Controlå¤´ä¿¡æ¯ã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /static</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /data</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> max</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>å¦‚æœè¦æ±‚æµè§ˆå™¨æ°¸è¿œä¸ä¼šç¼“å­˜å“åº”ï¼ˆä¾‹å¦‚ç”¨äºè·Ÿè¸ªè¯·æ±‚ï¼‰ï¼Œè¯·ä½¿ç”¨-1ã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> = /empty.gif</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">empty_gif</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> -1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="gzipå‹ç¼©"><a class="anchor" aria-hidden="true" tabindex="-1" href="#gzipå‹ç¼©"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Gzipå‹ç¼©</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">gzip</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">256</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_types</span>
    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml
    text/javascript application/javascript application/x-javascript
    text/x-json application/json application/x-web-app-manifest+json
    text/css text/plain text/x-component
    font/opentype application/x-font-ttf application/vnd.ms-fontobject
    image/x-icon</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_disable</span>  <span class="token string">"msie6"</span></span><span class="token punctuation">;</span>
</code></pre>
    <h3 id="æ‰“å¼€æ–‡ä»¶ç¼“å­˜"><a class="anchor" aria-hidden="true" tabindex="-1" href="#æ‰“å¼€æ–‡ä»¶ç¼“å­˜"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>æ‰“å¼€æ–‡ä»¶ç¼“å­˜</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">open_file_cache</span> max=1000 inactive=20s</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_valid</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_min_uses</span> <span class="token number">2</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</code></pre>
    <h3 id="sslç¼“å­˜"><a class="anchor" aria-hidden="true" tabindex="-1" href="#sslç¼“å­˜"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>SSLç¼“å­˜</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">ssl_session_cache</span> shared:SSL:10m</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">10m</span></span><span class="token punctuation">;</span>
</code></pre>
    <h3 id="ä¸Šæ¸¸keepalive"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ä¸Šæ¸¸keepalive"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ä¸Šæ¸¸Keepalive</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    ...
    <span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">""</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="ç›‘æ§"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ç›‘æ§"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ç›‘æ§</h3>
    <p>ä½¿ç”¨<code>ngxtop</code>å®æ—¶è§£ænginxè®¿é—®æ—¥å¿—ï¼Œå¹¶ä¸”å°†å¤„ç†ç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç³»ç»Ÿå‘½ä»¤topã€‚æ‰€æœ‰ç¤ºä¾‹éƒ½è¯»å–nginxé…ç½®æ–‡ä»¶çš„è®¿é—®æ—¥å¿—ä½ç½®å’Œæ ¼å¼ã€‚å¦‚æœè¦æŒ‡å®šè®¿é—®æ—¥å¿—æ–‡ä»¶å’Œ/æˆ–æ—¥å¿—æ ¼å¼ï¼Œè¯·ä½¿ç”¨-få’Œ-aé€‰é¡¹ã€‚</p>
    <p>æ³¨æ„ï¼šåœ¨nginxé…ç½®ä¸­<code>/usr/local/nginx/conf/nginx.conf</code>æ—¥å¿—æ–‡ä»¶å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ã€‚</p>
    <pre class="language-bash"><code class="language-bash"><span class="token comment"># å®‰è£… ngxtop</span>
pip <span class="token function">install</span> ngxtop

<span class="token comment"># å®æ—¶çŠ¶æ€</span>
ngxtop
<span class="token comment"># çŠ¶æ€ä¸º404çš„å‰10ä¸ªè¯·æ±‚çš„è·¯å¾„ï¼š</span>
ngxtop <span class="token function">top</span> request_path --filter <span class="token string">'status == 404'</span>

<span class="token comment"># å‘é€æ€»å­—èŠ‚æ•°æœ€å¤šçš„å‰10ä¸ªè¯·æ±‚</span>
ngxtop --order-by <span class="token string">'avg(bytes_sent) * count'</span>

<span class="token comment"># æ’åå‰åä½çš„IPï¼Œä¾‹å¦‚ï¼Œè°æ”»å‡»ä½ æœ€å¤š</span>
ngxtop --group-by remote_addr

<span class="token comment"># æ‰“å°å…·æœ‰4xxæˆ–5xxçŠ¶æ€çš„è¯·æ±‚ï¼Œä»¥åŠstatuså’Œhttp referer</span>
ngxtop -i <span class="token string">'status >= 400'</span> print request status http_referer

<span class="token comment"># ç”±200ä¸ªè¯·æ±‚è·¯å¾„å“åº”å‘é€çš„å¹³å‡æ­£æ–‡å­—èŠ‚ä»¥'foo'å¼€å§‹ï¼š</span>
ngxtop avg bytes_sent --filter <span class="token string">'status == 200 and request_path.startswith("foo")'</span>

<span class="token comment"># ä½¿ç”¨â€œcommonâ€æ—¥å¿—æ ¼å¼ä»è¿œç¨‹æœºå™¨åˆ†æapacheè®¿é—®æ—¥å¿—</span>
<span class="token function">ssh</span> remote <span class="token function">tail</span> -f /var/log/apache2/access.log <span class="token operator">|</span> ngxtop -f common
</code></pre>
    <h2 id="å¸¸è§ä½¿ç”¨åœºæ™¯"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å¸¸è§ä½¿ç”¨åœºæ™¯"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å¸¸è§ä½¿ç”¨åœºæ™¯</h2>
    <h3 id="è·¨åŸŸé—®é¢˜"><a class="anchor" aria-hidden="true" tabindex="-1" href="#è·¨åŸŸé—®é¢˜"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>è·¨åŸŸé—®é¢˜</h3>
    <p>åœ¨å·¥ä½œä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€äº›æ¥å£ä¸æ”¯æŒè·¨åŸŸï¼Œè¿™æ—¶å€™å¯ä»¥ç®€å•çš„æ·»åŠ add_headersæ¥æ”¯æŒcorsè·¨åŸŸã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> api.xxx.com</span><span class="token punctuation">;</span>
    
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET,POST,HEAD'</span></span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host  <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre>
    <p>ä¸Šé¢æ›´æ”¹å¤´ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€ç§ï¼Œä½¿ç”¨ <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">rewrite</a> æŒ‡ä»¤é‡å®šå‘URIæ¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> api.xxx.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span> 
    <span class="token directive"><span class="token keyword">root</span>  html</span><span class="token punctuation">;</span>                   <span class="token comment">#å»è¯·æ±‚../htmlæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶</span>
    <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>  <span class="token comment">#é¦–é¡µå“åº”åœ°å€</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># ç”¨äºæ‹¦æˆªè¯·æ±‚ï¼ŒåŒ¹é…ä»»ä½•ä»¥ /api/å¼€å¤´çš„åœ°å€ï¼Œ</span>
  <span class="token comment"># åŒ¹é…ç¬¦åˆä»¥åï¼Œåœæ­¢å¾€ä¸‹æœç´¢æ­£åˆ™ã€‚</span>
  <span class="token directive"><span class="token keyword">location</span> ^~/api/</span><span class="token punctuation">{</span> 
    <span class="token comment"># ä»£è¡¨é‡å†™æ‹¦æˆªè¿›æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”åªèƒ½å¯¹åŸŸååè¾¹çš„é™¤å»ä¼ é€’çš„å‚æ•°å¤–çš„å­—ç¬¦ä¸²èµ·ä½œç”¨ï¼Œ</span>
    <span class="token comment"># ä¾‹å¦‚www.a.com/proxy/api/msg?meth=1&#x26;par=2é‡å†™ï¼Œåªå¯¹/proxy/api/msgé‡å†™ã€‚</span>
    <span class="token comment"># rewriteåé¢çš„å‚æ•°æ˜¯ä¸€ä¸ªç®€å•çš„æ­£åˆ™ ^/api/(.*)$ï¼Œ</span>
    <span class="token comment"># $1ä»£è¡¨æ­£åˆ™ä¸­çš„ç¬¬ä¸€ä¸ª()ï¼Œ$2ä»£è¡¨ç¬¬äºŒä¸ª()çš„å€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/api/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
    
    <span class="token comment"># æŠŠè¯·æ±‚ä»£ç†åˆ°å…¶ä»–ä¸»æœº </span>
    <span class="token comment"># å…¶ä¸­ http://www.b.com/ å†™æ³•å’Œ http://www.b.comå†™æ³•çš„åŒºåˆ«å¦‚ä¸‹</span>
    <span class="token comment"># å¦‚æœä½ çš„è¯·æ±‚åœ°å€æ˜¯ä»– http://server/html/test.jsp</span>
    <span class="token comment"># é…ç½®ä¸€ï¼š http://www.b.com/ åé¢æœ‰â€œ/â€ </span>
    <span class="token comment">#         å°†åå‘ä»£ç†æˆ http://www.b.com/html/test.jsp è®¿é—®</span>
    <span class="token comment"># é…ç½®ä¸€ï¼š http://www.b.com åé¢æ²¡æœ‰æœ‰â€œ/â€ </span>
    <span class="token comment">#         å°†åå‘ä»£ç†æˆ http://www.b.com/test.jsp è®¿é—®</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://test</span><span class="token punctuation">;</span>

    <span class="token comment"># å¦‚æœ proxy_pass  URL æ˜¯ http://a.xx.com/platform/ è¿™ç§æƒ…å†µ</span>
    <span class="token comment"># proxy_cookie_pathåº”è¯¥è®¾ç½®æˆ /platform/ / (æ³¨æ„ä¸¤ä¸ªæ–œæ ä¹‹é—´æœ‰ç©ºæ ¼)ã€‚</span>
    <span class="token directive"><span class="token keyword">proxy_cookie_path</span> /platfrom/ /</span><span class="token punctuation">;</span>

    <span class="token comment"># http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header</span>
    <span class="token comment"># è®¾ç½® Cookie å¤´é€šè¿‡</span>
    <span class="token directive"><span class="token keyword">proxy_pass_header</span> Set-Cookie</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢"><a class="anchor" aria-hidden="true" tabindex="-1" href="#è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token comment"># é…ç½®æ­£å¸¸çš„å¸¦wwwçš„åŸŸå</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.wangchujiang.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">root</span> /home/www/wabg/download</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html =404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># è¿™ä¸ªè¦æ”¾åˆ°ä¸‹é¢ï¼Œ</span>
    <span class="token comment"># å°†ä¸å¸¦wwwçš„ wangchujiang.com æ°¸ä¹…æ€§é‡å®šå‘åˆ°  https://www.wangchujiang.com</span>
    <span class="token directive"><span class="token keyword">server_name</span> wangchujiang.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^(.*) https://www.wangchujiang.com<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="ä»£ç†è½¬å‘"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ä»£ç†è½¬å‘"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ä»£ç†è½¬å‘</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">upstream</span> server-api</span><span class="token punctuation">{</span>
    <span class="token comment"># api ä»£ç†æœåŠ¡åœ°å€</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3110</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">upstream</span> server-resource</span><span class="token punctuation">{</span>
    <span class="token comment"># é™æ€èµ„æº ä»£ç†æœåŠ¡åœ°å€</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3120</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">3111</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>      <span class="token comment"># è¿™é‡ŒæŒ‡å®šåŸŸå</span>
    <span class="token directive"><span class="token keyword">root</span> /home/www/server-statics</span><span class="token punctuation">;</span>
    <span class="token comment"># åŒ¹é… api è·¯ç”±çš„åå‘ä»£ç†åˆ°APIæœåŠ¡</span>
    <span class="token directive"><span class="token keyword">location</span> ^~/api/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-api</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># å‡è®¾è¿™é‡ŒéªŒè¯ç ä¹Ÿåœ¨APIæœåŠ¡ä¸­</span>
    <span class="token directive"><span class="token keyword">location</span> ^~/captcha</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-api</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># å‡è®¾ä½ çš„å›¾ç‰‡èµ„æºå…¨éƒ¨åœ¨å¦å¤–ä¸€ä¸ªæœåŠ¡ä¸Šé¢</span>
    <span class="token directive"><span class="token keyword">location</span> ^~/img/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-resource</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># è·¯ç”±åœ¨å‰ç«¯ï¼Œåç«¯æ²¡æœ‰çœŸå®è·¯ç”±ï¼Œåœ¨è·¯ç”±ä¸å­˜åœ¨çš„ 404çŠ¶æ€çš„é¡µé¢è¿”å› /index.html</span>
    <span class="token comment"># è¿™ä¸ªæ–¹å¼ä½¿ç”¨åœºæ™¯ï¼Œä½ åœ¨å†™Reactæˆ–è€…Vueé¡¹ç›®çš„æ—¶å€™ï¼Œæ²¡æœ‰çœŸå®è·¯ç”±</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html =404</span><span class="token punctuation">;</span>
 Â  Â  Â  Â <span class="token comment"># Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ^ ç©ºæ ¼å¾ˆé‡è¦</span>
 Â  Â <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="ç›‘æ§çŠ¶æ€ä¿¡æ¯"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ç›‘æ§çŠ¶æ€ä¿¡æ¯"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ç›‘æ§çŠ¶æ€ä¿¡æ¯</h3>
    <p>é€šè¿‡ <code>nginx -V</code> æ¥æŸ¥çœ‹æ˜¯å¦æœ‰ <code>with-http_stub_status_module</code> è¯¥æ¨¡å—ã€‚</p>
    <blockquote>
      <p><code>nginx -V</code> è¿™é‡Œ <code>V</code> æ˜¯å¤§å†™çš„ï¼Œå¦‚æœæ˜¯å°å†™çš„ <code>v</code> å³ <code>nginx -v</code>ï¼Œåˆ™ä¸ä¼šå‡ºç°æœ‰å“ªäº›æ¨¡å—ï¼Œåªä¼šå‡ºç° <code>nginx</code> çš„ç‰ˆæœ¬</p>
    </blockquote>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /nginx_status</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">stub_status</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>é€šè¿‡ <a href="http://127.0.0.1/nginx_status">http://127.0.0.1/nginx_status</a> è®¿é—®å‡ºç°ä¸‹é¢ç»“æœã€‚</p>
    <pre class="language-bash"><code class="language-bash">Active connections: <span class="token number">3</span>
server accepts handled requests
 <span class="token number">7</span> <span class="token number">7</span> <span class="token number">5</span> 
Reading: <span class="token number">0</span> Writing: <span class="token number">1</span> Waiting: <span class="token number">2</span> 
</code></pre>
    <ol>
      <li>ä¸»åŠ¨è¿æ¥(ç¬¬ 1 è¡Œ)</li>
    </ol>
    <p>å½“å‰ä¸httpå»ºç«‹çš„è¿æ¥æ•°ï¼ŒåŒ…æ‹¬ç­‰å¾…çš„å®¢æˆ·ç«¯è¿æ¥ï¼š3</p>
    <ol start="2">
      <li>æœåŠ¡å™¨æ¥å—å¤„ç†çš„è¯·æ±‚(ç¬¬ 2~3 è¡Œ)</li>
    </ol>
    <p>æ¥å—çš„å®¢æˆ·ç«¯è¿æ¥æ€»æ•°ç›®ï¼š7<br>å¤„ç†çš„å®¢æˆ·ç«¯è¿æ¥æ€»æ•°ç›®ï¼š7<br>å®¢æˆ·ç«¯æ€»çš„è¯·æ±‚æ•°ç›®ï¼š5</p>
    <ol start="3">
      <li>è¯»å–å…¶å®ƒä¿¡(ç¬¬ 4 è¡Œ)</li>
    </ol>
    <p>å½“å‰ï¼Œnginxè¯»è¯·æ±‚è¿æ¥<br>å½“å‰ï¼Œnginxå†™å“åº”è¿”å›ç»™å®¢æˆ·ç«¯<br>ç›®å‰æœ‰å¤šå°‘ç©ºé—²å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥</p>
    <h3 id="ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ^~/api/upload</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /wfs/v1/upload break</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://wfs-api</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="sslé…ç½®"><a class="anchor" aria-hidden="true" tabindex="-1" href="#sslé…ç½®"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>sslé…ç½®</h3>
    <p>è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼ˆç¼©å†™ï¼šHTTPSï¼Œè‹±è¯­ï¼šHypertext Transfer Protocol Secureï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®å’ŒSSL/TLSçš„ç»„åˆï¼Œç”¨ä»¥æä¾›åŠ å¯†é€šè®¯åŠå¯¹ç½‘ç»œæœåŠ¡å™¨èº«ä»½çš„é‰´å®šã€‚HTTPSè¿æ¥ç»å¸¸è¢«ç”¨äºä¸‡ç»´ç½‘ä¸Šçš„äº¤æ˜“æ”¯ä»˜å’Œä¼ä¸šä¿¡æ¯ç³»ç»Ÿä¸­æ•æ„Ÿä¿¡æ¯çš„ä¼ è¾“ã€‚HTTPSä¸åº”ä¸åœ¨RFC 2660ä¸­å®šä¹‰çš„å®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆS-HTTPï¼‰ç›¸æ··ã€‚HTTPS ç›®å‰å·²ç»æ˜¯æ‰€æœ‰æ³¨é‡éšç§å’Œå®‰å…¨çš„ç½‘ç«™çš„é¦–é€‰ï¼Œéšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒHTTPS ç½‘ç«™å·²ä¸å†æ˜¯å¤§å‹ç½‘ç«™çš„ä¸“åˆ©ï¼Œæ‰€æœ‰æ™®é€šçš„ä¸ªäººç«™é•¿å’Œåšå®¢å‡å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ­å»ºä¸€ä¸ªå®‰å…¨çš„åŠ å¯†çš„ç½‘ç«™ã€‚</p>
    <p>åˆ›å»ºSSLè¯ä¹¦ï¼Œå¦‚æœä½ è´­ä¹°çš„è¯ä¹¦ï¼Œå°±å¯ä»¥ç›´æ¥ä¸‹è½½</p>
    <pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> /etc/nginx/ssl
<span class="token comment"># åˆ›å»ºäº†æœ‰æ•ˆæœŸ100å¹´ï¼ŒåŠ å¯†å¼ºåº¦ä¸ºRSA2048çš„SSLå¯†é’¥keyå’ŒX509è¯ä¹¦æ–‡ä»¶ã€‚</span>
<span class="token function">sudo</span> openssl req -x509 -nodes -days <span class="token number">36500</span> -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt
<span class="token comment"># ä¸Šé¢å‘½ä»¤ï¼Œä¼šæœ‰ä¸‹é¢éœ€è¦å¡«å†™å†…å®¹</span>
Country Name <span class="token punctuation">(</span><span class="token number">2</span> letter code<span class="token punctuation">)</span> <span class="token punctuation">[</span>AU<span class="token punctuation">]</span>:US
State or Province Name <span class="token punctuation">(</span>full name<span class="token punctuation">)</span> <span class="token punctuation">[</span>Some-State<span class="token punctuation">]</span>:New York
Locality Name <span class="token punctuation">(</span>eg, city<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:New York City
Organization Name <span class="token punctuation">(</span>eg, company<span class="token punctuation">)</span> <span class="token punctuation">[</span>Internet Widgits Pty Ltd<span class="token punctuation">]</span>:Bouncy Castles, Inc.
Organizational Unit Name <span class="token punctuation">(</span>eg, section<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:Ministry of Water Slides
Common Name <span class="token punctuation">(</span>e.g. server FQDN or YOUR name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:your_domain.com
Email Address <span class="token punctuation">[</span><span class="token punctuation">]</span>:admin@your_domain.com
</code></pre>
    <p>åˆ›å»ºè‡ªç­¾è¯ä¹¦</p>
    <pre class="language-bash"><code class="language-bash">é¦–å…ˆï¼Œåˆ›å»ºè¯ä¹¦å’Œç§é’¥çš„ç›®å½•
<span class="token comment"># mkdir -p /etc/nginx/cert</span>
<span class="token comment"># cd /etc/nginx/cert</span>
åˆ›å»ºæœåŠ¡å™¨ç§é’¥ï¼Œå‘½ä»¤ä¼šè®©ä½ è¾“å…¥ä¸€ä¸ªå£ä»¤ï¼š
<span class="token comment"># openssl genrsa -des3 -out nginx.key 2048</span>
åˆ›å»ºç­¾åè¯·æ±‚çš„è¯ä¹¦ï¼ˆCSRï¼‰ï¼š
<span class="token comment"># openssl req -new -key nginx.key -out nginx.csr</span>
åœ¨åŠ è½½SSLæ”¯æŒçš„Nginxå¹¶ä½¿ç”¨ä¸Šè¿°ç§é’¥æ—¶é™¤å»å¿…é¡»çš„å£ä»¤ï¼š
<span class="token comment"># cp nginx.key nginx.key.org</span>
<span class="token comment"># openssl rsa -in nginx.key.org -out nginx.key</span>
æœ€åæ ‡è®°è¯ä¹¦ä½¿ç”¨ä¸Šè¿°ç§é’¥å’ŒCSRï¼š
<span class="token comment"># openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt</span>
</code></pre>
    <p>æŸ¥çœ‹ç›®å‰nginxç¼–è¯‘é€‰é¡¹</p>
    <pre><code>sbin/nginx -V
</code></pre>
    <p>è¾“å‡ºä¸‹é¢å†…å®¹</p>
    <pre><code>nginx version: nginx/1.7.8
built by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)
TLS SNI support enabled
configure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre
</code></pre>
    <p>å¦‚æœä¾èµ–çš„æ¨¡å—ä¸å­˜åœ¨ï¼Œå¯ä»¥è¿›å…¥å®‰è£…ç›®å½•ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤é‡æ–°ç¼–è¯‘å®‰è£…ã€‚</p>
    <pre class="language-bash"><code class="language-bash">./configure --prefix<span class="token operator">=</span>/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
</code></pre>
    <p>è¿è¡Œå®Œæˆä¹‹åè¿˜éœ€è¦<code>make</code> (ä¸ç”¨make install)</p>
    <pre class="language-bash"><code class="language-bash"><span class="token comment"># å¤‡ä»½nginxçš„äºŒè¿›åˆ¶æ–‡ä»¶</span>
<span class="token function">cp</span> -rf /usr/local/nginx/sbin/nginxã€€ /usr/local/nginx/sbin/nginx.bak
<span class="token comment"># è¦†ç›–nginxçš„äºŒè¿›åˆ¶æ–‡ä»¶</span>
<span class="token function">cp</span> -rf objs/nginx   /usr/local/nginx/sbin/
</code></pre>
    <p>HTTPS server</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/ssl/nginx.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/ssl/nginx.key</span><span class="token punctuation">;</span>
    <span class="token comment"># ç¦æ­¢åœ¨headerä¸­å‡ºç°æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œé˜²æ­¢é»‘å®¢åˆ©ç”¨ç‰ˆæœ¬æ¼æ´æ”»å‡»</span>
    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token comment"># è®¾ç½®ssl/tlsä¼šè¯ç¼“å­˜çš„ç±»å‹å’Œå¤§å°ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªå‚æ•°ä¸€èˆ¬æ˜¯sharedï¼Œbuildinå¯èƒ½ä¼šå‚æ•°å†…å­˜ç¢ç‰‡ï¼Œé»˜è®¤æ˜¯noneï¼Œå’Œoffå·®ä¸å¤šï¼Œåœç”¨ç¼“å­˜ã€‚å¦‚shared:SSL:10mè¡¨ç¤ºæˆ‘æ‰€æœ‰çš„nginxå·¥ä½œè¿›ç¨‹å…±äº«sslä¼šè¯ç¼“å­˜ï¼Œå®˜ç½‘ä»‹ç»è¯´1Må¯ä»¥å­˜æ”¾çº¦4000ä¸ªsessionsã€‚ </span>
    <span class="token directive"><span class="token keyword">ssl_session_cache</span>    shared:SSL:1m</span><span class="token punctuation">;</span> 

    <span class="token comment"># å®¢æˆ·ç«¯å¯ä»¥é‡ç”¨ä¼šè¯ç¼“å­˜ä¸­sslå‚æ•°çš„è¿‡æœŸæ—¶é—´ï¼Œå†…ç½‘ç³»ç»Ÿé»˜è®¤5åˆ†é’Ÿå¤ªçŸ­äº†ï¼Œå¯ä»¥è®¾æˆ30må³30åˆ†é’Ÿç”šè‡³4hã€‚</span>
    <span class="token directive"><span class="token keyword">ssl_session_timeout</span>  <span class="token number">5m</span></span><span class="token punctuation">;</span> 

    <span class="token comment"># é€‰æ‹©åŠ å¯†å¥—ä»¶ï¼Œä¸åŒçš„æµè§ˆå™¨æ‰€æ”¯æŒçš„å¥—ä»¶ï¼ˆå’Œé¡ºåºï¼‰å¯èƒ½ä¼šä¸åŒã€‚</span>
    <span class="token comment"># è¿™é‡ŒæŒ‡å®šçš„æ˜¯OpenSSLåº“èƒ½å¤Ÿè¯†åˆ«çš„å†™æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ openssl -v cipher 'RC4:HIGH:!aNULL:!MD5'ï¼ˆåé¢æ˜¯ä½ æ‰€æŒ‡å®šçš„å¥—ä»¶åŠ å¯†ç®—æ³•ï¼‰ æ¥çœ‹æ‰€æ”¯æŒç®—æ³•ã€‚</span>
    <span class="token directive"><span class="token keyword">ssl_ciphers</span>  HIGH:!aNULL:!MD5</span><span class="token punctuation">;</span>

    <span class="token comment"># è®¾ç½®åå•†åŠ å¯†ç®—æ³•æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æˆ‘ä»¬æœåŠ¡ç«¯çš„åŠ å¯†å¥—ä»¶ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨çš„åŠ å¯†å¥—ä»¶ã€‚</span>
    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  example.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^ https://<span class="token variable">$http_host</span><span class="token variable">$request_uri?</span> permanent</span><span class="token punctuation">;</span>    <span class="token comment"># å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https</span>
    <span class="token comment"># åœ¨é”™è¯¯é¡µé¢å’Œâ€œæœåŠ¡å™¨â€å“åº”å¤´å­—æ®µä¸­å¯ç”¨æˆ–ç¦ç”¨å‘å°„nginxç‰ˆæœ¬ã€‚ é˜²æ­¢é»‘å®¢åˆ©ç”¨ç‰ˆæœ¬æ¼æ´æ”»å‡»</span>
    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº</h3>
    <p>çº¯é™æ€-html æ”¯æŒ</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span>     www.domain1.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">access_log</span>      logs/domain1.access.log main</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">root</span>  /var/www/domain1.com/htdocs</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span>     www.domain2.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">access_log</span>      logs/domain2.access.log main</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">root</span>  /var/www/domain2.com/htdocs</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®"><a class="anchor" aria-hidden="true" tabindex="-1" href="#è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">80</span> default</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>     _ *</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span>      logs/default.access.log main</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
       <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
       <span class="token directive"><span class="token keyword">root</span>  /var/www/default/htdocs</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="çˆ¬è™«è¿‡æ»¤"><a class="anchor" aria-hidden="true" tabindex="-1" href="#çˆ¬è™«è¿‡æ»¤"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>çˆ¬è™«è¿‡æ»¤</h3>
    <p>æ ¹æ® <code>User-Agent</code> è¿‡æ»¤è¯·æ±‚ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°±å¯ä»¥è¿‡æ»¤ä¸ç¬¦åˆè¦æ±‚çš„çˆ¬è™«è¯·æ±‚(åˆçº§çˆ¬è™«)ã€‚</p>
    <blockquote>
      <p><code>~*</code> è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</p>
    </blockquote>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* <span class="token string">"python|curl|java|wget|httpclient|okhttp"</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">503</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># æ­£å¸¸å¤„ç†</span>
    <span class="token comment"># ...</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="é˜²ç›—é“¾"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é˜²ç›—é“¾"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é˜²ç›—é“¾</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|png|swf|flv)$</span> <span class="token punctuation">{</span>
   <span class="token directive"><span class="token keyword">root</span> html
   valid_referers none blocked *.nginxcn.com</span><span class="token punctuation">;</span>
   <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
     rewrite ^/ www.nginx.cn
     <span class="token comment">#return 404;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="è™šæ‹Ÿç›®å½•é…ç½®"><a class="anchor" aria-hidden="true" tabindex="-1" href="#è™šæ‹Ÿç›®å½•é…ç½®"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>è™šæ‹Ÿç›®å½•é…ç½®</h3>
    <p>aliasæŒ‡å®šçš„ç›®å½•æ˜¯å‡†ç¡®çš„ï¼Œrootæ˜¯æŒ‡å®šç›®å½•çš„ä¸Šçº§ç›®å½•ï¼Œå¹¶ä¸”è¯¥ä¸Šçº§ç›®å½•è¦å«æœ‰locationæŒ‡å®šåç§°çš„åŒåç›®å½•ã€‚</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /img/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">alias</span> /var/www/image/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># è®¿é—®/img/ç›®å½•é‡Œé¢çš„æ–‡ä»¶æ—¶ï¼Œningxä¼šè‡ªåŠ¨å»/var/www/image/ç›®å½•æ‰¾æ–‡ä»¶</span>
<span class="token directive"><span class="token keyword">location</span> /img/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /var/www/image</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># è®¿é—®/img/ç›®å½•ä¸‹çš„æ–‡ä»¶æ—¶ï¼Œnginxä¼šå»/var/www/image/img/ç›®å½•ä¸‹æ‰¾æ–‡ä»¶ã€‚]</span>
</code></pre>
    <h3 id="é˜²ç›—å›¾é…ç½®"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é˜²ç›—å›¾é…ç½®"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é˜²ç›—å›¾é…ç½®</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf)</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">valid_referers</span> none blocked *.jslite.io</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/  http://wangchujiang.com/piratesp.png</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="å±è”½gitç­‰æ–‡ä»¶"><a class="anchor" aria-hidden="true" tabindex="-1" href="#å±è”½gitç­‰æ–‡ä»¶"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>å±è”½.gitç­‰æ–‡ä»¶</h3>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ~ (.git|.gitattributes|.gitignore|.svn)</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®"><a class="anchor" aria-hidden="true" tabindex="-1" href="#åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®</h3>
    <pre class="language-bash"><code class="language-bash">http://wangchujiang.com/api/index.php?a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&#x26;</span><span class="token assign-left variable">name</span><span class="token operator">=</span>wcj
                                  ^ æœ‰åç¼€

http://wangchujiang.com/api/index?a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&#x26;</span><span class="token assign-left variable">name</span><span class="token operator">=</span>wcj
                                 ^ æ²¡æœ‰åç¼€
</code></pre>
    <p>nginx rewriteè§„åˆ™å¦‚ä¸‹ï¼š</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)/$ /index.php?/<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">if</span> (!-d <span class="token variable">$request_filename</span>)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$rule_1</span> 1<span class="token variable">$rule_1</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">if</span> (!-f <span class="token variable">$request_filename</span>)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$rule_1</span> 2<span class="token variable">$rule_1</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$rule_1</span> = <span class="token string">"21"</span>)</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/ /index.php last</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3 id="cockpit"><a class="anchor" aria-hidden="true" tabindex="-1" href="#cockpit"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>cockpit</h3>
    <p><a href="https://github.com/cockpit-project/cockpit">https://github.com/cockpit-project/cockpit</a></p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>
Â  Â  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
Â  Â  <span class="token directive"><span class="token keyword">server_name</span> cockpit.xxxxxxx.com</span><span class="token punctuation">;</span>
Â  Â  <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
Â  Â  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
Â  Â  <span class="token directive"><span class="token keyword">server_name</span> cockpit.xxxxxxx.com</span><span class="token punctuation">;</span>
 
Â  Â  <span class="token comment">#ssl on;</span>
Â  Â  <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/cert/cockpit.xxxxxxx.com.pem</span><span class="token punctuation">;</span>
Â  Â  <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/cert/cockpit.xxxxxxx.com.key</span><span class="token punctuation">;</span>
 
Â  Â  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
Â  Â  Â  Â  <span class="token directive"><span class="token keyword">root</span> /</span><span class="token punctuation">;</span>
Â  Â  Â  Â  <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>
Â  Â  Â  Â  <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
Â  Â  Â  Â  <span class="token directive"><span class="token keyword">proxy_pass</span> http://websocket</span><span class="token punctuation">;</span>
Â  Â  Â  Â  <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
Â  Â  Â  Â  <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
Â  Â  Â  Â  <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">"upgrade"</span></span><span class="token punctuation">;</span>
Â  Â  Â  Â  <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
Â  Â  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>è¿™æ—¶è¾“å…¥åŸŸåï¼Œèƒ½çœ‹åˆ°ç™»å½•é¡µé¢ï¼Œä½†ç™»å½•åï¼Œæ˜¾ç¤ºä¸å‡ºå†…å®¹ï¼Œé¡µé¢å…¨ç™½ã€‚è¿™é‡Œè¦å¯¹ <code>cockpit.conf</code> è¿›è¡Œè®¾ç½®ä¿®æ”¹ã€‚</p>
    <pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/cockpit/cockpit.conf
</code></pre>
    <p>å‚ç…§å¦‚ä¸‹é…ç½®ä¿®æ”¹ï¼Œæ³¨æ„åŸŸåæ›¿æ¢ä¸º <code>your_domain_host</code>ï¼š</p>
    <pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">WebService</span><span class="token punctuation">]</span>
<span class="token key property">Origins</span> <span class="token punctuation">=</span> https://cockpit<span class="token punctuation">.</span>xxxxxxx<span class="token punctuation">.</span>com https://<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span>:<span class="token number">9090</span>
<span class="token key property">ProtocolHeader</span> <span class="token punctuation">=</span> X-Forwarded-Proto
<span class="token key property">AllowUnencrypted</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</code></pre>
    <h2 id="é”™è¯¯é—®é¢˜"><a class="anchor" aria-hidden="true" tabindex="-1" href="#é”™è¯¯é—®é¢˜"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>é”™è¯¯é—®é¢˜</h2>
    <pre class="language-bash"><code class="language-bash">The plain HTTP request was sent to HTTPS port
</code></pre>
    <p>è§£å†³åŠæ³•ï¼Œ<code>fastcgi_param HTTPS $https if_not_empty</code> æ·»åŠ è¿™æ¡è§„åˆ™ï¼Œ</p>
    <pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span> <span class="token comment"># æ³¨æ„è¿™æ¡è§„åˆ™</span>
    <span class="token directive"><span class="token keyword">server_name</span>  my.domain.com</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">fastcgi_param</span> HTTPS <span class="token variable">$https</span> if_not_empty</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_param</span> HTTPS <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/ssl/certs/your.pem</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/ssl/private/your.key</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token comment"># Your config here...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2 id="nginx-æ¨¡å—"><a class="anchor" aria-hidden="true" tabindex="-1" href="#nginx-æ¨¡å—"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Nginx æ¨¡å—</h2>
    <ul>
      <li><a href="https://gitlab.com/rbdr/ngx_http_office_hours_filter_module">Nginx Office Hours</a> ä¸€ä¸ª nginx æ¨¡å—ï¼Œå…è®¸æ‚¨ä»…åœ¨åŠå…¬æ—¶é—´å†…æä¾›è®¿é—®è®¿é—®ç½‘ç«™ã€‚</li>
    </ul>
    <h2 id="ç²¾å“æ–‡ç« å‚è€ƒ"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ç²¾å“æ–‡ç« å‚è€ƒ"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ç²¾å“æ–‡ç« å‚è€ƒ</h2>
    <ul>
      <li><a href="https://my.oschina.net/u/3341316/blog/877206">è´Ÿè½½å‡è¡¡åŸç†çš„è§£æ</a></li>
      <li><a href="http://blog.githuber.cn/posts/73">Nginxæ³›åŸŸåè§£æï¼Œå®ç°å¤šä¸ªäºŒçº§åŸŸå</a></li>
      <li><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">æ·±å…¥ NGINX: æˆ‘ä»¬å¦‚ä½•è®¾è®¡æ€§èƒ½å’Œæ‰©å±•</a></li>
      <li><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">Inside NGINX: How We Designed for Performance &#x26; Scale</a></li>
      <li><a href="http://tengine.taobao.org/book/index.html">Nginxå¼€å‘ä»å…¥é—¨åˆ°ç²¾é€š</a></li>
      <li><a href="http://os.51cto.com/art/201703/535326.htm#topx">Nginxçš„ä¼˜åŒ–ä¸é˜²ç›—é“¾</a></li>
      <li><a href="https://segmentfault.com/a/1190000009769143">å®æˆ˜å¼€å‘ä¸€ä¸ªNginxæ‰©å±• (Nginx Module)</a></li>
      <li><a href="https://my.oschina.net/xshuai/blog/917097">Nginx+Keepalived(åŒæœºçƒ­å¤‡)æ­å»ºé«˜å¯ç”¨è´Ÿè½½å‡è¡¡ç¯å¢ƒ(HA)</a></li>
      <li><a href="http://www.huxd.org/articles/2017/07/24/1500890692329.html">Nginx å¹³æ»‘å‡çº§</a></li>
      <li><a href="https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&#x26;mid=2247483708&#x26;idx=1&#x26;sn=90b0b1dccd9c337922a0588245277666&#x26;chksm=97f38cf7a08405e1928e0b46d923d630e529e7db8ac7ca2a91310a075986f8bcb2cee5b4953d#rd">Nginxæœ€æ–°æ¨¡å—â€”ngx_http_mirror_moduleåˆ†æå¯ä»¥åšç‰ˆæœ¬å‘å¸ƒå‰çš„é¢„å…ˆéªŒè¯ï¼Œè¿›è¡Œæµé‡æ”¾å¤§åçš„å‹æµ‹ç­‰ç­‰</a></li>
    </ul>
  </div></body>
</html>
